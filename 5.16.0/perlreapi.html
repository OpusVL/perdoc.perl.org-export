      
      
      
      

      <!DOCTYPE html>
      <html lang="en">

      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="perlreapi - perldoc.perl.org">
        <link rel="icon" href="/public/img/favicon.ico">
        <title>perlreapi - perldoc.perl.org</title>
        <link href="/public/css/main.min.css" rel="stylesheet">
        <link rel="canonical" href="/perlreapi.html">
        <link
          href='https://fonts.googleapis.com/css?family=Lato:400,100,300,700,900'
          rel='stylesheet' type='text/css'>
        <script>
          window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments)
          };
          ga.l = +new Date;
          ga('create', 'UA-1892152-2', 'auto'); // JJ's account
          ga('create', 'UA-50555-3', 'auto', 'perlOrg'); // perl.org account
          ga('require', 'outboundLinkTracker', {
            events: ['click', 'auxclick', 'contextmenu'],
          });
          ga('require', 'maxScrollTracker');
          ga('send', 'pageview');
          ga('perlOrg.send', 'pageview');
        </script>
        <script async src="https://www.google-analytics.com/analytics.js">
        </script>
        <script async src="/public/js/tracking.min.js"></script>
      </head>

      <body class="body container-fluid ">
        <div class="wrapper">

          <nav
    class="navbar navbar-dark bg-primary bg-perl fixed-top justify-content-between navbar-expand-lg">
    <a href="#content" class="skippy sr-only sr-only-focusable">
        <span class=' skippy-text'>Skip to main content</span>
    </a>
    <a class="navbar-brand" href="/">
        <img class="logo" src="/public/img/logo_perl_doc.svg"
            alt="Perl Documentation Logo" />
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
        data-target="#navbar" aria-controls="navbar" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbar" class="collapse navbar-collapse ">
        <ul class="navbar-nav ml-auto navbar-right">
            <form class="nav-item dropdown search-wrapper">
                <input type="text" id='searchinput' aria-describedby='navbarDropdown5'
                    placeholder="Type query" class='search-input-field' value=''>

                <button href="#" data-toggle='dropdown' type="button"
                    aria-haspopup="true" aria-expanded='false' id="navbarDropdown5"
                    class="nav-link dropdown-toggle search-link">
                    <object tabindex='-1' focusable="false" class='search-icon'
                        data="/public/img/search.svg" type="image/svg+xml"
                        name='search icon'>search
                        icon</object>
                </button>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown5"
                    id='search-results'>
                    <p class='dropdown-item major-version'>
                        No results
                    </p>
                </div>
            </form>
            <li class="nav-item dropdown">
                <a id="navbarDropdown" href="#" class="nav-link dropdown-toggle"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Perl versions</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    
                        <p class='dropdown-item major-version'>
                            5.32
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.32.0/">5.32.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.30
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.30.3/">5.30.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.2/">5.30.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.1/">5.30.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.0/">5.30.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.28
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.28.3/">5.28.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.2/">5.28.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.1/">5.28.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.0/">5.28.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.26
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.26.3/">5.26.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.2/">5.26.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.1/">5.26.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.0/">5.26.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.24
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.24.4/">5.24.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.3/">5.24.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.2/">5.24.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.1/">5.24.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.0/">5.24.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.22
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.22.4/">5.22.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.3/">5.22.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.2/">5.22.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.1/">5.22.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.0/">5.22.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.20
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.20.3/">5.20.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.2/">5.20.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.1/">5.20.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.0/">5.20.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.18
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.18.4/">5.18.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.3/">5.18.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.2/">5.18.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.1/">5.18.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.0/">5.18.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.16
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.16.3/">5.16.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.2/">5.16.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.1/">5.16.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.0/">5.16.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.14
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.14.4/">5.14.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.3/">5.14.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.2/">5.14.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.1/">5.14.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.0/">5.14.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.12
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.12.5/">5.12.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.4/">5.12.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.3/">5.12.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.2/">5.12.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.1/">5.12.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.0/">5.12.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.10
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.10.1/">5.10.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.10.0/">5.10.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.8
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.8.9/">5.8.9</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.8/">5.8.8</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.7/">5.8.7</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.6/">5.8.6</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.5/">5.8.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.4/">5.8.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.3/">5.8.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.2/">5.8.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.1/">5.8.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.0/">5.8.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.6
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.6.2/">5.6.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.1/">5.6.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.0/">5.6.0</a>
                        
                        
                    
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown1" href="#" class="dropdown-toggle nav-link"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Manuals</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown1">
                    <a class="dropdown-item"
                        href="/5.16.0/index-overview.html">Overview</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-tutorials.html">Tutorials</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-faq.html">FAQs</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-history.html">Changes</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-licence.html">License</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-language.html">Language</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-functions.html">Functions</a>
                    <a class="dropdown-item"
                        href="/5.16.0/perlop.html">Operators</a>
                    <a class="dropdown-item"
                        href="/5.16.0/perlvar.html">Variables</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-pragmas.html">Pragmas</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-utilities.html">Utilities</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-internals.html">Internals</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-platforms.html">Platforms</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown3" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Modules</a>
                <div aria-labelledby="navbarDropdown3"
                    class="dropdown-menu letters-wrap">
                    <!--<a class="dropdown-item"
                        href="/5.16.0/index-modules.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-modules-by-cat.html">By
                        Category</a>-->
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-A.html">A</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-B.html">B</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-C.html">C</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-D.html">D</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-E.html">E</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-F.html">F</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-G.html">G</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-H.html">H</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-I.html">I</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-J.html">J</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-K.html">K</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-L.html">L</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-M.html">M</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-N.html">N</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-O.html">O</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-P.html">P</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-Q.html">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-R.html">R</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-S.html">S</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-T.html">T</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-U.html">U</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-V.html">V</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-W.html">W</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-X.html">X</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-Y.html">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-modules-Z.html">Z</a>
                    </div>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown4" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Functions</a>
                <div aria-labelledby="navbarDropdown4"
                    class="dropdown-menu letters-wrap">
                    <a class="dropdown-item"
                        href="/5.16.0/index-functions.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.16.0/index-functions-by-cat.html">By
                        Category</a>
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#A">A</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#B">B</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#C">C</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#D">D</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#E">E</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#F">F</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#G">G</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#H">H</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#I">I</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#J">J</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#K">K</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#L">L</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#M">M</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#N">N</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#O">O</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#P">P</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#Q">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#R">R</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#S">S</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#T">T</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#U">U</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#V">V</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#W">W</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#X">X</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#Y">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.16.0/index-functions.html#Z">Z</a>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <!--/.nav-collapse -->
</nav>


          <main class="row main-content pb-5 pt-5" id='content'>
            <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
              <div class="row">
                <div class="col-sm-12">
                  <div id="breadcrumbs">
                      
    <a href="index.html">Home</a>&nbsp; &gt;
    
      
        <a href="index-internals.html">Internals and C language interface</a> &gt;
      
    
    perlreapi
  

                  </div>
                </div>
              </div>
              <div class="row">
                <article class="col-sm-12 content">
                  <div class="documentation-wrapper">
                    <div id="perl_version">
                      <h7 class='page-title'> Perl 5 version 16.0
                        documentation</h7>
                    </div>
                    <h1>perlreapi</h1>


  <!--    -->
<ul><li><a href="#NAME">NAME</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><li><a href="#Callbacks">Callbacks</a></li><ul><li><a href="#comp">comp</a></li><li><a href="#exec">exec</a></li><li><a href="#intuit">intuit</a></li><li><a href="#checkstr">checkstr</a></li><li><a href="#free">free</a></li><li><a href="#Numbered-capture-callbacks">Numbered capture callbacks</a></li><li><a href="#Named-capture-callbacks">Named capture callbacks</a></li><li><a href="#qr_package">qr_package</a></li><li><a href="#dupe">dupe</a></li></ul><li><a href="#The-REGEXP-structure">The REGEXP structure</a></li><ul><li><a href="#engine">engine</a></li><li><a href="#mother_re">mother_re</a></li><li><a href="#extflags">extflags</a></li><li><a href="#minlen-minlenret">minlen minlenret</a></li><li><a href="#gofs">gofs</a></li><li><a href="#substrs">substrs</a></li><li><a href="#nparens%2c-lastparen%2c-and-lastcloseparen">nparens, lastparen, and lastcloseparen</a></li><li><a href="#intflags">intflags</a></li><li><a href="#pprivate">pprivate</a></li><li><a href="#swap">swap</a></li><li><a href="#offs">offs</a></li><li><a href="#precomp-prelen">precomp prelen</a></li><li><a href="#paren_names">paren_names</a></li><li><a href="#substrs">substrs</a></li><li><a href="#subbeg-sublen-saved_copy">subbeg sublen saved_copy</a></li><li><a href="#wrapped-wraplen">wrapped wraplen</a></li><li><a href="#seen_evals">seen_evals</a></li><li><a href="#refcnt">refcnt</a></li></ul><li><a href="#HISTORY">HISTORY</a></li><li><a href="#AUTHORS">AUTHORS</a></li><li><a href="#LICENSE">LICENSE</a></li></ul><a class='view-head1' id="NAME"></a><h2 class='h2' >NAME</h2>
<p>perlreapi - perl regular expression plugin interface</p>
<a class='view-head1' id="DESCRIPTION"></a><h2 class='h2' >DESCRIPTION</h2>
<p>As of Perl 5.9.5 there is a new interface for plugging and using other
regular expression engines than the default one.</p>
<p>Each engine is supposed to provide access to a constant structure of the
following format:</p>
<pre class="verbatim"><ol><li>    <span class="w">typedef</span> <span class="w">struct</span> <span class="i">regexp_engine</span> <span class="s">{</span></li><li>        <span class="w">REGEXP</span>* <span class="s">(</span><span class="i">*comp</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">const</span> <span class="w">SV</span> * <span class="w">const</span> <span class="w">pattern</span><span class="cm">,</span> <span class="w">const</span> <span class="w">U32</span> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">I32</span>     <span class="s">(</span><span class="i">*exec</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">char</span>* <span class="w">stringarg</span><span class="cm">,</span> <span class="w">char</span>* <span class="w">strend</span><span class="cm">,</span></li><li>                         <span class="w">char</span>* <span class="w">strbeg</span><span class="cm">,</span> <span class="w">I32</span> <span class="w">minend</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">screamer</span><span class="cm">,</span></li><li>                         <span class="w">void</span>* <span class="w">data</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">char</span>*   <span class="s">(</span><span class="i">*intuit</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">SV</span> *<span class="w">sv</span><span class="cm">,</span> <span class="w">char</span> *<span class="w">strpos</span><span class="cm">,</span></li><li>                           <span class="w">char</span> *<span class="w">strend</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">flags</span><span class="cm">,</span></li><li>                           <span class="w">struct</span> <span class="w">re_scream_pos_data_s</span> *<span class="w">data</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">SV</span>*     <span class="s">(</span><span class="i">*checkstr</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">void</span>    <span class="s">(</span><span class="i">*free</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">void</span>    <span class="s">(</span><span class="i">*numbered_buff_FETCH</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">const</span> <span class="w">I32</span> <span class="w">paren</span><span class="cm">,</span></li><li>                                 <span class="w">SV</span> * <span class="w">const</span> <span class="w">sv</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">void</span>    <span class="s">(</span><span class="i">*numbered_buff_STORE</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">const</span> <span class="w">I32</span> <span class="w">paren</span><span class="cm">,</span></li><li>                                       <span class="w">SV</span> <span class="w">const</span> * <span class="w">const</span> <span class="w">value</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">I32</span>     <span class="s">(</span><span class="i">*numbered_buff_LENGTH</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">const</span> <span class="w">SV</span> * <span class="w">const</span> <span class="w">sv</span><span class="cm">,</span></li><li>                                        <span class="w">const</span> <span class="w">I32</span> <span class="w">paren</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">SV</span>*     <span class="s">(</span><span class="i">*named_buff</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">SV</span> * <span class="w">const</span> <span class="w">key</span><span class="cm">,</span></li><li>                               <span class="w">SV</span> * <span class="w">const</span> <span class="w">value</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">SV</span>*     <span class="s">(</span><span class="i">*named_buff_iter</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">const</span> <span class="w">SV</span> * <span class="w">const</span> <span class="w">lastkey</span><span class="cm">,</span></li><li>                                    <span class="w">const</span> <span class="w">U32</span> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">SV</span>*     <span class="s">(</span><span class="i">*qr_package</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="c">#ifdef USE_ITHREADS</span></li><li>        <span class="w">void</span>*   <span class="s">(</span><span class="i">*dupe</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">CLONE_PARAMS</span> *<span class="w">param</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="c">#endif</span></li></ol></pre><p>When a regexp is compiled, its <code class="inline"><span class="w">engine</span></code>
 field is then set to point at
the appropriate structure, so that when it needs to be used Perl can find
the right routines to do so.</p>
<p>In order to install a new regexp handler, <code class="inline"><span class="i">$^H</span>{<span class="w">regcomp</span>}</code>
 is set
to an integer which (when casted appropriately) resolves to one of these
structures. When compiling, the <code class="inline"><span class="w">comp</span></code>
 method is executed, and the
resulting regexp structure's engine field is expected to point back at
the same structure.</p>
<p>The pTHX_ symbol in the definition is a macro used by perl under threading
to provide an extra argument to the routine holding a pointer back to
the interpreter that is executing the regexp. So under threading all
routines get an extra argument.</p>
<a class='view-head1' id="Callbacks"></a><h2 class='h2' >Callbacks</h2>
<a class='view-head2' id="comp"></a><h3 class='h3' >comp</h3>
<pre class="verbatim"><ol><li>    <span class="w">REGEXP</span>* <span class="i">comp</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">const</span> <span class="w">SV</span> * <span class="w">const</span> <span class="w">pattern</span><span class="cm">,</span> <span class="w">const</span> <span class="w">U32</span> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Compile the pattern stored in <code class="inline"><span class="w">pattern</span></code>
 using the given <code class="inline"><span class="w">flags</span></code>
 and
return a pointer to a prepared <code class="inline"><span class="w">REGEXP</span></code>
 structure that can perform
the match. See <a href="#The-REGEXP-structure">The REGEXP structure</a> below for an explanation of
the individual fields in the REGEXP struct.</p>
<p>The <code class="inline"><span class="w">pattern</span></code>
 parameter is the scalar that was used as the
pattern. previous versions of perl would pass two <code class="inline"><span class="w">char</span>*</code>
 indicating
the start and end of the stringified pattern, the following snippet can
be used to get the old parameters:</p>
<pre class="verbatim"><ol><li>    <span class="w">STRLEN</span> <span class="w">plen</span><span class="sc">;</span></li><li>    <span class="w">char</span>*  <a class="l_k" href="functions/exp.html">exp</a> = <span class="i">SvPV</span><span class="s">(</span><span class="w">pattern</span><span class="cm">,</span> <span class="w">plen</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">char</span>* <span class="w">xend</span> = <a class="l_k" href="functions/exp.html">exp</a> + <span class="w">plen</span><span class="sc">;</span></li></ol></pre><p>Since any scalar can be passed as a pattern it's possible to implement
an engine that does something with an array (<code class="inline"><span class="q">&quot;ook&quot;</span> =~ <span class="s">[</span> <span class="q">qw/ eek</span>
<span class="q">hlagh /</span> <span class="s">]</span></code>
) or with the non-stringified form of a compiled regular
expression (<code class="inline"><span class="q">&quot;ook&quot;</span> =~ <span class="q">qr/eek/</span></code>
). perl's own engine will always
stringify everything using the snippet above but that doesn't mean
other engines have to.</p>
<p>The <code class="inline"><span class="w">flags</span></code>
 parameter is a bitfield which indicates which of the
<code class="inline"><span class="w">msixp</span></code>
 flags the regex was compiled with. It also contains
additional info such as whether <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">locale</span></code>
 is in effect.</p>
<p>The <code class="inline"><span class="w">eogc</span></code>
 flags are stripped out before being passed to the comp
routine. The regex engine does not need to know whether any of these
are set as those flags should only affect what perl does with the
pattern and its match variables, not how it gets compiled and
executed.</p>
<p>By the time the comp callback is called, some of these flags have
already had effect (noted below where applicable). However most of
their effect occurs after the comp callback has run in routines that
read the <code class="inline"><span class="w">rx</span><span class="w">-&gt;extflags</span></code>
 field which it populates.</p>
<p>In general the flags should be preserved in <code class="inline"><span class="w">rx</span><span class="w">-&gt;extflags</span></code>
 after
compilation, although the regex engine might want to add or delete
some of them to invoke or disable some special behavior in perl. The
flags along with any special behavior they cause are documented below:</p>
<p>The pattern modifiers:</p>
<ul>
<li><a class='view-title' id="%2fm---RXf_PMf_MULTILINE"></a><strong><code class="inline"><span class="q">/m</span></code>
 - RXf_PMf_MULTILINE</strong>
<p>If this is in <code class="inline"><span class="w">rx</span><span class="w">-&gt;extflags</span></code>
 it will be passed to
<code class="inline"><span class="w">Perl_fbm_instr</span></code>
 by <code class="inline"><span class="w">pp_split</span></code>
 which will treat the subject string
as a multi-line string.</p>
</li>
<li><a class='view-title' id="%2fs---RXf_PMf_SINGLELINE"></a><strong><code class="inline"><span class="q">/s</span></code>
 - RXf_PMf_SINGLELINE</strong>
</li>
<li><a class='view-title' id="%2fi---RXf_PMf_FOLD"></a><strong><code class="inline"><span class="q">/i</span></code>
 - RXf_PMf_FOLD</strong>
</li>
<li><a class='view-title' id="%2fx---RXf_PMf_EXTENDED"></a><strong><code class="inline"><span class="q">/x</span></code>
 - RXf_PMf_EXTENDED</strong>
<p>If present on a regex <code class="inline"><span class="c">#</span></code>
 comments will be handled differently by the
tokenizer in some cases.</p>
<p>TODO: Document those cases.</p>
</li>
<li><a class='view-title' id="%2fp---RXf_PMf_KEEPCOPY"></a><strong><code class="inline"><span class="q">/p</span></code>
 - RXf_PMf_KEEPCOPY</strong>
<p>TODO: Document this</p>
</li>
<li><a class='view-title' id="Character-set"></a><strong>Character set</strong>
<p>The character set semantics are determined by an enum that is contained
in this field.  This is still experimental and subject to change, but
the current interface returns the rules by use of the in-line function
<code class="inline"><span class="i">get_regex_charset</span><span class="s">(</span><span class="w">const</span> <span class="w">U32</span> <span class="w">flags</span><span class="s">)</span></code>
.  The only currently documented
value returned from it is REGEX_LOCALE_CHARSET, which is set if
<code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">locale</span></code>
 is in effect. If present in <code class="inline"><span class="w">rx</span><span class="w">-&gt;extflags</span></code>
,
<code class="inline"><a class="l_k" href="functions/split.html">split</a></code> will use the locale dependent definition of whitespace
when RXf_SKIPWHITE or RXf_WHITE is in effect. ASCII whitespace
is defined as per <a href="perlapi.html#isSPACE">isSPACE</a>, and by the internal
macros <code class="inline"><span class="w">is_utf8_space</span></code>
 under UTF-8, and <code class="inline"><span class="w">isSPACE_LC</span></code>
 under <code class="inline"><a class="l_k" href="functions/use.html">use</a>
<span class="w">locale</span></code>
.</p>
</li>
</ul>
<p>Additional flags:</p>
<ul>
<li><a class='view-title' id="RXf_UTF8"></a><strong>RXf_UTF8</strong>
<p>Set if the pattern is <a href="perlapi.html#SvUTF8">SvUTF8()</a>, set by Perl_pmruntime.</p>
<p>A regex engine may want to set or disable this flag during
compilation. The perl engine for instance may upgrade non-UTF-8
strings to UTF-8 if the pattern includes constructs such as <code class="inline">\<span class="i">x</span><span class="s">{</span>...<span class="s">}</span></code>

that can only match Unicode values.</p>
</li>
<li><a class='view-title' id="RXf_SPLIT"></a><strong>RXf_SPLIT</strong>
<p>If <code class="inline"><a class="l_k" href="functions/split.html">split</a></code> is invoked as <code class="inline"><a class="l_k" href="functions/split.html">split</a> <span class="q">&#39; &#39;</span></code>
 or with no arguments (which
really means <code class="inline"><a class="l_k" href="functions/split.html">split</a><span class="s">(</span><span class="q">&#39; &#39;</span><span class="cm">,</span> <span class="i">$_</span><span class="s">)</span></code>
, see <a class='function-name' href="functions/split.html">split</a>), perl will
set this flag. The regex engine can then check for it and set the
SKIPWHITE and WHITE extflags. To do this the perl engine does:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/if.html">if</a> <span class="s">(</span><span class="w">flags</span> <span class="i">&amp; RXf_SPLIT</span> &amp;&amp; <span class="w">r</span><span class="w">-&gt;prelen</span> == <span class="n">1</span> &amp;&amp; <span class="w">r</span><span class="w">-&gt;precomp</span>[<span class="n">0</span>] == <span class="q">&#39; &#39;</span><span class="s">)</span></li><li>        <span class="w">r</span><span class="w">-&gt;extflags</span> |= <span class="s">(</span><span class="w">RXf_SKIPWHITE</span>|<span class="w">RXf_WHITE</span><span class="s">)</span><span class="sc">;</span></li></ol></pre></li>
</ul>
<p>These flags can be set during compilation to enable optimizations in
the <code class="inline"><a class="l_k" href="functions/split.html">split</a></code> operator.</p>
<ul>
<li><a class='view-title' id="RXf_SKIPWHITE"></a><strong>RXf_SKIPWHITE</strong>
<p>If the flag is present in <code class="inline"><span class="w">rx</span><span class="w">-&gt;extflags</span></code>
 <code class="inline"><a class="l_k" href="functions/split.html">split</a></code> will delete
whitespace from the start of the subject string before it's operated
on. What is considered whitespace depends on whether the subject is a
UTF-8 string and whether the <code class="inline"><span class="w">RXf_PMf_LOCALE</span></code>
 flag is set.</p>
<p>If RXf_WHITE is set in addition to this flag <code class="inline"><a class="l_k" href="functions/split.html">split</a></code> will behave like
<code class="inline"><a class="l_k" href="functions/split.html">split</a> <span class="q">&quot; &quot;</span></code>
 under the perl engine.</p>
</li>
<li><a class='view-title' id="RXf_START_ONLY"></a><strong>RXf_START_ONLY</strong>
<p>Tells the split operator to split the target string on newlines
(<code class="inline">\<span class="w">n</span></code>
) without invoking the regex engine.</p>
<p>Perl's engine sets this if the pattern is <code class="inline"><span class="q">/^/</span></code>
 (<code class="inline"><span class="w">plen</span> == <span class="n">1</span> &amp;&amp; <span class="i">*exp</span>
== <span class="q">&#39;^&#39;</span></code>
), even under <code class="inline"><span class="q">/^/s</span></code>
, see <a href="perlfunc.html">split</a>. Of course a
different regex engine might want to use the same optimizations
with a different syntax.</p>
</li>
<li><a class='view-title' id="RXf_WHITE"></a><strong>RXf_WHITE</strong>
<p>Tells the split operator to split the target string on whitespace
without invoking the regex engine. The definition of whitespace varies
depending on whether the target string is a UTF-8 string and on
whether RXf_PMf_LOCALE is set.</p>
<p>Perl's engine sets this flag if the pattern is <code class="inline">\<span class="q">s+</span></code>
.</p>
</li>
<li><a class='view-title' id="RXf_NULL"></a><strong>RXf_NULL</strong>
<p>Tells the split operator to split the target string on
characters. The definition of character varies depending on whether
the target string is a UTF-8 string.</p>
<p>Perl's engine sets this flag on empty patterns, this optimization
makes <code class="inline"><a class="l_k" href="functions/split.html">split</a> <span class="q">//</span></code>
 much faster than it would otherwise be. It's even
faster than <code class="inline"><a class="l_k" href="functions/unpack.html">unpack</a></code>.</p>
</li>
</ul>
<a class='view-head2' id="exec"></a><h3 class='h3' >exec</h3>
<pre class="verbatim"><ol><li>    <span class="w">I32</span> <a class="l_k" href="functions/exec.html">exec</a><span class="s">(</span><span class="i">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span></li><li>             <span class="w">char</span> *<span class="w">stringarg</span><span class="cm">,</span> <span class="w">char</span>* <span class="w">strend</span><span class="cm">,</span> <span class="w">char</span>* <span class="w">strbeg</span><span class="cm">,</span></li><li>             <span class="w">I32</span> <span class="w">minend</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">screamer</span><span class="cm">,</span></li><li>             <span class="w">void</span>* <span class="w">data</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Execute a regexp.</p>
<a class='view-head2' id="intuit"></a><h3 class='h3' >intuit</h3>
<pre class="verbatim"><ol><li>    <span class="w">char</span>* <span class="i">intuit</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span></li><li>                  <span class="w">SV</span> *<span class="w">sv</span><span class="cm">,</span> <span class="w">char</span> *<span class="w">strpos</span><span class="cm">,</span> <span class="w">char</span> *<span class="w">strend</span><span class="cm">,</span></li><li>                  <span class="w">const</span> <span class="w">U32</span> <span class="w">flags</span><span class="cm">,</span> <span class="w">struct</span> <span class="w">re_scream_pos_data_s</span> *<span class="w">data</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Find the start position where a regex match should be attempted,
or possibly whether the regex engine should not be run because the
pattern can't match. This is called as appropriate by the core
depending on the values of the extflags member of the regexp
structure.</p>
<a class='view-head2' id="checkstr"></a><h3 class='h3' >checkstr</h3>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*	<span class="i">checkstr</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Return a SV containing a string that must appear in the pattern. Used
by <code class="inline"><a class="l_k" href="functions/split.html">split</a></code> for optimising matches.</p>
<a class='view-head2' id="free"></a><h3 class='h3' >free</h3>
<pre class="verbatim"><ol><li>    <span class="w">void</span> <span class="i">free</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Called by perl when it is freeing a regexp pattern so that the engine
can release any resources pointed to by the <code class="inline"><span class="w">pprivate</span></code>
 member of the
regexp structure. This is only responsible for freeing private data;
perl will handle releasing anything else contained in the regexp structure.</p>
<a class='view-head2' id="Numbered-capture-callbacks"></a><h3 class='h3' >Numbered capture callbacks</h3>
<p>Called to get/set the value of <code class="inline"><span class="i">$`</span></code>
, <code class="inline"><span class="i">$&#39;</span></code>
, <code class="inline"><span class="i">$&amp;</span></code>
 and their named
equivalents, ${^PREMATCH}, ${^POSTMATCH} and $^{MATCH}, as well as the
numbered capture groups (<code class="inline"><span class="i">$1</span></code>
, <code class="inline"><span class="i">$2</span></code>
, ...).</p>
<p>The <code class="inline"><span class="w">paren</span></code>
 parameter will be <code class="inline"><span class="n">-2</span></code>
 for <code class="inline"><span class="i">$`</span></code>
, <code class="inline"><span class="n">-1</span></code>
 for <code class="inline"><span class="i">$&#39;</span></code>
, <code class="inline"><span class="n">0</span></code>

for <code class="inline"><span class="i">$&amp;</span></code>
, <code class="inline"><span class="n">1</span></code>
 for <code class="inline"><span class="i">$1</span></code>
 and so forth.</p>
<p>The names have been chosen by analogy with <a href="Tie/Scalar.html">Tie::Scalar</a> methods
names with an additional <strong>LENGTH</strong> callback for efficiency. However
named capture variables are currently not tied internally but
implemented via magic.</p>
<a class='view-head3' id="numbered_buff_FETCH"></a><h4 class='h4' >numbered_buff_FETCH</h4>
<pre class="verbatim"><ol><li>    <span class="w">void</span> <span class="i">numbered_buff_FETCH</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">const</span> <span class="w">I32</span> <span class="w">paren</span><span class="cm">,</span></li><li>                             <span class="w">SV</span> * <span class="w">const</span> <span class="w">sv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Fetch a specified numbered capture. <code class="inline"><span class="w">sv</span></code>
 should be set to the scalar
to return, the scalar is passed as an argument rather than being
returned from the function because when it's called perl already has a
scalar to store the value, creating another one would be
redundant. The scalar can be set with <code class="inline"><span class="w">sv_setsv</span></code>
, <code class="inline"><span class="w">sv_setpvn</span></code>
 and
friends, see <a href="perlapi.html">perlapi</a>.</p>
<p>This callback is where perl untaints its own capture variables under
taint mode (see <a href="perlsec.html">perlsec</a>). See the <code class="inline"><span class="w">Perl_reg_numbered_buff_fetch</span></code>

function in <i>regcomp.c</i> for how to untaint capture variables if
that's something you'd like your engine to do as well.</p>
<a class='view-head3' id="numbered_buff_STORE"></a><h4 class='h4' >numbered_buff_STORE</h4>
<pre class="verbatim"><ol><li>    <span class="w">void</span>    <span class="s">(</span><span class="i">*numbered_buff_STORE</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">const</span> <span class="w">I32</span> <span class="w">paren</span><span class="cm">,</span></li><li>                                    <span class="w">SV</span> <span class="w">const</span> * <span class="w">const</span> <span class="w">value</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Set the value of a numbered capture variable. <code class="inline"><span class="w">value</span></code>
 is the scalar
that is to be used as the new value. It's up to the engine to make
sure this is used as the new value (or reject it).</p>
<p>Example:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/if.html">if</a> <span class="s">(</span><span class="q">&quot;ook&quot;</span> =~ <span class="q">/(o*)/</span><span class="s">)</span> <span class="s">{</span></li><li>        <span class="c"># &#39;paren&#39; will be &#39;1&#39; and &#39;value&#39; will be &#39;ee&#39;</span></li><li>        <span class="i">$1</span> =~ <span class="q">tr/o/e/</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre><p>Perl's own engine will croak on any attempt to modify the capture
variables, to do this in another engine use the following callback
(copied from <code class="inline"><span class="w">Perl_reg_numbered_buff_store</span></code>
):</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span></li><li>    <span class="i">Example_reg_numbered_buff_store</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">const</span> <span class="w">I32</span> <span class="w">paren</span><span class="cm">,</span></li><li>    							    <span class="w">SV</span> <span class="w">const</span> * <span class="w">const</span> <span class="w">value</span><span class="s">)</span></li><li>    <span class="s">{</span></li><li>        <span class="i">PERL_UNUSED_ARG</span><span class="s">(</span><span class="w">rx</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="i">PERL_UNUSED_ARG</span><span class="s">(</span><span class="w">paren</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="i">PERL_UNUSED_ARG</span><span class="s">(</span><span class="w">value</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>        <a class="l_k" href="functions/if.html">if</a> <span class="s">(</span>!<span class="w">PL_localizing</span><span class="s">)</span></li><li>            <span class="i">Perl_croak</span><span class="s">(</span><span class="w">aTHX_</span> <span class="w">PL_no_modify</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre><p>Actually perl will not <i>always</i> croak in a statement that looks
like it would modify a numbered capture variable. This is because the
STORE callback will not be called if perl can determine that it
doesn't have to modify the value. This is exactly how tied variables
behave in the same situation:</p>
<pre class="verbatim"><ol><li><a name="package-CaptureVar"></a>    package <span class="i">CaptureVar</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">base</span> <span class="q">&#39;Tie::Scalar&#39;</span><span class="sc">;</span></li><li></li><li><a name="TIESCALAR"></a>    sub <span class="m">TIESCALAR</span> <span class="s">{</span> <a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span><span class="s">]</span> <span class="s">}</span></li><li><a name="FETCH"></a>    sub <span class="m">FETCH</span> <span class="s">{</span> <a class="l_k" href="functions/undef.html">undef</a> <span class="s">}</span></li><li><a name="STORE"></a>    sub <span class="m">STORE</span> <span class="s">{</span> <a class="l_k" href="functions/die.html">die</a> <span class="q">&quot;This doesn&#39;t get called&quot;</span> <span class="s">}</span></li><li></li><li><a name="package-main"></a>    package <span class="i">main</span><span class="sc">;</span></li><li></li><li>    <a class="l_k" href="functions/tie.html">tie</a> <a class="l_k" href="functions/my.html">my</a> <span class="i">$sv</span> <span class="cm">=&gt;</span> <span class="q">&quot;CaptureVar&quot;</span><span class="sc">;</span></li><li>    <span class="i">$sv</span> =~ <span class="q">y/a/b/</span><span class="sc">;</span></li></ol></pre><p>Because <code class="inline"><span class="i">$sv</span></code>
 is <code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code> when the <code class="inline"><a class="l_k" href="functions/y.html">y///</a></code> operator is applied to it
the transliteration won't actually execute and the program won't
<code class="inline"><a class="l_k" href="functions/die.html">die</a></code>. This is different to how 5.8 and earlier versions behaved
since the capture variables were READONLY variables then, now they'll
just die when assigned to in the default engine.</p>
<a class='view-head3' id="numbered_buff_LENGTH"></a><h4 class='h4' >numbered_buff_LENGTH</h4>
<pre class="verbatim"><ol><li>    <span class="w">I32</span> <span class="w">numbered_buff_LENGTH</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">const</span> <span class="w">SV</span> * <span class="w">const</span> <span class="w">sv</span><span class="cm">,</span></li><li>                              <span class="w">const</span> <span class="w">I32</span> <span class="w">paren</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Get the <code class="inline"><a class="l_k" href="functions/length.html">length</a></code> of a capture variable. There's a special callback
for this so that perl doesn't have to do a FETCH and run <code class="inline"><a class="l_k" href="functions/length.html">length</a></code> on
the result, since the length is (in perl's case) known from an offset
stored in <code class="inline"><span class="w">rx</span><span class="w">-&gt;offs</span></code>
 this is much more efficient:</p>
<pre class="verbatim"><ol><li>    <span class="w">I32</span> <span class="w">s1</span>  = <span class="w">rx</span><span class="w">-&gt;offs</span>[<span class="w">paren</span>].<span class="w">start</span><span class="sc">;</span></li><li>    <span class="w">I32</span> <span class="w">s2</span>  = <span class="w">rx</span><span class="w">-&gt;offs</span>[<span class="w">paren</span>].<span class="w">end</span><span class="sc">;</span></li><li>    <span class="w">I32</span> <span class="w">len</span> = <span class="w">t1</span> - <span class="w">s1</span><span class="sc">;</span></li></ol></pre><p>This is a little bit more complex in the case of UTF-8, see what
<code class="inline"><span class="w">Perl_reg_numbered_buff_length</span></code>
 does with
<a href="perlapi.html#is_utf8_string_loclen">is_utf8_string_loclen</a>.</p>
<a class='view-head2' id="Named-capture-callbacks"></a><h3 class='h3' >Named capture callbacks</h3>
<p>Called to get/set the value of <code class="inline"><span class="i">%+</span></code>
 and <code class="inline"><span class="i">%-</span></code>
 as well as by some
utility functions in <a href="re.html">re</a>.</p>
<p>There are two callbacks, <code class="inline"><span class="w">named_buff</span></code>
 is called in all the cases the
FETCH, STORE, DELETE, CLEAR, EXISTS and SCALAR <a href="Tie/Hash.html">Tie::Hash</a> callbacks
would be on changes to <code class="inline"><span class="i">%+</span></code>
 and <code class="inline"><span class="i">%-</span></code>
 and <code class="inline"><span class="w">named_buff_iter</span></code>
 in the
same cases as FIRSTKEY and NEXTKEY.</p>
<p>The <code class="inline"><span class="w">flags</span></code>
 parameter can be used to determine which of these
operations the callbacks should respond to, the following flags are
currently defined:</p>
<p>Which <a href="Tie/Hash.html">Tie::Hash</a> operation is being performed from the Perl level on
<code class="inline"><span class="i">%+</span></code>
 or <code class="inline"><span class="i">%+</span></code>
, if any:</p>
<pre class="verbatim"><ol><li>    <span class="w">RXapif_FETCH</span></li><li>    <span class="w">RXapif_STORE</span></li><li>    <span class="w">RXapif_DELETE</span></li><li>    <span class="w">RXapif_CLEAR</span></li><li>    <span class="w">RXapif_EXISTS</span></li><li>    <span class="w">RXapif_SCALAR</span></li><li>    <span class="w">RXapif_FIRSTKEY</span></li><li>    <span class="w">RXapif_NEXTKEY</span></li></ol></pre><p>Whether <code class="inline"><span class="i">%+</span></code>
 or <code class="inline"><span class="i">%-</span></code>
 is being operated on, if any.</p>
<pre class="verbatim"><ol><li>    <span class="w">RXapif_ONE</span> <span class="q">/* %+ */</span></li><li>    <span class="w">RXapif_ALL</span> <span class="q">/* %- */</span></li></ol></pre><p>Whether this is being called as <code class="inline"><span class="w">re::regname</span></code>
, <code class="inline"><span class="w">re::regnames</span></code>
 or
<code class="inline"><span class="w">re::regnames_count</span></code>
, if any. The first two will be combined with
<code class="inline"><span class="w">RXapif_ONE</span></code>
 or <code class="inline"><span class="w">RXapif_ALL</span></code>
.</p>
<pre class="verbatim"><ol><li>    <span class="w">RXapif_REGNAME</span></li><li>    <span class="w">RXapif_REGNAMES</span></li><li>    <span class="w">RXapif_REGNAMES_COUNT</span></li></ol></pre><p>Internally <code class="inline"><span class="i">%+</span></code>
 and <code class="inline"><span class="i">%-</span></code>
 are implemented with a real tied interface
via <a href="Tie/Hash/NamedCapture.html">Tie::Hash::NamedCapture</a>. The methods in that package will call
back into these functions. However the usage of
<a href="Tie/Hash/NamedCapture.html">Tie::Hash::NamedCapture</a> for this purpose might change in future
releases. For instance this might be implemented by magic instead
(would need an extension to mgvtbl).</p>
<a class='view-head3' id="named_buff"></a><h4 class='h4' >named_buff</h4>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*     <span class="s">(</span><span class="i">*named_buff</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">SV</span> * <span class="w">const</span> <span class="w">key</span><span class="cm">,</span></li><li>                           <span class="w">SV</span> * <span class="w">const</span> <span class="w">value</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><a class='view-head3' id="named_buff_iter"></a><h4 class='h4' >named_buff_iter</h4>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*     <span class="s">(</span><span class="i">*named_buff_iter</span><span class="s">)</span> <span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">const</span> <span class="w">SV</span> * <span class="w">const</span> <span class="w">lastkey</span><span class="cm">,</span></li><li>                                <span class="w">const</span> <span class="w">U32</span> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><a class='view-head2' id="qr_package"></a><h3 class='h3' >qr_package</h3>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>* <span class="i">qr_package</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The package the qr// magic object is blessed into (as seen by <code class="inline"><a class="l_k" href="functions/ref.html">ref</a>
<span class="q">qr//</span></code>
). It is recommended that engines change this to their package
name for identification regardless of whether they implement methods
on the object.</p>
<p>The package this method returns should also have the internal
<code class="inline"><span class="w">Regexp</span></code>
 package in its <code class="inline"><span class="i">@ISA</span></code>
. <code class="inline"><a class="l_k" href="functions/qr.html">qr//->isa("Regexp")</a></code> should always
be true regardless of what engine is being used.</p>
<p>Example implementation might be:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*</li><li>    <span class="i">Example_qr_package</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="s">)</span></li><li>    <span class="s">{</span></li><li>    	<span class="i">PERL_UNUSED_ARG</span><span class="s">(</span><span class="w">rx</span><span class="s">)</span><span class="sc">;</span></li><li>    	<a class="l_k" href="functions/return.html">return</a> <span class="i">newSVpvs</span><span class="s">(</span><span class="q">&quot;re::engine::Example&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre><p>Any method calls on an object created with <code class="inline"><a class="l_k" href="functions/qr.html">qr//</a></code> will be dispatched to the
package as a normal object.</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">re::engine::Example</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$re</span> = <span class="q">qr//</span><span class="sc">;</span></li><li>    <span class="i">$re</span><span class="i">-&gt;meth</span><span class="sc">;</span> <span class="c"># dispatched to re::engine::Example::meth()</span></li></ol></pre><p>To retrieve the <code class="inline"><span class="w">REGEXP</span></code>
 object from the scalar in an XS function use
the <code class="inline"><span class="w">SvRX</span></code>
 macro, see <a href="perlapi.html#REGEXP-Functions">REGEXP Functions in perlapi</a>.</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span> <span class="i">meth</span><span class="s">(</span><span class="w">SV</span> * <span class="w">rv</span><span class="s">)</span></li><li>    <span class="w">PPCODE</span><span class="co">:</span></li><li>        <span class="w">REGEXP</span> * <span class="w">re</span> = <span class="i">SvRX</span><span class="s">(</span><span class="w">sv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><a class='view-head2' id="dupe"></a><h3 class='h3' >dupe</h3>
<pre class="verbatim"><ol><li>    <span class="w">void</span>* <span class="i">dupe</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">REGEXP</span> * <span class="w">const</span> <span class="w">rx</span><span class="cm">,</span> <span class="w">CLONE_PARAMS</span> *<span class="w">param</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>On threaded builds a regexp may need to be duplicated so that the pattern
can be used by multiple threads. This routine is expected to handle the
duplication of any private data pointed to by the <code class="inline"><span class="w">pprivate</span></code>
 member of
the regexp structure.  It will be called with the preconstructed new
regexp structure as an argument, the <code class="inline"><span class="w">pprivate</span></code>
 member will point at
the <strong>old</strong> private structure, and it is this routine's responsibility to
construct a copy and return a pointer to it (which perl will then use to
overwrite the field as passed to this routine.)</p>
<p>This allows the engine to dupe its private data but also if necessary
modify the final structure if it really must.</p>
<p>On unthreaded builds this field doesn't exist.</p>
<a class='view-head1' id="The-REGEXP-structure"></a><h2 class='h2' >The REGEXP structure</h2>
<p>The REGEXP struct is defined in <i>regexp.h</i>. All regex engines must be able to
correctly build such a structure in their <a href="#comp">comp</a> routine.</p>
<p>The REGEXP structure contains all the data that perl needs to be aware of
to properly work with the regular expression. It includes data about
optimisations that perl can use to determine if the regex engine should
really be used, and various other control info that is needed to properly
execute patterns in various contexts such as is the pattern anchored in
some way, or what flags were used during the compile, or whether the
program contains special constructs that perl needs to be aware of.</p>
<p>In addition it contains two fields that are intended for the private
use of the regex engine that compiled the pattern. These are the
<code class="inline"><span class="w">intflags</span></code>
 and <code class="inline"><span class="w">pprivate</span></code>
 members. <code class="inline"><span class="w">pprivate</span></code>
 is a void pointer to
an arbitrary structure whose use and management is the responsibility
of the compiling engine. perl will never modify either of these
values.</p>
<pre class="verbatim"><ol><li>    <span class="w">typedef</span> <span class="w">struct</span> <span class="i">regexp</span> <span class="s">{</span></li><li>        <span class="q">/* what engine created this regexp? */</span></li><li>        <span class="w">const</span> <span class="w">struct</span> <span class="w">regexp_engine</span>* <span class="w">engine</span><span class="sc">;</span></li><li></li><li>        <span class="q">/* what re is this a lightweight copy of? */</span></li><li>        <span class="w">struct</span> <span class="w">regexp</span>* <span class="w">mother_re</span><span class="sc">;</span></li><li></li><li>        <span class="q">/* Information about the match that the perl core uses to manage things */</span></li><li>        <span class="w">U32</span> <span class="w">extflags</span><span class="sc">;</span>   <span class="q">/* Flags used both externally and internally */</span></li><li>        <span class="w">I32</span> <span class="w">minlen</span><span class="sc">;</span>     <span class="q">/* mininum possible length of string to match */</span></li><li>        <span class="w">I32</span> <span class="w">minlenret</span><span class="sc">;</span>  <span class="q">/* mininum possible length of $&amp; */</span></li><li>        <span class="w">U32</span> <span class="w">gofs</span><span class="sc">;</span>       <span class="q">/* chars left of pos that we search from */</span></li><li></li><li>        /<span class="i">* substring</span> <span class="w">data</span> <span class="w">about</span> <span class="w">strings</span> <span class="w">that</span> <span class="w">must</span> <span class="w">appear</span></li><li>           <span class="w">in</span> <span class="w">the</span> <span class="w">final</span> <span class="w">match</span><span class="cm">,</span> <span class="w">used</span> <a class="l_k" href="functions/for.html">for</a> <span class="w">optimisations</span> *<span class="q">/</span></li><li>        <span class="q">        struct reg_substr_data *substrs;</span></li><li></li><li>        <span class="q">        U32 nparens;  /</span>* <span class="w">number</span> <span class="w">of</span> <span class="w">capture</span> <span class="w">groups</span> *<span class="q">/</span></li><li></li><li>        <span class="q">        /</span>* <span class="w">private</span> <span class="w">engine</span> <span class="w">specific</span> <span class="w">data</span> *<span class="q">/</span></li><li>        <span class="q">        U32 intflags;   /</span>* <span class="w">Engine</span> <span class="w">Specific</span> <span class="w">Internal</span> <span class="w">flags</span> *<span class="q">/</span></li><li>        <span class="q">        void *pprivate; /</span>* <span class="w">Data</span> <span class="w">private</span> <span class="w">to</span> <span class="w">the</span> <span class="w">regex</span> <span class="w">engine</span> <span class="w">which</span> </li><li>                           <span class="w">created</span> <span class="w">this</span> <span class="w">object</span>. <span class="i">*/</span></li><li></li><li>        /<span class="i">* Data</span> <span class="w">about</span> <span class="w">the</span> <a class="l_k" href="functions/last.html">last</a><span class="q">/current match. These are modified during matching*/</span></li><li>        <span class="w">U32</span> <span class="w">lastparen</span><span class="sc">;</span>            <span class="q">/* last open paren matched */</span></li><li>        <span class="w">U32</span> <span class="w">lastcloseparen</span><span class="sc">;</span>       <span class="q">/* last close paren matched */</span></li><li>        <span class="w">regexp_paren_pair</span> *<span class="w">swap</span><span class="sc">;</span>  <span class="q">/* Swap copy of *offs */</span></li><li>        <span class="w">regexp_paren_pair</span> *<span class="w">offs</span><span class="sc">;</span>  <span class="q">/* Array of offsets for (@-) and (@+) */</span></li><li></li><li>        <span class="w">char</span> *<span class="w">subbeg</span><span class="sc">;</span>  <span class="q">/* saved or original string so \digit works forever. */</span></li><li>        <span class="w">SV_SAVED_COPY</span>  <span class="q">/* If non-NULL, SV which is COW from original */</span></li><li>        <span class="w">I32</span> <span class="w">sublen</span><span class="sc">;</span>    <span class="q">/* Length of string pointed by subbeg */</span></li><li></li><li>        /<span class="i">* Information</span> <span class="w">about</span> <span class="w">the</span> <span class="w">match</span> <span class="w">that</span> <span class="w">isn&#39;t</span> <span class="w">often</span> <span class="w">used</span> *<span class="q">/</span></li><li>        <span class="q">        I32 prelen;           /</span>* <a class="l_k" href="functions/length.html">length</a> <span class="w">of</span> <span class="w">precomp</span> *<span class="q">/</span></li><li>        <span class="q">        const char *precomp;  /</span>* <span class="w">pre</span>-<span class="w">compilation</span> <span class="w">regular</span> <span class="w">expression</span> *<span class="q">/</span></li><li></li><li>        <span class="q">        char *wrapped;  /</span>* <span class="w">wrapped</span> <span class="w">version</span> <span class="w">of</span> <span class="w">the</span> <span class="w">pattern</span> *<span class="q">/</span></li><li>        <span class="q">        I32 wraplen;    /</span>* <a class="l_k" href="functions/length.html">length</a> <span class="w">of</span> <span class="w">wrapped</span> *<span class="q">/</span></li><li></li><li>        <span class="q">        I32 seen_evals;   /</span>* <span class="w">number</span> <span class="w">of</span> <a class="l_k" href="functions/eval.html">eval</a> <span class="w">groups</span> <span class="w">in</span> <span class="w">the</span> <span class="w">pattern</span> - <a class="l_k" href="functions/for.html">for</a> <span class="w">security</span> <span class="w">checks</span> *<span class="q">/</span></li><li>        <span class="q">        HV *paren_names;  /</span>* <span class="w">Optional</span> <span class="w">hash</span> <span class="w">of</span> <span class="w">paren</span> <span class="w">names</span> *<span class="q">/</span></li><li></li><li>        <span class="q">        /</span>* <span class="w">Refcount</span> <span class="w">of</span> <span class="w">this</span> <span class="w">regexp</span> *<span class="q">/</span></li><li>        <span class="q">        I32 refcnt;             /</span>* <span class="w">Refcount</span> <span class="w">of</span> <span class="w">this</span> <span class="w">regexp</span> *<span class="q">/</span></li><li>    <span class="q">    } regexp;</span></li></ol></pre><p>The fields are discussed in more detail below:</p>
<a class='view-head2' id="engine"></a><h3 class='h3' ><code class="inline"><span class="w">engine</span></code>
</h3>
<p>This field points at a regexp_engine structure which contains pointers
to the subroutines that are to be used for performing a match. It
is the compiling routine's responsibility to populate this field before
returning the regexp object.</p>
<p>Internally this is set to <code class="inline"><span class="w">NULL</span></code>
 unless a custom engine is specified in
<code class="inline"><span class="i">$^H</span>{<span class="w">regcomp</span>}</code>
, perl's own set of callbacks can be accessed in the struct
pointed to by <code class="inline"><span class="w">RE_ENGINE_PTR</span></code>
.</p>
<a class='view-head2' id="mother_re"></a><h3 class='h3' ><code class="inline"><span class="w">mother_re</span></code>
</h3>
<p>TODO, see <a href="http://www.mail-archive.com/perl5-changes@perl.org/msg17328.html">http://www.mail-archive.com/perl5-changes@perl.org/msg17328.html</a></p>
<a class='view-head2' id="extflags"></a><h3 class='h3' ><code class="inline"><span class="w">extflags</span></code>
</h3>
<p>This will be used by perl to see what flags the regexp was compiled
with, this will normally be set to the value of the flags parameter by
the <a href="#comp">comp</a> callback. See the <a href="#comp">comp</a> documentation for
valid flags.</p>
<a class='view-head2' id="minlen-minlenret"></a><h3 class='h3' ><code class="inline"><span class="w">minlen</span></code>
 <code class="inline"><span class="w">minlenret</span></code>
</h3>
<p>The minimum string length required for the pattern to match.  This is used to
prune the search space by not bothering to match any closer to the end of a
string than would allow a match. For instance there is no point in even
starting the regex engine if the minlen is 10 but the string is only 5
characters long. There is no way that the pattern can match.</p>
<p><code class="inline"><span class="w">minlenret</span></code>
 is the minimum length of the string that would be found
in $&amp; after a match.</p>
<p>The difference between <code class="inline"><span class="w">minlen</span></code>
 and <code class="inline"><span class="w">minlenret</span></code>
 can be seen in the
following pattern:</p>
<pre class="verbatim"><ol><li>    <span class="q">/ns(?=\d)/</span></li></ol></pre><p>where the <code class="inline"><span class="w">minlen</span></code>
 would be 3 but <code class="inline"><span class="w">minlenret</span></code>
 would only be 2 as the \d is
required to match but is not actually included in the matched content. This
distinction is particularly important as the substitution logic uses the
<code class="inline"><span class="w">minlenret</span></code>
 to tell whether it can do in-place substitution which can result in
considerable speedup.</p>
<a class='view-head2' id="gofs"></a><h3 class='h3' ><code class="inline"><span class="w">gofs</span></code>
</h3>
<p>Left offset from pos() to start match at.</p>
<a class='view-head2' id="substrs"></a><h3 class='h3' ><code class="inline"><span class="w">substrs</span></code>
</h3>
<p>Substring data about strings that must appear in the final match. This
is currently only used internally by perl's engine for but might be
used in the future for all engines for optimisations.</p>
<a class='view-head2' id="nparens%2c-lastparen%2c-and-lastcloseparen"></a><h3 class='h3' ><code class="inline"><span class="w">nparens</span></code>
, <code class="inline"><span class="w">lastparen</span></code>
, and <code class="inline"><span class="w">lastcloseparen</span></code>
</h3>
<p>These fields are used to keep track of how many paren groups could be matched
in the pattern, which was the last open paren to be entered, and which was
the last close paren to be entered.</p>
<a class='view-head2' id="intflags"></a><h3 class='h3' ><code class="inline"><span class="w">intflags</span></code>
</h3>
<p>The engine's private copy of the flags the pattern was compiled with. Usually
this is the same as <code class="inline"><span class="w">extflags</span></code>
 unless the engine chose to modify one of them.</p>
<a class='view-head2' id="pprivate"></a><h3 class='h3' ><code class="inline"><span class="w">pprivate</span></code>
</h3>
<p>A void* pointing to an engine-defined data structure. The perl engine uses the
<code class="inline"><span class="w">regexp_internal</span></code>
 structure (see <a href="perlreguts.html#Base-Structures">Base Structures in perlreguts</a>) but a custom
engine should use something else.</p>
<a class='view-head2' id="swap"></a><h3 class='h3' ><code class="inline"><span class="w">swap</span></code>
</h3>
<p>Unused. Left in for compatibility with perl 5.10.0.</p>
<a class='view-head2' id="offs"></a><h3 class='h3' ><code class="inline"><span class="w">offs</span></code>
</h3>
<p>A <code class="inline"><span class="w">regexp_paren_pair</span></code>
 structure which defines offsets into the string being
matched which correspond to the <code class="inline"><span class="i">$&amp;</span></code>
 and <code class="inline"><span class="i">$1</span></code>
, <code class="inline"><span class="i">$2</span></code>
 etc. captures, the
<code class="inline"><span class="w">regexp_paren_pair</span></code>
 struct is defined as follows:</p>
<pre class="verbatim"><ol><li>    <span class="w">typedef</span> <span class="w">struct</span> <span class="i">regexp_paren_pair</span> <span class="s">{</span></li><li>        <span class="w">I32</span> <span class="w">start</span><span class="sc">;</span></li><li>        <span class="w">I32</span> <span class="w">end</span><span class="sc">;</span></li><li>    <span class="s">}</span> <span class="w">regexp_paren_pair</span><span class="sc">;</span></li></ol></pre><p>If <code class="inline"><span class="i">-&gt;offs</span>[<span class="w">num</span>].<span class="w">start</span></code>
 or <code class="inline"><span class="i">-&gt;offs</span>[<span class="w">num</span>].<span class="w">end</span></code>
 is <code class="inline"><span class="n">-1</span></code>
 then that
capture group did not match. <code class="inline"><span class="i">-&gt;offs</span>[<span class="n">0</span>].<span class="w">start</span>/<span class="w">end</span></code>
 represents <code class="inline"><span class="i">$&amp;</span></code>
 (or
<code class="inline"><span class="i">$</span>{<span class="w">^MATCH</span></code>
 under <code class="inline"><span class="q">//p</span></code>
) and <code class="inline"><span class="i">-&gt;offs</span>[<span class="w">paren</span>].<span class="w">end</span></code>
 matches <code class="inline"><span class="i">$$paren</span></code>
 where
<code class="inline"><span class="i">$paren</span> </code>
= 1&gt;.</p>
<a class='view-head2' id="precomp-prelen"></a><h3 class='h3' ><code class="inline"><span class="w">precomp</span></code>
 <code class="inline"><span class="w">prelen</span></code>
</h3>
<p>Used for optimisations. <code class="inline"><span class="w">precomp</span></code>
 holds a copy of the pattern that
was compiled and <code class="inline"><span class="w">prelen</span></code>
 its length. When a new pattern is to be
compiled (such as inside a loop) the internal <code class="inline"><span class="w">regcomp</span></code>
 operator
checks whether the last compiled <code class="inline"><span class="w">REGEXP</span></code>
's <code class="inline"><span class="w">precomp</span></code>
 and <code class="inline"><span class="w">prelen</span></code>

are equivalent to the new one, and if so uses the old pattern instead
of compiling a new one.</p>
<p>The relevant snippet from <code class="inline"><span class="w">Perl_pp_regcomp</span></code>
:</p>
<pre class="verbatim"><ol><li>	<a class="l_k" href="functions/if.html">if</a> <span class="s">(</span>!<span class="w">re</span> || !<span class="w">re</span><span class="w">-&gt;precomp</span> || <span class="w">re</span><span class="w">-&gt;prelen</span> != <span class="s">(</span><span class="w">I32</span><span class="s">)</span><span class="w">len</span> ||</li><li>	    <span class="i">memNE</span><span class="s">(</span><span class="w">re</span><span class="w">-&gt;precomp</span><span class="cm">,</span> <span class="w">t</span><span class="cm">,</span> <span class="w">len</span><span class="s">)</span><span class="s">)</span></li><li>        /<span class="i">* Compile</span> <span class="w">a</span> <span class="w">new</span> <span class="w">pattern</span> *<span class="q">/</span></li></ol></pre><a class='view-head2' id="paren_names"></a><h3 class='h3' ><code class="inline"><span class="w">paren_names</span></code>
</h3>
<p>This is a hash used internally to track named capture groups and their
offsets. The keys are the names of the buffers the values are dualvars,
with the IV slot holding the number of buffers with the given name and the
pv being an embedded array of I32.  The values may also be contained
independently in the data array in cases where named backreferences are
used.</p>
<a class='view-head2' id="substrs"></a><h3 class='h3' ><code class="inline"><span class="w">substrs</span></code>
</h3>
<p>Holds information on the longest string that must occur at a fixed
offset from the start of the pattern, and the longest string that must
occur at a floating offset from the start of the pattern. Used to do
Fast-Boyer-Moore searches on the string to find out if its worth using
the regex engine at all, and if so where in the string to search.</p>
<a class='view-head2' id="subbeg-sublen-saved_copy"></a><h3 class='h3' ><code class="inline"><span class="w">subbeg</span></code>
 <code class="inline"><span class="w">sublen</span></code>
 <code class="inline"><span class="w">saved_copy</span></code>
</h3>
<p>Used during execution phase for managing search and replace patterns.</p>
<a class='view-head2' id="wrapped-wraplen"></a><h3 class='h3' ><code class="inline"><span class="w">wrapped</span></code>
 <code class="inline"><span class="w">wraplen</span></code>
</h3>
<p>Stores the string <code class="inline"><a class="l_k" href="functions/qr.html">qr//</a></code> stringifies to. The perl engine for example
stores <code class="inline"><span class="s">(</span><span class="q">?^:eek)</span></code>
 in the case of <code class="inline"><a class="l_k" href="functions/qr.html">qr/eek/</a></code>.</p>
<p>When using a custom engine that doesn't support the <code class="inline"><span class="s">(</span><span class="q">?:)</span></code>
 construct
for inline modifiers, it's probably best to have <code class="inline"><a class="l_k" href="functions/qr.html">qr//</a></code> stringify to
the supplied pattern, note that this will create undesired patterns in
cases such as:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$x</span> = <span class="q">qr/a|b/</span><span class="sc">;</span>  <span class="c"># &quot;a|b&quot;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$y</span> = <span class="q">qr/c/i</span><span class="sc">;</span>   <span class="c"># &quot;c&quot;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$z</span> = <span class="q">qr/$x$y/</span><span class="sc">;</span> <span class="c"># &quot;a|bc&quot;</span></li></ol></pre><p>There's no solution for this problem other than making the custom
engine understand a construct like <code class="inline"><span class="s">(</span><span class="q">?:)</span></code>
.</p>
<a class='view-head2' id="seen_evals"></a><h3 class='h3' ><code class="inline"><span class="w">seen_evals</span></code>
</h3>
<p>This stores the number of eval groups in the pattern. This is used for security
purposes when embedding compiled regexes into larger patterns with <code class="inline"><a class="l_k" href="functions/qr.html">qr//</a></code>.</p>
<a class='view-head2' id="refcnt"></a><h3 class='h3' ><code class="inline"><span class="w">refcnt</span></code>
</h3>
<p>The number of times the structure is referenced. When this falls to 0 the
regexp is automatically freed by a call to pregfree. This should be set to 1 in
each engine's <a href="#comp">comp</a> routine.</p>
<a class='view-head1' id="HISTORY"></a><h2 class='h2' >HISTORY</h2>
<p>Originally part of <a href="perlreguts.html">perlreguts</a>.</p>
<a class='view-head1' id="AUTHORS"></a><h2 class='h2' >AUTHORS</h2>
<p>Originally written by Yves Orton, expanded by &#xc6;var Arnfj&#xf6;r&#xf0;
Bjarmason.</p>
<a class='view-head1' id="LICENSE"></a><h2 class='h2' >LICENSE</h2>
<p>Copyright 2006 Yves Orton and 2007 &#xc6;var Arnfj&#xf6;r&#xf0; Bjarmason.</p>
<p>This program is free software; you can redistribute it and/or modify it under
the same terms as Perl itself.</p>




      <ul><li><a href="#NAME">NAME</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><li><a href="#Callbacks">Callbacks</a></li><ul><li><a href="#comp">comp</a></li><li><a href="#exec">exec</a></li><li><a href="#intuit">intuit</a></li><li><a href="#checkstr">checkstr</a></li><li><a href="#free">free</a></li><li><a href="#Numbered-capture-callbacks">Numbered capture callbacks</a></li><li><a href="#Named-capture-callbacks">Named capture callbacks</a></li><li><a href="#qr_package">qr_package</a></li><li><a href="#dupe">dupe</a></li></ul><li><a href="#The-REGEXP-structure">The REGEXP structure</a></li><ul><li><a href="#engine">engine</a></li><li><a href="#mother_re">mother_re</a></li><li><a href="#extflags">extflags</a></li><li><a href="#minlen-minlenret">minlen minlenret</a></li><li><a href="#gofs">gofs</a></li><li><a href="#substrs">substrs</a></li><li><a href="#nparens%2c-lastparen%2c-and-lastcloseparen">nparens, lastparen, and lastcloseparen</a></li><li><a href="#intflags">intflags</a></li><li><a href="#pprivate">pprivate</a></li><li><a href="#swap">swap</a></li><li><a href="#offs">offs</a></li><li><a href="#precomp-prelen">precomp prelen</a></li><li><a href="#paren_names">paren_names</a></li><li><a href="#substrs">substrs</a></li><li><a href="#subbeg-sublen-saved_copy">subbeg sublen saved_copy</a></li><li><a href="#wrapped-wraplen">wrapped wraplen</a></li><li><a href="#seen_evals">seen_evals</a></li><li><a href="#refcnt">refcnt</a></li></ul><li><a href="#HISTORY">HISTORY</a></li><li><a href="#AUTHORS">AUTHORS</a></li><li><a href="#LICENSE">LICENSE</a></li></ul>


                  </div>
                </article>
              </div>
            </div>
          </main>
        </div>
           <footer class="footer row bg-light pt-5 pb-5">
       <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
           <div class="row">
               <div class="col-md-4">
                   <ul class="list-unstyled">
                       <li>
                           <h4>Site info</h4>
                       </li>
                       <li>Docs mantained by
                           <a href="//lists.perl.org/list/perl5-porters.html"
                               rel="noopener">Perl 5 Porters</a>
                       </li>
                       <li>Perldoc site development sponsored by
                           <a href="//opusvl.com" rel="noopener">
                           <img style="margin: 20px 20px 5px 10px" class="opus-logo" src="/public/img/opusvl_logo.svg" alt="OpusVL Logo">
                        </a>
                    <li><span class="about_perldoc"><a href="//about.html">About PerlDOC</a></span>
                    </li>
                       </li>
                   </ul>
               </div>
               <div class="col-md-8">
                   <div class="row">
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Manuals</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-overview.html">Overview</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-tutorials.html">Tutorials</a>
                               </li>
                               <li>
                                   <a href="/5.16.0/index-faq.html">FAQs</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-history.html">Changes</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Reference</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-language.html">Language</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-functions.html">Functions</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/perlop.html">Operators</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/perlvar.html">Variables</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Modules</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-modules-A.html">Modules</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-pragmas.html">Pragmas</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-utilities.html">Utilities</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Misc</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-licence.html">License</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-internals.html">Internals</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.0/index-platforms.html">Platforms</a>
                               </li>
                            <li>
                                <a
                                    href="/5.16.0/index-about.html">About</a>
                            </li>
                           </ul>
                       </div>
                   </div>
               </div>
               <div class=" col-12 footer-inf text-center">
                   <small>perldoc.perl.org - Official documentation for the Perl
                       programming language</small>
               </div>
           </div>
       </div>
   </footer>

        	<div class="beta-wrapper beta-bottom-right ">
		<div class="beta beta-blue  ">
			<a class="beta-link "
				href="//github.com/OpusVL/perldoc.perl.org/issues/new" rel="noopener">
				<span class="beta-text">
					This website is a Beta release.
				</span>
				<span class="beta-text">
					For any issues please raise a ticket on GitHub
				</span>
			</a>
		</div>
	</div>

        <script src="/public/js/main.min.js"></script>
      </body>

      </html>
