      
      
      
      

      <!DOCTYPE html>
      <html lang="en">

      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="perlguts - perldoc.perl.org">
        <link rel="icon" href="/public/img/favicon.ico">
        <title>perlguts - perldoc.perl.org</title>
        <link href="/public/css/main.min.css" rel="stylesheet">
        <link rel="canonical" href="/perlguts.html">
        <link
          href='https://fonts.googleapis.com/css?family=Lato:400,100,300,700,900'
          rel='stylesheet' type='text/css'>
        <script>
          window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments)
          };
          ga.l = +new Date;
          ga('create', 'UA-1892152-2', 'auto'); // JJ's account
          ga('create', 'UA-50555-3', 'auto', 'perlOrg'); // perl.org account
          ga('require', 'outboundLinkTracker', {
            events: ['click', 'auxclick', 'contextmenu'],
          });
          ga('require', 'maxScrollTracker');
          ga('send', 'pageview');
          ga('perlOrg.send', 'pageview');
        </script>
        <script async src="https://www.google-analytics.com/analytics.js">
        </script>
        <script async src="/public/js/tracking.min.js"></script>
      </head>

      <body class="body container-fluid ">
        <div class="wrapper">

          <nav
    class="navbar navbar-dark bg-primary bg-perl fixed-top justify-content-between navbar-expand-lg">
    <a href="#content" class="skippy sr-only sr-only-focusable">
        <span class=' skippy-text'>Skip to main content</span>
    </a>
    <a class="navbar-brand" href="/">
        <img class="logo" src="/public/img/logo_perl_doc.svg"
            alt="Perl Documentation Logo" />
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
        data-target="#navbar" aria-controls="navbar" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbar" class="collapse navbar-collapse ">
        <ul class="navbar-nav ml-auto navbar-right">
            <form class="nav-item dropdown search-wrapper">
                <input type="text" id='searchinput' aria-describedby='navbarDropdown5'
                    placeholder="Type query" class='search-input-field' value=''>

                <button href="#" data-toggle='dropdown' type="button"
                    aria-haspopup="true" aria-expanded='false' id="navbarDropdown5"
                    class="nav-link dropdown-toggle search-link">
                    <object tabindex='-1' focusable="false" class='search-icon'
                        data="/public/img/search.svg" type="image/svg+xml"
                        name='search icon'>search
                        icon</object>
                </button>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown5"
                    id='search-results'>
                    <p class='dropdown-item major-version'>
                        No results
                    </p>
                </div>
            </form>
            <li class="nav-item dropdown">
                <a id="navbarDropdown" href="#" class="nav-link dropdown-toggle"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Perl versions</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    
                        <p class='dropdown-item major-version'>
                            5.32
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.32.0/">5.32.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.30
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.30.3/">5.30.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.2/">5.30.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.1/">5.30.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.0/">5.30.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.28
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.28.3/">5.28.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.2/">5.28.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.1/">5.28.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.0/">5.28.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.26
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.26.3/">5.26.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.2/">5.26.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.1/">5.26.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.0/">5.26.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.24
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.24.4/">5.24.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.3/">5.24.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.2/">5.24.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.1/">5.24.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.0/">5.24.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.22
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.22.4/">5.22.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.3/">5.22.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.2/">5.22.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.1/">5.22.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.0/">5.22.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.20
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.20.3/">5.20.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.2/">5.20.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.1/">5.20.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.0/">5.20.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.18
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.18.4/">5.18.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.3/">5.18.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.2/">5.18.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.1/">5.18.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.0/">5.18.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.16
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.16.3/">5.16.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.2/">5.16.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.1/">5.16.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.0/">5.16.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.14
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.14.4/">5.14.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.3/">5.14.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.2/">5.14.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.1/">5.14.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.0/">5.14.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.12
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.12.5/">5.12.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.4/">5.12.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.3/">5.12.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.2/">5.12.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.1/">5.12.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.0/">5.12.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.10
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.10.1/">5.10.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.10.0/">5.10.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.8
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.8.9/">5.8.9</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.8/">5.8.8</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.7/">5.8.7</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.6/">5.8.6</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.5/">5.8.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.4/">5.8.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.3/">5.8.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.2/">5.8.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.1/">5.8.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.0/">5.8.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.6
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.6.2/">5.6.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.1/">5.6.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.0/">5.6.0</a>
                        
                        
                    
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown1" href="#" class="dropdown-toggle nav-link"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Manuals</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown1">
                    <a class="dropdown-item"
                        href="/5.6.0/index-overview.html">Overview</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-tutorials.html">Tutorials</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-faq.html">FAQs</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-history.html">Changes</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-licence.html">License</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-language.html">Language</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-functions.html">Functions</a>
                    <a class="dropdown-item"
                        href="/5.6.0/perlop.html">Operators</a>
                    <a class="dropdown-item"
                        href="/5.6.0/perlvar.html">Variables</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-pragmas.html">Pragmas</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-utilities.html">Utilities</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-internals.html">Internals</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-platforms.html">Platforms</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown3" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Modules</a>
                <div aria-labelledby="navbarDropdown3"
                    class="dropdown-menu letters-wrap">
                    <!--<a class="dropdown-item"
                        href="/5.6.0/index-modules.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-modules-by-cat.html">By
                        Category</a>-->
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-A.html">A</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-B.html">B</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-C.html">C</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-D.html">D</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-E.html">E</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-F.html">F</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-G.html">G</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-H.html">H</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-I.html">I</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-J.html">J</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-K.html">K</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-L.html">L</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-M.html">M</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-N.html">N</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-O.html">O</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-P.html">P</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-Q.html">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-R.html">R</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-S.html">S</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-T.html">T</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-U.html">U</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-V.html">V</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-W.html">W</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-X.html">X</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-Y.html">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-modules-Z.html">Z</a>
                    </div>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown4" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Functions</a>
                <div aria-labelledby="navbarDropdown4"
                    class="dropdown-menu letters-wrap">
                    <a class="dropdown-item"
                        href="/5.6.0/index-functions.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.6.0/index-functions-by-cat.html">By
                        Category</a>
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#A">A</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#B">B</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#C">C</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#D">D</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#E">E</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#F">F</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#G">G</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#H">H</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#I">I</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#J">J</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#K">K</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#L">L</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#M">M</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#N">N</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#O">O</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#P">P</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#Q">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#R">R</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#S">S</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#T">T</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#U">U</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#V">V</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#W">W</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#X">X</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#Y">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.6.0/index-functions.html#Z">Z</a>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <!--/.nav-collapse -->
</nav>


          <main class="row main-content pb-5 pt-5" id='content'>
            <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
              <div class="row">
                <div class="col-sm-12">
                  <div id="breadcrumbs">
                      
    <a href="index.html">Home</a>&nbsp; &gt;
    
      
        <a href="index-internals.html">Internals and C language interface</a> &gt;
      
    
    perlguts
  

                  </div>
                </div>
              </div>
              <div class="row">
                <article class="col-sm-12 content">
                  <div class="documentation-wrapper">
                    <div id="perl_version">
                      <h7 class='page-title'> Perl 5 version 6.0
                        documentation</h7>
                    </div>
                    <h1>perlguts</h1>


  <!--    -->
<ul><li><a href="#NAME">NAME</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><li><a href="#Variables">Variables</a></li><ul><li><a href="#Datatypes">Datatypes</a></li><li><a href="#What-is-an-%22IV%22%3f">What is an "IV"?</a></li><li><a href="#Working-with-SVs">Working with SVs</a></li><li><a href="#What's-Really-Stored-in-an-SV%3f">What's Really Stored in an SV?</a></li><li><a href="#Working-with-AVs">Working with AVs</a></li><li><a href="#Working-with-HVs">Working with HVs</a></li><li><a href="#Hash-API-Extensions">Hash API Extensions</a></li><li><a href="#References">References</a></li><li><a href="#Blessed-References-and-Class-Objects">Blessed References and Class Objects</a></li><li><a href="#Creating-New-Variables">Creating New Variables</a></li><li><a href="#Reference-Counts-and-Mortality">Reference Counts and Mortality</a></li><li><a href="#Stashes-and-Globs">Stashes and Globs</a></li><li><a href="#Double-Typed-SVs">Double-Typed SVs</a></li><li><a href="#Magic-Variables">Magic Variables</a></li><li><a href="#Assigning-Magic">Assigning Magic</a></li><li><a href="#Magic-Virtual-Tables">Magic Virtual Tables</a></li><li><a href="#Finding-Magic">Finding Magic</a></li><li><a href="#Understanding-the-Magic-of-Tied-Hashes-and-Arrays">Understanding the Magic of Tied Hashes and Arrays</a></li><li><a href="#Localizing-changes">Localizing changes</a></li></ul><li><a href="#Subroutines">Subroutines</a></li><ul><li><a href="#XSUBs-and-the-Argument-Stack">XSUBs and the Argument Stack</a></li><li><a href="#Calling-Perl-Routines-from-within-C-Programs">Calling Perl Routines from within C Programs</a></li><li><a href="#Memory-Allocation">Memory Allocation</a></li><li><a href="#PerlIO">PerlIO</a></li><li><a href="#Putting-a-C-value-on-Perl-stack">Putting a C value on Perl stack</a></li><li><a href="#Scratchpads">Scratchpads</a></li><li><a href="#Scratchpads-and-recursion">Scratchpads and recursion</a></li></ul><li><a href="#Compiled-code">Compiled code</a></li><ul><li><a href="#Code-tree">Code tree</a></li><li><a href="#Examining-the-tree">Examining the tree</a></li><li><a href="#Compile-pass-1%3a-check-routines">Compile pass 1: check routines</a></li><li><a href="#Compile-pass-1a%3a-constant-folding">Compile pass 1a: constant folding</a></li><li><a href="#Compile-pass-2%3a-context-propagation">Compile pass 2: context propagation</a></li><li><a href="#Compile-pass-3%3a-peephole-optimization">Compile pass 3: peephole optimization</a></li></ul><li><a href="#How-multiple-interpreters-and-concurrency-are-supported">How multiple interpreters and concurrency are supported</a></li><ul><li><a href="#Background-and-PERL_IMPLICIT_CONTEXT">Background and PERL_IMPLICIT_CONTEXT</a></li><li><a href="#How-do-I-use-all-this-in-extensions%3f">How do I use all this in extensions?</a></li><li><a href="#Future-Plans-and-PERL_IMPLICIT_SYS">Future Plans and PERL_IMPLICIT_SYS</a></li></ul><li><a href="#AUTHORS">AUTHORS</a></li><li><a href="#SEE-ALSO">SEE ALSO</a></li></ul><a class='view-head1' id="NAME"></a><h2 class='h2' >NAME</h2>
<p>perlguts - Introduction to the Perl API</p>
<a class='view-head1' id="DESCRIPTION"></a><h2 class='h2' >DESCRIPTION</h2>
<p>This document attempts to describe how to use the Perl API, as well as containing 
some info on the basic workings of the Perl core. It is far from complete 
and probably contains many errors. Please refer any questions or 
comments to the author below.</p>
<a class='view-head1' id="Variables"></a><h2 class='h2' >Variables</h2>
<a class='view-head2' id="Datatypes"></a><h3 class='h3' >Datatypes</h3>
<p>Perl has three typedefs that handle Perl's three main data types:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>  <span class="w">Scalar</span> <span class="w">Value</span></li><li>    <span class="w">AV</span>  <span class="w">Array</span> <span class="w">Value</span></li><li>    <span class="w">HV</span>  <span class="w">Hash</span> <span class="w">Value</span></li></ol></pre><p>Each typedef has specific routines that manipulate the various data types.</p>
<a class='view-head2' id="What-is-an-%22IV%22%3f"></a><h3 class='h3' >What is an "IV"?</h3>
<p>Perl uses a special typedef IV which is a simple signed integer type that is
guaranteed to be large enough to hold a pointer (as well as an integer).
Additionally, there is the UV, which is simply an unsigned IV.</p>
<p>Perl also uses two special typedefs, I32 and I16, which will always be at
least 32-bits and 16-bits long, respectively. (Again, there are U32 and U16,
as well.)</p>
<a class='view-head2' id="Working-with-SVs"></a><h3 class='h3' >Working with SVs</h3>
<p>An SV can be created and loaded with one command.  There are four types of
values that can be loaded: an integer value (IV), a double (NV), a string,
(PV), and another scalar (SV).</p>
<p>The six routines are:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*  <span class="i">newSViv</span><span class="s">(</span><span class="w">IV</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>*  <span class="i">newSVnv</span><span class="s">(</span><span class="w">double</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>*  <span class="i">newSVpv</span><span class="s">(</span><span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>*  <span class="i">newSVpvn</span><span class="s">(</span><span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>*  <span class="i">newSVpvf</span><span class="s">(</span><span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> ...<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>*  <span class="i">newSVsv</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span><span class="sc">;</span></li></ol></pre><p>To change the value of an *already-existing* SV, there are seven routines:</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span>  <span class="i">sv_setiv</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">IV</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_setuv</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">UV</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_setnv</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">double</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_setpv</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>*<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_setpvn</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a><span class="s">)</span></li><li>    <span class="w">void</span>  <span class="i">sv_setpvf</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> ...<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_setpvfn</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> <span class="w">STRLEN</span><span class="cm">,</span> <span class="w">va_list</span> *<span class="cm">,</span> <span class="w">SV</span> **<span class="cm">,</span> <span class="w">I32</span><span class="cm">,</span> <span class="w">bool</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_setsv</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">SV</span>*<span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Notice that you can choose to specify the length of the string to be
assigned by using <code class="inline"><span class="w">sv_setpvn</span></code>
, <code class="inline"><span class="w">newSVpvn</span></code>
, or <code class="inline"><span class="w">newSVpv</span></code>
, or you may
allow Perl to calculate the length by using <code class="inline"><span class="w">sv_setpv</span></code>
 or by specifying
0 as the second argument to <code class="inline"><span class="w">newSVpv</span></code>
.  Be warned, though, that Perl will
determine the string's length by using <code class="inline"><span class="w">strlen</span></code>
, which depends on the
string terminating with a NUL character.</p>
<p>The arguments of <code class="inline"><span class="w">sv_setpvf</span></code>
 are processed like <code class="inline"><a class="l_k" href="functions/sprintf.html">sprintf</a></code>, and the
formatted output becomes the value.</p>
<p><code class="inline"><span class="w">sv_setpvfn</span></code>
 is an analogue of <code class="inline"><span class="w">vsprintf</span></code>
, but it allows you to specify
either a pointer to a variable argument list or the address and length of
an array of SVs.  The last argument points to a boolean; on return, if that
boolean is true, then locale-specific information has been used to format
the string, and the string's contents are therefore untrustworthy (see
<a href="perlsec.html">perlsec</a>).  This pointer may be NULL if that information is not
important.  Note that this function requires you to specify the length of
the format.</p>
<p>The <code class="inline"><span class="w">sv_set</span>*<span class="s">(</span><span class="s">)</span></code>
 functions are not generic enough to operate on values
that have "magic".  See <a href="#Magic-Virtual-Tables">Magic Virtual Tables</a> later in this document.</p>
<p>All SVs that contain strings should be terminated with a NUL character.
If it is not NUL-terminated there is a risk of
core dumps and corruptions from code which passes the string to C
functions or system calls which expect a NUL-terminated string.
Perl's own functions typically add a trailing NUL for this reason.
Nevertheless, you should be very careful when you pass a string stored
in an SV to a C function or system call.</p>
<p>To access the actual value that an SV points to, you can use the macros:</p>
<pre class="verbatim"><ol><li>    <span class="i">SvIV</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li><li>    <span class="i">SvUV</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li><li>    <span class="i">SvNV</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li><li>    <span class="i">SvPV</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">STRLEN</span> <span class="w">len</span><span class="s">)</span></li><li>    <span class="i">SvPV_nolen</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>which will automatically coerce the actual scalar type into an IV, UV, double,
or string.</p>
<p>In the <code class="inline"><span class="w">SvPV</span></code>
 macro, the length of the string returned is placed into the
variable <code class="inline"><span class="w">len</span></code>
 (this is a macro, so you do <i>not</i> use <code class="inline"><span class="i">&amp;len</span></code>
).  If you do
not care what the length of the data is, use the <code class="inline"><span class="w">SvPV_nolen</span></code>
 macro.
Historically the <code class="inline"><span class="w">SvPV</span></code>
 macro with the global variable <code class="inline"><span class="w">PL_na</span></code>
 has been
used in this case.  But that can be quite inefficient because <code class="inline"><span class="w">PL_na</span></code>
 must
be accessed in thread-local storage in threaded Perl.  In any case, remember
that Perl allows arbitrary strings of data that may both contain NULs and
might not be terminated by a NUL.</p>
<p>Also remember that C doesn't allow you to safely say <code class="inline"><span class="i">foo</span><span class="s">(</span><span class="i">SvPV</span><span class="s">(</span><span class="q">s, len),</span>
<span class="q">len);</span></code>
. It might work with your compiler, but it won't work for everyone.
Break this sort of statement up into separate assignments:</p>
<pre class="verbatim"><ol><li>	<span class="w">SV</span> *<span class="q">s;</span></li><li>	<span class="q">	STRLEN len;</span></li><li>	<span class="q">	char * ptr;</span></li><li>	<span class="w">ptr</span> = <span class="i">SvPV</span><span class="s">(</span><span class="q">s, len);</span></li><li>	<span class="q">	foo(ptr, len);</span></li></ol></pre><p>If you want to know if the scalar value is TRUE, you can use:</p>
<pre class="verbatim"><ol><li>    <span class="i">SvTRUE</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>Although Perl will automatically grow strings for you, if you need to force
Perl to allocate more memory for your SV, you can use the macro</p>
<pre class="verbatim"><ol><li>    <span class="i">SvGROW</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">STRLEN</span> <span class="w">newlen</span><span class="s">)</span></li></ol></pre><p>which will determine if more memory needs to be allocated.  If so, it will
call the function <code class="inline"><span class="w">sv_grow</span></code>
.  Note that <code class="inline"><span class="w">SvGROW</span></code>
 can only increase, not
decrease, the allocated memory of an SV and that it does not automatically
add a byte for the a trailing NUL (perl's own string functions typically do
<code class="inline"><span class="i">SvGROW</span><span class="s">(</span><span class="w">sv</span><span class="cm">,</span> <span class="w">len</span> + <span class="n">1</span><span class="s">)</span></code>
).</p>
<p>If you have an SV and want to know what kind of data Perl thinks is stored
in it, you can use the following macros to check the type of SV you have.</p>
<pre class="verbatim"><ol><li>    <span class="i">SvIOK</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li><li>    <span class="i">SvNOK</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li><li>    <span class="i">SvPOK</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>You can get and set the current length of the string stored in an SV with
the following macros:</p>
<pre class="verbatim"><ol><li>    <span class="i">SvCUR</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li><li>    <span class="i">SvCUR_set</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">I32</span> <span class="w">val</span><span class="s">)</span></li></ol></pre><p>You can also get a pointer to the end of the string stored in the SV
with the macro:</p>
<pre class="verbatim"><ol><li>    <span class="i">SvEND</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>But note that these last three macros are valid only if <code class="inline"><span class="i">SvPOK</span><span class="s">(</span><span class="s">)</span></code>
 is true.</p>
<p>If you want to append something to the end of string stored in an <code class="inline"><span class="w">SV</span>*</code>
,
you can use the following functions:</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span>  <span class="i">sv_catpv</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>*<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_catpvn</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> <span class="w">STRLEN</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_catpvf</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> ...<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_catpvfn</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> <span class="w">STRLEN</span><span class="cm">,</span> <span class="w">va_list</span> *<span class="cm">,</span> <span class="w">SV</span> **<span class="cm">,</span> <span class="w">I32</span><span class="cm">,</span> <span class="w">bool</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">sv_catsv</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">SV</span>*<span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The first function calculates the length of the string to be appended by
using <code class="inline"><span class="w">strlen</span></code>
.  In the second, you specify the length of the string
yourself.  The third function processes its arguments like <code class="inline"><a class="l_k" href="functions/sprintf.html">sprintf</a></code> and
appends the formatted output.  The fourth function works like <code class="inline"><span class="w">vsprintf</span></code>
.
You can specify the address and length of an array of SVs instead of the
va_list argument. The fifth function extends the string stored in the first
SV with the string stored in the second SV.  It also forces the second SV
to be interpreted as a string.</p>
<p>The <code class="inline"><span class="w">sv_cat</span>*<span class="s">(</span><span class="s">)</span></code>
 functions are not generic enough to operate on values that
have "magic".  See <a href="#Magic-Virtual-Tables">Magic Virtual Tables</a> later in this document.</p>
<p>If you know the name of a scalar variable, you can get a pointer to its SV
by using the following:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*  <span class="i">get_sv</span><span class="s">(</span><span class="q">&quot;package::varname&quot;</span><span class="cm">,</span> <span class="w">FALSE</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>This returns NULL if the variable does not exist.</p>
<p>If you want to know if this variable (or any other SV) is actually <code class="inline"><a class="l_k" href="functions/defined.html">defined</a></code>,
you can call:</p>
<pre class="verbatim"><ol><li>    <span class="i">SvOK</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>The scalar <code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code> value is stored in an SV instance called <code class="inline"><span class="w">PL_sv_undef</span></code>
.  Its
address can be used whenever an <code class="inline"><span class="w">SV</span>*</code>
 is needed.</p>
<p>There are also the two values <code class="inline"><span class="w">PL_sv_yes</span></code>
 and <code class="inline"><span class="w">PL_sv_no</span></code>
, which contain Boolean
TRUE and FALSE values, respectively.  Like <code class="inline"><span class="w">PL_sv_undef</span></code>
, their addresses can
be used whenever an <code class="inline"><span class="w">SV</span>*</code>
 is needed.</p>
<p>Do not be fooled into thinking that <code class="inline"><span class="s">(</span><span class="w">SV</span> *<span class="s">)</span> <span class="n">0</span></code>
 is the same as <code class="inline"><span class="i">&amp;PL_sv_undef</span></code>
.
Take this code:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>* <span class="w">sv</span> = <span class="s">(</span><span class="w">SV</span>*<span class="s">)</span> <span class="n">0</span><span class="sc">;</span></li><li>    if <span class="s">(</span><span class="w">I</span>-<span class="w">am</span>-<span class="w">to</span>-<a class="l_k" href="functions/return.html">return</a>-<span class="w">a</span>-<span class="w">real</span>-<span class="w">value</span><span class="s">)</span> <span class="s">{</span></li><li>            <span class="w">sv</span> = <span class="i">sv_2mortal</span><span class="s">(</span><span class="i">newSViv</span><span class="s">(</span><span class="n">42</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="s">}</span></li><li>    <span class="i">sv_setsv</span><span class="s">(</span><span class="i">ST</span><span class="s">(</span><span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="w">sv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>This code tries to return a new SV (which contains the value 42) if it should
return a real value, or undef otherwise.  Instead it has returned a NULL
pointer which, somewhere down the line, will cause a segmentation violation,
bus error, or just weird results.  Change the zero to <code class="inline"><span class="i">&amp;PL_sv_undef</span></code>
 in the first
line and all will be well.</p>
<p>To free an SV that you've created, call <code class="inline"><span class="i">SvREFCNT_dec</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></code>
.  Normally this
call is not necessary (see <a href="#Reference-Counts-and-Mortality">Reference Counts and Mortality</a>).</p>
<a class='view-head2' id="What's-Really-Stored-in-an-SV%3f"></a><h3 class='h3' >What's Really Stored in an SV?</h3>
<p>Recall that the usual method of determining the type of scalar you have is
to use <code class="inline"><span class="w">Sv</span>*<span class="w">OK</span></code>
 macros.  Because a scalar can be both a number and a string,
usually these macros will always return TRUE and calling the <code class="inline"><span class="w">Sv</span>*<span class="w">V</span></code>

macros will do the appropriate conversion of string to integer/double or
integer/double to string.</p>
<p>If you <i>really</i> need to know if you have an integer, double, or string
pointer in an SV, you can use the following three macros instead:</p>
<pre class="verbatim"><ol><li>    <span class="i">SvIOKp</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li><li>    <span class="i">SvNOKp</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li><li>    <span class="i">SvPOKp</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>These will tell you if you truly have an integer, double, or string pointer
stored in your SV.  The "p" stands for private.</p>
<p>In general, though, it's best to use the <code class="inline"><span class="w">Sv</span>*<span class="w">V</span></code>
 macros.</p>
<a class='view-head2' id="Working-with-AVs"></a><h3 class='h3' >Working with AVs</h3>
<p>There are two ways to create and load an AV.  The first method creates an
empty AV:</p>
<pre class="verbatim"><ol><li>    <span class="w">AV</span>*  <span class="i">newAV</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The second method both creates the AV and initially populates it with SVs:</p>
<pre class="verbatim"><ol><li>    <span class="w">AV</span>*  <span class="i">av_make</span><span class="s">(</span><span class="w">I32</span> <span class="w">num</span><span class="cm">,</span> <span class="w">SV</span> **<span class="w">ptr</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The second argument points to an array containing <code class="inline"><span class="w">num</span></code>
 <code class="inline"><span class="w">SV</span>*</code>
's.  Once the
AV has been created, the SVs can be destroyed, if so desired.</p>
<p>Once the AV has been created, the following operations are possible on AVs:</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span>  <span class="i">av_push</span><span class="s">(</span><span class="w">AV</span>*<span class="cm">,</span> <span class="w">SV</span>*<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>*   <span class="i">av_pop</span><span class="s">(</span><span class="w">AV</span>*<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>*   <span class="i">av_shift</span><span class="s">(</span><span class="w">AV</span>*<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">av_unshift</span><span class="s">(</span><span class="w">AV</span>*<span class="cm">,</span> <span class="w">I32</span> <span class="w">num</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>These should be familiar operations, with the exception of <code class="inline"><span class="w">av_unshift</span></code>
.
This routine adds <code class="inline"><span class="w">num</span></code>
 elements at the front of the array with the <code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code>
value.  You must then use <code class="inline"><span class="w">av_store</span></code>
 (described below) to assign values
to these new elements.</p>
<p>Here are some other functions:</p>
<pre class="verbatim"><ol><li>    <span class="w">I32</span>   <span class="i">av_len</span><span class="s">(</span><span class="w">AV</span>*<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>**  <span class="i">av_fetch</span><span class="s">(</span><span class="w">AV</span>*<span class="cm">,</span> <span class="w">I32</span> <span class="w">key</span><span class="cm">,</span> <span class="w">I32</span> <span class="w">lval</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>**  <span class="i">av_store</span><span class="s">(</span><span class="w">AV</span>*<span class="cm">,</span> <span class="w">I32</span> <span class="w">key</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">val</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The <code class="inline"><span class="w">av_len</span></code>
 function returns the highest index value in array (just
like $#array in Perl).  If the array is empty, -1 is returned.  The
<code class="inline"><span class="w">av_fetch</span></code>
 function returns the value at index <code class="inline"><span class="w">key</span></code>
, but if <code class="inline"><span class="w">lval</span></code>

is non-zero, then <code class="inline"><span class="w">av_fetch</span></code>
 will store an undef value at that index.
The <code class="inline"><span class="w">av_store</span></code>
 function stores the value <code class="inline"><span class="w">val</span></code>
 at index <code class="inline"><span class="w">key</span></code>
, and does
not increment the reference count of <code class="inline"><span class="w">val</span></code>
.  Thus the caller is responsible
for taking care of that, and if <code class="inline"><span class="w">av_store</span></code>
 returns NULL, the caller will
have to decrement the reference count to avoid a memory leak.  Note that
<code class="inline"><span class="w">av_fetch</span></code>
 and <code class="inline"><span class="w">av_store</span></code>
 both return <code class="inline"><span class="w">SV</span>**</code>
's, not <code class="inline"><span class="w">SV</span>*</code>
's as their
return value.</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span>  <span class="i">av_clear</span><span class="s">(</span><span class="w">AV</span>*<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">av_undef</span><span class="s">(</span><span class="w">AV</span>*<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>  <span class="i">av_extend</span><span class="s">(</span><span class="w">AV</span>*<span class="cm">,</span> <span class="w">I32</span> <span class="w">key</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The <code class="inline"><span class="w">av_clear</span></code>
 function deletes all the elements in the AV* array, but
does not actually delete the array itself.  The <code class="inline"><span class="w">av_undef</span></code>
 function will
delete all the elements in the array plus the array itself.  The
<code class="inline"><span class="w">av_extend</span></code>
 function extends the array so that it contains at least <code class="inline"><span class="w">key</span>+<span class="n">1</span></code>

elements.  If <code class="inline"><span class="w">key</span>+<span class="n">1</span></code>
 is less than the currently allocated length of the array,
then nothing is done.</p>
<p>If you know the name of an array variable, you can get a pointer to its AV
by using the following:</p>
<pre class="verbatim"><ol><li>    <span class="w">AV</span>*  <span class="i">get_av</span><span class="s">(</span><span class="q">&quot;package::varname&quot;</span><span class="cm">,</span> <span class="w">FALSE</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>This returns NULL if the variable does not exist.</p>
<p>See <a href="#Understanding-the-Magic-of-Tied-Hashes-and-Arrays">Understanding the Magic of Tied Hashes and Arrays</a> for more
information on how to use the array access functions on tied arrays.</p>
<a class='view-head2' id="Working-with-HVs"></a><h3 class='h3' >Working with HVs</h3>
<p>To create an HV, you use the following routine:</p>
<pre class="verbatim"><ol><li>    <span class="w">HV</span>*  <span class="i">newHV</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Once the HV has been created, the following operations are possible on HVs:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>**  <span class="i">hv_store</span><span class="s">(</span><span class="w">HV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">key</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">klen</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">val</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">hash</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>**  <span class="i">hv_fetch</span><span class="s">(</span><span class="w">HV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">key</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">klen</span><span class="cm">,</span> <span class="w">I32</span> <span class="w">lval</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The <code class="inline"><span class="w">klen</span></code>
 parameter is the length of the key being passed in (Note that
you cannot pass 0 in as a value of <code class="inline"><span class="w">klen</span></code>
 to tell Perl to measure the
length of the key).  The <code class="inline"><span class="w">val</span></code>
 argument contains the SV pointer to the
scalar being stored, and <code class="inline"><span class="w">hash</span></code>
 is the precomputed hash value (zero if
you want <code class="inline"><span class="w">hv_store</span></code>
 to calculate it for you).  The <code class="inline"><span class="w">lval</span></code>
 parameter
indicates whether this fetch is actually a part of a store operation, in
which case a new undefined value will be added to the HV with the supplied
key and <code class="inline"><span class="w">hv_fetch</span></code>
 will return as if the value had already existed.</p>
<p>Remember that <code class="inline"><span class="w">hv_store</span></code>
 and <code class="inline"><span class="w">hv_fetch</span></code>
 return <code class="inline"><span class="w">SV</span>**</code>
's and not just
<code class="inline"><span class="w">SV</span>*</code>
.  To access the scalar value, you must first dereference the return
value.  However, you should check to make sure that the return value is
not NULL before dereferencing it.</p>
<p>These two functions check if a hash table entry exists, and deletes it.</p>
<pre class="verbatim"><ol><li>    <span class="w">bool</span>  <span class="i">hv_exists</span><span class="s">(</span><span class="w">HV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">key</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">klen</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>*   <span class="i">hv_delete</span><span class="s">(</span><span class="w">HV</span>*<span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">key</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">klen</span><span class="cm">,</span> <span class="w">I32</span> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>If <code class="inline"><span class="w">flags</span></code>
 does not include the <code class="inline"><span class="w">G_DISCARD</span></code>
 flag then <code class="inline"><span class="w">hv_delete</span></code>
 will
create and return a mortal copy of the deleted value.</p>
<p>And more miscellaneous functions:</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span>   <span class="i">hv_clear</span><span class="s">(</span><span class="w">HV</span>*<span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span>   <span class="i">hv_undef</span><span class="s">(</span><span class="w">HV</span>*<span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Like their AV counterparts, <code class="inline"><span class="w">hv_clear</span></code>
 deletes all the entries in the hash
table but does not actually delete the hash table.  The <code class="inline"><span class="w">hv_undef</span></code>
 deletes
both the entries and the hash table itself.</p>
<p>Perl keeps the actual data in linked list of structures with a typedef of HE.
These contain the actual key and value pointers (plus extra administrative
overhead).  The key is a string pointer; the value is an <code class="inline"><span class="w">SV</span>*</code>
.  However,
once you have an <code class="inline"><span class="w">HE</span>*</code>
, to get the actual key and value, use the routines
specified below.</p>
<pre class="verbatim"><ol><li>    <span class="w">I32</span>    <span class="i">hv_iterinit</span><span class="s">(</span><span class="w">HV</span>*<span class="s">)</span><span class="sc">;</span></li><li>            <span class="q">/* Prepares starting point to traverse hash table */</span></li><li>    <span class="w">HE</span>*    <span class="i">hv_iternext</span><span class="s">(</span><span class="w">HV</span>*<span class="s">)</span><span class="sc">;</span></li><li>            <span class="q">/* Get the next entry, and return a pointer to a</span></li><li>               <span class="q">               structure that has both the key and value */</span></li><li>    <span class="w">char</span>*  <span class="i">hv_iterkey</span><span class="s">(</span><span class="w">HE</span>* <span class="w">entry</span><span class="cm">,</span> <span class="w">I32</span>* <span class="w">retlen</span><span class="s">)</span><span class="sc">;</span></li><li>            <span class="q">/* Get the key from an HE structure and also return</span></li><li>               <span class="q">               the length of the key string */</span></li><li>    <span class="w">SV</span>*    <span class="i">hv_iterval</span><span class="s">(</span><span class="w">HV</span>*<span class="cm">,</span> <span class="w">HE</span>* <span class="w">entry</span><span class="s">)</span><span class="sc">;</span></li><li>            <span class="q">/* Return a SV pointer to the value of the HE</span></li><li>               <span class="q">               structure */</span></li><li>    <span class="w">SV</span>*    <span class="i">hv_iternextsv</span><span class="s">(</span><span class="w">HV</span>*<span class="cm">,</span> <span class="w">char</span>** <span class="w">key</span><span class="cm">,</span> <span class="w">I32</span>* <span class="w">retlen</span><span class="s">)</span><span class="sc">;</span></li><li>            <span class="q">/* This convenience routine combines hv_iternext,</span></li><li>	       <span class="q">	       hv_iterkey, and hv_iterval.  The key and retlen</span></li><li>	       <span class="q">	       arguments are return values for the key and its</span></li><li>	       <span class="q">	       length.  The value is returned in the SV* argument */</span></li></ol></pre><p>If you know the name of a hash variable, you can get a pointer to its HV
by using the following:</p>
<pre class="verbatim"><ol><li>    <span class="w">HV</span>*  <span class="i">get_hv</span><span class="s">(</span><span class="q">&quot;package::varname&quot;</span><span class="cm">,</span> <span class="w">FALSE</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>This returns NULL if the variable does not exist.</p>
<p>The hash algorithm is defined in the <code class="inline"><span class="i">PERL_HASH</span><span class="s">(</span><span class="w">hash</span><span class="cm">,</span> <span class="w">key</span><span class="cm">,</span> <span class="w">klen</span><span class="s">)</span></code>
 macro:</p>
<pre class="verbatim"><ol><li>    <span class="w">hash</span> = <span class="n">0</span><span class="sc">;</span></li><li>    while <span class="s">(</span><span class="w">klen</span>--<span class="s">)</span></li><li>	<span class="w">hash</span> = <span class="s">(</span><span class="w">hash</span> * <span class="n">33</span><span class="s">)</span> + <span class="i">*key</span>++<span class="sc">;</span></li><li>    <span class="w">hash</span> = <span class="w">hash</span> + <span class="s">(</span><span class="w">hash</span> &gt;&gt; <span class="n">5</span><span class="s">)</span><span class="sc">;</span>			<span class="q">/* after 5.6 */</span></li></ol></pre><p>The last step was added in version 5.6 to improve distribution of
lower bits in the resulting hash value.</p>
<p>See <a href="#Understanding-the-Magic-of-Tied-Hashes-and-Arrays">Understanding the Magic of Tied Hashes and Arrays</a> for more
information on how to use the hash access functions on tied hashes.</p>
<a class='view-head2' id="Hash-API-Extensions"></a><h3 class='h3' >Hash API Extensions</h3>
<p>Beginning with version 5.004, the following functions are also supported:</p>
<pre class="verbatim"><ol><li>    <span class="w">HE</span>*     <span class="w">hv_fetch_ent</span>  <span class="s">(</span><span class="w">HV</span>* <span class="w">tb</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">key</span><span class="cm">,</span> <span class="w">I32</span> <span class="w">lval</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">hash</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">HE</span>*     <span class="w">hv_store_ent</span>  <span class="s">(</span><span class="w">HV</span>* <span class="w">tb</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">key</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">val</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">hash</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <span class="w">bool</span>    <span class="w">hv_exists_ent</span> <span class="s">(</span><span class="w">HV</span>* <span class="w">tb</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">key</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">hash</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>*     <span class="w">hv_delete_ent</span> <span class="s">(</span><span class="w">HV</span>* <span class="w">tb</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">key</span><span class="cm">,</span> <span class="w">I32</span> <span class="w">flags</span><span class="cm">,</span> <span class="w">U32</span> <span class="w">hash</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <span class="w">SV</span>*     <span class="w">hv_iterkeysv</span>  <span class="s">(</span><span class="w">HE</span>* <span class="w">entry</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Note that these functions take <code class="inline"><span class="w">SV</span>*</code>
 keys, which simplifies writing
of extension code that deals with hash structures.  These functions
also allow passing of <code class="inline"><span class="w">SV</span>*</code>
 keys to <code class="inline"><a class="l_k" href="functions/tie.html">tie</a></code> functions without forcing
you to stringify the keys (unlike the previous set of functions).</p>
<p>They also return and accept whole hash entries (<code class="inline"><span class="w">HE</span>*</code>
), making their
use more efficient (since the hash number for a particular string
doesn't have to be recomputed every time).  See <a href="perlapi.html">perlapi</a> for detailed
descriptions.</p>
<p>The following macros must always be used to access the contents of hash
entries.  Note that the arguments to these macros must be simple
variables, since they may get evaluated more than once.  See
<a href="perlapi.html">perlapi</a> for detailed descriptions of these macros.</p>
<pre class="verbatim"><ol><li>    <span class="i">HePV</span><span class="s">(</span><span class="w">HE</span>* <span class="w">he</span><span class="cm">,</span> <span class="w">STRLEN</span> <span class="w">len</span><span class="s">)</span></li><li>    <span class="i">HeVAL</span><span class="s">(</span><span class="w">HE</span>* <span class="w">he</span><span class="s">)</span></li><li>    <span class="i">HeHASH</span><span class="s">(</span><span class="w">HE</span>* <span class="w">he</span><span class="s">)</span></li><li>    <span class="i">HeSVKEY</span><span class="s">(</span><span class="w">HE</span>* <span class="w">he</span><span class="s">)</span></li><li>    <span class="i">HeSVKEY_force</span><span class="s">(</span><span class="w">HE</span>* <span class="w">he</span><span class="s">)</span></li><li>    <span class="i">HeSVKEY_set</span><span class="s">(</span><span class="w">HE</span>* <span class="w">he</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">sv</span><span class="s">)</span></li></ol></pre><p>These two lower level macros are defined, but must only be used when
dealing with keys that are not <code class="inline"><span class="w">SV</span>*</code>
s:</p>
<pre class="verbatim"><ol><li>    <span class="i">HeKEY</span><span class="s">(</span><span class="w">HE</span>* <span class="w">he</span><span class="s">)</span></li><li>    <span class="i">HeKLEN</span><span class="s">(</span><span class="w">HE</span>* <span class="w">he</span><span class="s">)</span></li></ol></pre><p>Note that both <code class="inline"><span class="w">hv_store</span></code>
 and <code class="inline"><span class="w">hv_store_ent</span></code>
 do not increment the
reference count of the stored <code class="inline"><span class="w">val</span></code>
, which is the caller's responsibility.
If these functions return a NULL value, the caller will usually have to
decrement the reference count of <code class="inline"><span class="w">val</span></code>
 to avoid a memory leak.</p>
<a class='view-head2' id="References"></a><h3 class='h3' >References</h3>
<p>References are a special type of scalar that point to other data types
(including references).</p>
<p>To create a reference, use either of the following functions:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>* <span class="i">newRV_inc</span><span class="s">(</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span> <span class="w">thing</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>* <span class="i">newRV_noinc</span><span class="s">(</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span> <span class="w">thing</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The <code class="inline"><span class="w">thing</span></code>
 argument can be any of an <code class="inline"><span class="w">SV</span>*</code>
, <code class="inline"><span class="w">AV</span>*</code>
, or <code class="inline"><span class="w">HV</span>*</code>
.  The
functions are identical except that <code class="inline"><span class="w">newRV_inc</span></code>
 increments the reference
count of the <code class="inline"><span class="w">thing</span></code>
, while <code class="inline"><span class="w">newRV_noinc</span></code>
 does not.  For historical
reasons, <code class="inline"><span class="w">newRV</span></code>
 is a synonym for <code class="inline"><span class="w">newRV_inc</span></code>
.</p>
<p>Once you have a reference, you can use the following macro to dereference
the reference:</p>
<pre class="verbatim"><ol><li>    <span class="i">SvRV</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>then call the appropriate routines, casting the returned <code class="inline"><span class="w">SV</span>*</code>
 to either an
<code class="inline"><span class="w">AV</span>*</code>
 or <code class="inline"><span class="w">HV</span>*</code>
, if required.</p>
<p>To determine if an SV is a reference, you can use the following macro:</p>
<pre class="verbatim"><ol><li>    <span class="i">SvROK</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>To discover what type of value the reference refers to, use the following
macro and then check the return value.</p>
<pre class="verbatim"><ol><li>    <span class="i">SvTYPE</span><span class="s">(</span><span class="i">SvRV</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span><span class="s">)</span></li></ol></pre><p>The most useful types that will be returned are:</p>
<pre class="verbatim"><ol><li>    <span class="w">SVt_IV</span>    <span class="w">Scalar</span></li><li>    <span class="w">SVt_NV</span>    <span class="w">Scalar</span></li><li>    <span class="w">SVt_PV</span>    <span class="w">Scalar</span></li><li>    <span class="w">SVt_RV</span>    <span class="w">Scalar</span></li><li>    <span class="w">SVt_PVAV</span>  <span class="w">Array</span></li><li>    <span class="w">SVt_PVHV</span>  <span class="w">Hash</span></li><li>    <span class="w">SVt_PVCV</span>  <span class="w">Code</span></li><li>    <span class="w">SVt_PVGV</span>  <span class="w">Glob</span> <span class="s">(</span><span class="w">possible</span> <span class="w">a</span> <span class="w">file</span> <span class="w">handle</span><span class="s">)</span></li><li>    <span class="w">SVt_PVMG</span>  <span class="w">Blessed</span> or <span class="w">Magical</span> <span class="w">Scalar</span></li><li></li><li>    <span class="w">See</span> <span class="w">the</span> <span class="w">sv</span>.<span class="w">h</span> <span class="w">header</span> <span class="w">file</span> for <span class="w">more</span> <span class="w">details</span>.</li></ol></pre><a class='view-head2' id="Blessed-References-and-Class-Objects"></a><h3 class='h3' >Blessed References and Class Objects</h3>
<p>References are also used to support object-oriented programming.  In the
OO lexicon, an object is simply a reference that has been blessed into a
package (or class).  Once blessed, the programmer may now use the reference
to access the various methods in the class.</p>
<p>A reference can be blessed into a package with the following function:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>* <span class="i">sv_bless</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">HV</span>* <span class="w">stash</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The <code class="inline"><span class="w">sv</span></code>
 argument must be a reference.  The <code class="inline"><span class="w">stash</span></code>
 argument specifies
which class the reference will belong to.  See
<a href="#Stashes-and-Globs">Stashes and Globs</a> for information on converting class names into stashes.</p>
<p>/* Still under construction */</p>
<p>Upgrades rv to reference if not already one.  Creates new SV for rv to
point to.  If <code class="inline"><span class="w">classname</span></code>
 is non-null, the SV is blessed into the specified
class.  SV is returned.</p>
<pre class="verbatim"><ol><li>	<span class="w">SV</span>* <span class="i">newSVrv</span><span class="s">(</span><span class="w">SV</span>* <span class="w">rv</span><span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">classname</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Copies integer or double into an SV whose reference is <code class="inline"><span class="w">rv</span></code>
.  SV is blessed
if <code class="inline"><span class="w">classname</span></code>
 is non-null.</p>
<pre class="verbatim"><ol><li>	<span class="w">SV</span>* <span class="i">sv_setref_iv</span><span class="s">(</span><span class="w">SV</span>* <span class="w">rv</span><span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">classname</span><span class="cm">,</span> <span class="w">IV</span> <span class="w">iv</span><span class="s">)</span><span class="sc">;</span></li><li>	<span class="w">SV</span>* <span class="i">sv_setref_nv</span><span class="s">(</span><span class="w">SV</span>* <span class="w">rv</span><span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">classname</span><span class="cm">,</span> <span class="w">NV</span> <span class="w">iv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Copies the pointer value (<i>the address, not the string!</i>) into an SV whose
reference is rv.  SV is blessed if <code class="inline"><span class="w">classname</span></code>
 is non-null.</p>
<pre class="verbatim"><ol><li>	<span class="w">SV</span>* <span class="i">sv_setref_pv</span><span class="s">(</span><span class="w">SV</span>* <span class="w">rv</span><span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">classname</span><span class="cm">,</span> <span class="w">PV</span> <span class="w">iv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Copies string into an SV whose reference is <code class="inline"><span class="w">rv</span></code>
.  Set length to 0 to let
Perl calculate the string length.  SV is blessed if <code class="inline"><span class="w">classname</span></code>
 is non-null.</p>
<pre class="verbatim"><ol><li>	<span class="w">SV</span>* <span class="i">sv_setref_pvn</span><span class="s">(</span><span class="w">SV</span>* <span class="w">rv</span><span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">classname</span><span class="cm">,</span> <span class="w">PV</span> <span class="w">iv</span><span class="cm">,</span> <span class="w">STRLEN</span> <a class="l_k" href="functions/length.html">length</a><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Tests whether the SV is blessed into the specified class.  It does not
check inheritance relationships.</p>
<pre class="verbatim"><ol><li>	<a class="l_k" href="functions/int.html">int</a>  <span class="i">sv_isa</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">name</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Tests whether the SV is a reference to a blessed object.</p>
<pre class="verbatim"><ol><li>	<a class="l_k" href="functions/int.html">int</a>  <span class="i">sv_isobject</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Tests whether the SV is derived from the specified class. SV can be either
a reference to a blessed object or a string containing a class name. This
is the function implementing the <code class="inline"><span class="w">UNIVERSAL::isa</span></code>
 functionality.</p>
<pre class="verbatim"><ol><li>	<span class="w">bool</span> <span class="i">sv_derived_from</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">name</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>To check if you've got an object derived from a specific class you have 
to write:</p>
<pre class="verbatim"><ol><li>	if <span class="s">(</span><span class="i">sv_isobject</span><span class="s">(</span><span class="w">sv</span><span class="s">)</span> &amp;&amp; <span class="i">sv_derived_from</span><span class="s">(</span><span class="w">sv</span><span class="cm">,</span> <span class="w">class</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span> ... <span class="s">}</span></li></ol></pre><a class='view-head2' id="Creating-New-Variables"></a><h3 class='h3' >Creating New Variables</h3>
<p>To create a new Perl variable with an undef value which can be accessed from
your Perl script, use the following routines, depending on the variable type.</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*  <span class="i">get_sv</span><span class="s">(</span><span class="q">&quot;package::varname&quot;</span><span class="cm">,</span> <span class="w">TRUE</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">AV</span>*  <span class="i">get_av</span><span class="s">(</span><span class="q">&quot;package::varname&quot;</span><span class="cm">,</span> <span class="w">TRUE</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">HV</span>*  <span class="i">get_hv</span><span class="s">(</span><span class="q">&quot;package::varname&quot;</span><span class="cm">,</span> <span class="w">TRUE</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Notice the use of TRUE as the second parameter.  The new variable can now
be set, using the routines appropriate to the data type.</p>
<p>There are additional macros whose values may be bitwise OR'ed with the
<code class="inline"><span class="w">TRUE</span></code>
 argument to enable certain extra features.  Those bits are:</p>
<pre class="verbatim"><ol><li>    <span class="w">GV_ADDMULTI</span>	<span class="w">Marks</span> <span class="w">the</span> <span class="w">variable</span> <span class="w">as</span> <span class="w">multiply</span> <a class="l_k" href="functions/defined.html">defined</a><span class="cm">,</span> <span class="w">thus</span> <span class="w">preventing</span> <span class="w">the</span></li><li>		<span class="q">&quot;Name &lt;varname&gt; used only once: possible typo&quot;</span> <span class="w">warning</span>.</li><li>    <span class="w">GV_ADDWARN</span>	<span class="w">Issues</span> <span class="w">the</span> <span class="w">warning</span> <span class="q">&quot;Had to create &lt;varname&gt; unexpectedly&quot;</span> if</li><li>		<span class="w">the</span> <span class="w">variable</span> <span class="w">did</span> not <span class="w">exist</span> <span class="w">before</span> <span class="w">the</span> <span class="w">function</span> <span class="w">was</span> <span class="w">called</span>.</li></ol></pre><p>If you do not specify a package name, the variable is created in the current
package.</p>
<a class='view-head2' id="Reference-Counts-and-Mortality"></a><h3 class='h3' >Reference Counts and Mortality</h3>
<p>Perl uses an reference count-driven garbage collection mechanism. SVs,
AVs, or HVs (xV for short in the following) start their life with a
reference count of 1.  If the reference count of an xV ever drops to 0,
then it will be destroyed and its memory made available for reuse.</p>
<p>This normally doesn't happen at the Perl level unless a variable is
undef'ed or the last variable holding a reference to it is changed or
overwritten.  At the internal level, however, reference counts can be
manipulated with the following macros:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/int.html">int</a> <span class="i">SvREFCNT</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">SV</span>* <span class="i">SvREFCNT_inc</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">void</span> <span class="i">SvREFCNT_dec</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>However, there is one other function which manipulates the reference
count of its argument.  The <code class="inline"><span class="w">newRV_inc</span></code>
 function, you will recall,
creates a reference to the specified argument.  As a side effect,
it increments the argument's reference count.  If this is not what
you want, use <code class="inline"><span class="w">newRV_noinc</span></code>
 instead.</p>
<p>For example, imagine you want to return a reference from an XSUB function.
Inside the XSUB routine, you create an SV which initially has a reference
count of one.  Then you call <code class="inline"><span class="w">newRV_inc</span></code>
, passing it the just-created SV.
This returns the reference as a new SV, but the reference count of the
SV you passed to <code class="inline"><span class="w">newRV_inc</span></code>
 has been incremented to two.  Now you
return the reference from the XSUB routine and forget about the SV.
But Perl hasn't!  Whenever the returned reference is destroyed, the
reference count of the original SV is decreased to one and nothing happens.
The SV will hang around without any way to access it until Perl itself
terminates.  This is a memory leak.</p>
<p>The correct procedure, then, is to use <code class="inline"><span class="w">newRV_noinc</span></code>
 instead of
<code class="inline"><span class="w">newRV_inc</span></code>
.  Then, if and when the last reference is destroyed,
the reference count of the SV will go to zero and it will be destroyed,
stopping any memory leak.</p>
<p>There are some convenience functions available that can help with the
destruction of xVs.  These functions introduce the concept of "mortality".
An xV that is mortal has had its reference count marked to be decremented,
but not actually decremented, until "a short time later".  Generally the
term "short time later" means a single Perl statement, such as a call to
an XSUB function.  The actual determinant for when mortal xVs have their
reference count decremented depends on two macros, SAVETMPS and FREETMPS.
See <a href="perlcall.html">perlcall</a> and <a href="perlxs.html">perlxs</a> for more details on these macros.</p>
<p>"Mortalization" then is at its simplest a deferred <code class="inline"><span class="w">SvREFCNT_dec</span></code>
.
However, if you mortalize a variable twice, the reference count will
later be decremented twice.</p>
<p>You should be careful about creating mortal variables.  Strange things
can happen if you make the same value mortal within multiple contexts,
or if you make a variable mortal multiple times.</p>
<p>To create a mortal variable, use the functions:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*  <span class="i">sv_newmortal</span><span class="s">(</span><span class="s">)</span></li><li>    <span class="w">SV</span>*  <span class="i">sv_2mortal</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li><li>    <span class="w">SV</span>*  <span class="i">sv_mortalcopy</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>The first call creates a mortal SV, the second converts an existing
SV to a mortal SV (and thus defers a call to <code class="inline"><span class="w">SvREFCNT_dec</span></code>
), and the
third creates a mortal copy of an existing SV.</p>
<p>The mortal routines are not just for SVs -- AVs and HVs can be
made mortal by passing their address (type-casted to <code class="inline"><span class="w">SV</span>*</code>
) to the
<code class="inline"><span class="w">sv_2mortal</span></code>
 or <code class="inline"><span class="w">sv_mortalcopy</span></code>
 routines.</p>
<a class='view-head2' id="Stashes-and-Globs"></a><h3 class='h3' >Stashes and Globs</h3>
<p>A "stash" is a hash that contains all of the different objects that
are contained within a package.  Each key of the stash is a symbol
name (shared by all the different types of objects that have the same
name), and each value in the hash table is a GV (Glob Value).  This GV
in turn contains references to the various objects of that name,
including (but not limited to) the following:</p>
<pre class="verbatim"><ol><li>    <span class="w">Scalar</span> <span class="w">Value</span></li><li>    <span class="w">Array</span> <span class="w">Value</span></li><li>    <span class="w">Hash</span> <span class="w">Value</span></li><li>    <span class="w">I</span>/<span class="w">O</span> <span class="w">Handle</span></li><li>    <span class="w">Format</span></li><li>    <span class="w">Subroutine</span></li></ol></pre><p>There is a single stash called "PL_defstash" that holds the items that exist
in the "main" package.  To get at the items in other packages, append the
string "::" to the package name.  The items in the "Foo" package are in
the stash "Foo::" in PL_defstash.  The items in the "Bar::Baz" package are
in the stash "Baz::" in "Bar::"'s stash.</p>
<p>To get the stash pointer for a particular package, use the function:</p>
<pre class="verbatim"><ol><li>    <span class="w">HV</span>*  <span class="i">gv_stashpv</span><span class="s">(</span><span class="w">const</span> <span class="w">char</span>* <span class="w">name</span><span class="cm">,</span> <span class="w">I32</span> <span class="w">create</span><span class="s">)</span></li><li>    <span class="w">HV</span>*  <span class="i">gv_stashsv</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">I32</span> <span class="w">create</span><span class="s">)</span></li></ol></pre><p>The first function takes a literal string, the second uses the string stored
in the SV.  Remember that a stash is just a hash table, so you get back an
<code class="inline"><span class="w">HV</span>*</code>
.  The <code class="inline"><span class="w">create</span></code>
 flag will create a new package if it is set.</p>
<p>The name that <code class="inline"><span class="w">gv_stash</span>*<span class="w">v</span></code>
 wants is the name of the package whose symbol table
you want.  The default package is called <code class="inline"><span class="w">main</span></code>
.  If you have multiply nested
packages, pass their names to <code class="inline"><span class="w">gv_stash</span>*<span class="w">v</span></code>
, separated by <code class="inline"><span class="w">::</span></code>
 as in the Perl
language itself.</p>
<p>Alternately, if you have an SV that is a blessed reference, you can find
out the stash pointer by using:</p>
<pre class="verbatim"><ol><li>    <span class="w">HV</span>*  <span class="i">SvSTASH</span><span class="s">(</span><span class="i">SvRV</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>then use the following to get the package name itself:</p>
<pre class="verbatim"><ol><li>    <span class="w">char</span>*  <span class="i">HvNAME</span><span class="s">(</span><span class="w">HV</span>* <span class="w">stash</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>If you need to bless or re-bless an object you can use the following
function:</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*  <span class="i">sv_bless</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">HV</span>* <span class="w">stash</span><span class="s">)</span></li></ol></pre><p>where the first argument, an <code class="inline"><span class="w">SV</span>*</code>
, must be a reference, and the second
argument is a stash.  The returned <code class="inline"><span class="w">SV</span>*</code>
 can now be used in the same way
as any other SV.</p>
<p>For more information on references and blessings, consult <a href="perlref.html">perlref</a>.</p>
<a class='view-head2' id="Double-Typed-SVs"></a><h3 class='h3' >Double-Typed SVs</h3>
<p>Scalar variables normally contain only one type of value, an integer,
double, pointer, or reference.  Perl will automatically convert the
actual scalar data from the stored type into the requested type.</p>
<p>Some scalar variables contain more than one type of scalar data.  For
example, the variable <code class="inline"><span class="i">$!</span></code>
 contains either the numeric value of <code class="inline"><span class="w">errno</span></code>

or its string equivalent from either <code class="inline"><span class="w">strerror</span></code>
 or <code class="inline"><span class="w">sys_errlist</span><span class="s">[</span><span class="s">]</span></code>
.</p>
<p>To force multiple data values into an SV, you must do two things: use the
<code class="inline"><span class="w">sv_set</span>*<span class="w">v</span></code>
 routines to add the additional scalar type, then set a flag
so that Perl will believe it contains more than one type of data.  The
four macros to set the flags are:</p>
<pre class="verbatim"><ol><li>	<span class="w">SvIOK_on</span></li><li>	<span class="w">SvNOK_on</span></li><li>	<span class="w">SvPOK_on</span></li><li>	<span class="w">SvROK_on</span></li></ol></pre><p>The particular macro you must use depends on which <code class="inline"><span class="w">sv_set</span>*<span class="w">v</span></code>
 routine
you called first.  This is because every <code class="inline"><span class="w">sv_set</span>*<span class="w">v</span></code>
 routine turns on
only the bit for the particular type of data being set, and turns off
all the rest.</p>
<p>For example, to create a new Perl variable called "dberror" that contains
both the numeric and descriptive string error values, you could use the
following code:</p>
<pre class="verbatim"><ol><li>    <span class="w">extern</span> <a class="l_k" href="functions/int.html">int</a>  <span class="w">dberror</span><span class="sc">;</span></li><li>    <span class="w">extern</span> <span class="w">char</span> *<span class="w">dberror_list</span><span class="sc">;</span></li><li></li><li>    <span class="w">SV</span>* <span class="w">sv</span> = <span class="i">get_sv</span><span class="s">(</span><span class="q">&quot;dberror&quot;</span><span class="cm">,</span> <span class="w">TRUE</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">sv_setiv</span><span class="s">(</span><span class="w">sv</span><span class="cm">,</span> <span class="s">(</span><span class="w">IV</span><span class="s">)</span> <span class="w">dberror</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">sv_setpv</span><span class="s">(</span><span class="w">sv</span><span class="cm">,</span> <span class="w">dberror_list</span><span class="s">[</span><span class="w">dberror</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">SvIOK_on</span><span class="s">(</span><span class="w">sv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>If the order of <code class="inline"><span class="w">sv_setiv</span></code>
 and <code class="inline"><span class="w">sv_setpv</span></code>
 had been reversed, then the
macro <code class="inline"><span class="w">SvPOK_on</span></code>
 would need to be called instead of <code class="inline"><span class="w">SvIOK_on</span></code>
.</p>
<a class='view-head2' id="Magic-Variables"></a><h3 class='h3' >Magic Variables</h3>
<p>[This section still under construction.  Ignore everything here.  Post no
bills.  Everything not permitted is forbidden.]</p>
<p>Any SV may be magical, that is, it has special features that a normal
SV does not have.  These features are stored in the SV structure in a
linked list of <code class="inline"><span class="w">struct</span> <span class="w">magic</span></code>
's, typedef'ed to <code class="inline"><span class="w">MAGIC</span></code>
.</p>
<pre class="verbatim"><ol><li>    <span class="w">struct</span> <span class="i">magic</span> <span class="s">{</span></li><li>        <span class="w">MAGIC</span>*      <span class="w">mg_moremagic</span><span class="sc">;</span></li><li>        <span class="w">MGVTBL</span>*     <span class="w">mg_virtual</span><span class="sc">;</span></li><li>        <span class="w">U16</span>         <span class="w">mg_private</span><span class="sc">;</span></li><li>        <span class="w">char</span>        <span class="w">mg_type</span><span class="sc">;</span></li><li>        <span class="w">U8</span>          <span class="w">mg_flags</span><span class="sc">;</span></li><li>        <span class="w">SV</span>*         <span class="w">mg_obj</span><span class="sc">;</span></li><li>        <span class="w">char</span>*       <span class="w">mg_ptr</span><span class="sc">;</span></li><li>        <span class="w">I32</span>         <span class="w">mg_len</span><span class="sc">;</span></li><li>    <span class="s">}</span><span class="sc">;</span></li></ol></pre><p>Note this is current as of patchlevel 0, and could change at any time.</p>
<a class='view-head2' id="Assigning-Magic"></a><h3 class='h3' >Assigning Magic</h3>
<p>Perl adds magic to an SV using the sv_magic function:</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span> <span class="i">sv_magic</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">obj</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">how</span><span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">name</span><span class="cm">,</span> <span class="w">I32</span> <span class="w">namlen</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The <code class="inline"><span class="w">sv</span></code>
 argument is a pointer to the SV that is to acquire a new magical
feature.</p>
<p>If <code class="inline"><span class="w">sv</span></code>
 is not already magical, Perl uses the <code class="inline"><span class="w">SvUPGRADE</span></code>
 macro to
set the <code class="inline"><span class="w">SVt_PVMG</span></code>
 flag for the <code class="inline"><span class="w">sv</span></code>
.  Perl then continues by adding
it to the beginning of the linked list of magical features.  Any prior
entry of the same type of magic is deleted.  Note that this can be
overridden, and multiple instances of the same type of magic can be
associated with an SV.</p>
<p>The <code class="inline"><span class="w">name</span></code>
 and <code class="inline"><span class="w">namlen</span></code>
 arguments are used to associate a string with
the magic, typically the name of a variable. <code class="inline"><span class="w">namlen</span></code>
 is stored in the
<code class="inline"><span class="w">mg_len</span></code>
 field and if <code class="inline"><span class="w">name</span></code>
 is non-null and <code class="inline"><span class="w">namlen</span></code>
 &gt;= 0 a malloc'd
copy of the name is stored in <code class="inline"><span class="w">mg_ptr</span></code>
 field.</p>
<p>The sv_magic function uses <code class="inline"><span class="w">how</span></code>
 to determine which, if any, predefined
"Magic Virtual Table" should be assigned to the <code class="inline"><span class="w">mg_virtual</span></code>
 field.
See the "Magic Virtual Table" section below.  The <code class="inline"><span class="w">how</span></code>
 argument is also
stored in the <code class="inline"><span class="w">mg_type</span></code>
 field.</p>
<p>The <code class="inline"><span class="w">obj</span></code>
 argument is stored in the <code class="inline"><span class="w">mg_obj</span></code>
 field of the <code class="inline"><span class="w">MAGIC</span></code>

structure.  If it is not the same as the <code class="inline"><span class="w">sv</span></code>
 argument, the reference
count of the <code class="inline"><span class="w">obj</span></code>
 object is incremented.  If it is the same, or if
the <code class="inline"><span class="w">how</span></code>
 argument is "#", or if it is a NULL pointer, then <code class="inline"><span class="w">obj</span></code>
 is
merely stored, without the reference count being incremented.</p>
<p>There is also a function to add magic to an <code class="inline"><span class="w">HV</span></code>
:</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span> <span class="i">hv_magic</span><span class="s">(</span><span class="w">HV</span> *<span class="w">hv</span><span class="cm">,</span> <span class="w">GV</span> *<span class="w">gv</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">how</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>This simply calls <code class="inline"><span class="w">sv_magic</span></code>
 and coerces the <code class="inline"><span class="w">gv</span></code>
 argument into an <code class="inline"><span class="w">SV</span></code>
.</p>
<p>To remove the magic from an SV, call the function sv_unmagic:</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span> <span class="i">sv_unmagic</span><span class="s">(</span><span class="w">SV</span> *<span class="w">sv</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">type</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The <code class="inline"><span class="w">type</span></code>
 argument should be equal to the <code class="inline"><span class="w">how</span></code>
 value when the <code class="inline"><span class="w">SV</span></code>

was initially made magical.</p>
<a class='view-head2' id="Magic-Virtual-Tables"></a><h3 class='h3' >Magic Virtual Tables</h3>
<p>The <code class="inline"><span class="w">mg_virtual</span></code>
 field in the <code class="inline"><span class="w">MAGIC</span></code>
 structure is a pointer to a
<code class="inline"><span class="w">MGVTBL</span></code>
, which is a structure of function pointers and stands for
"Magic Virtual Table" to handle the various operations that might be
applied to that variable.</p>
<p>The <code class="inline"><span class="w">MGVTBL</span></code>
 has five pointers to the following routine types:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/int.html">int</a>  <span class="s">(</span><span class="i">*svt_get</span><span class="s">)</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">MAGIC</span>* <span class="w">mg</span><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/int.html">int</a>  <span class="s">(</span><span class="i">*svt_set</span><span class="s">)</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">MAGIC</span>* <span class="w">mg</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">U32</span>  <span class="s">(</span><span class="i">*svt_len</span><span class="s">)</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">MAGIC</span>* <span class="w">mg</span><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/int.html">int</a>  <span class="s">(</span><span class="i">*svt_clear</span><span class="s">)</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">MAGIC</span>* <span class="w">mg</span><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/int.html">int</a>  <span class="s">(</span><span class="i">*svt_free</span><span class="s">)</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">MAGIC</span>* <span class="w">mg</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>This MGVTBL structure is set at compile-time in <code class="inline"><span class="w">perl</span>.<span class="w">h</span></code>
 and there are
currently 19 types (or 21 with overloading turned on).  These different
structures contain pointers to various routines that perform additional
actions depending on which function is being called.</p>
<pre class="verbatim"><ol><li>    <span class="w">Function</span> <span class="w">pointer</span>    <span class="w">Action</span> <span class="w">taken</span></li><li>    ----------------    ------------</li><li>    <span class="w">svt_get</span>             <span class="w">Do</span> <span class="w">something</span> <span class="w">after</span> <span class="w">the</span> <span class="w">value</span> <span class="w">of</span> <span class="w">the</span> <span class="w">SV</span> <span class="w">is</span> <span class="w">retrieved</span>.</li><li>    <span class="w">svt_set</span>             <span class="w">Do</span> <span class="w">something</span> <span class="w">after</span> <span class="w">the</span> <span class="w">SV</span> <span class="w">is</span> <span class="w">assigned</span> <span class="w">a</span> <span class="w">value</span>.</li><li>    <span class="w">svt_len</span>             <span class="w">Report</span> <span class="w">on</span> <span class="w">the</span> <span class="w">SV&#39;s</span> <a class="l_k" href="functions/length.html">length</a>.</li><li>    <span class="w">svt_clear</span>		<span class="w">Clear</span> <span class="w">something</span> <span class="w">the</span> <span class="w">SV</span> <span class="w">represents</span>.</li><li>    <span class="w">svt_free</span>            <span class="w">Free</span> <span class="w">any</span> <span class="w">extra</span> <span class="w">storage</span> <span class="w">associated</span> <span class="w">with</span> <span class="w">the</span> <span class="w">SV</span>.</li></ol></pre><p>For instance, the MGVTBL structure called <code class="inline"><span class="w">vtbl_sv</span></code>
 (which corresponds
to an <code class="inline"><span class="w">mg_type</span></code>
 of '\0') contains:</p>
<pre class="verbatim"><ol><li>    <span class="s">{</span> <span class="w">magic_get</span><span class="cm">,</span> <span class="w">magic_set</span><span class="cm">,</span> <span class="w">magic_len</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span> <span class="s">}</span></li></ol></pre><p>Thus, when an SV is determined to be magical and of type '\0', if a get
operation is being performed, the routine <code class="inline"><span class="w">magic_get</span></code>
 is called.  All
the various routines for the various magical types begin with <code class="inline"><span class="w">magic_</span></code>
.
NOTE: the magic routines are not considered part of the Perl API, and may
not be exported by the Perl library.</p>
<p>The current kinds of Magic Virtual Tables are:</p>
<pre class="verbatim"><ol><li>    <span class="w">mg_type</span>  <span class="w">MGVTBL</span>              <span class="w">Type</span> <span class="w">of</span> <span class="w">magic</span></li><li>    -------  ------              ----------------------------</li><li>    \<span class="n">0</span>       <span class="w">vtbl_sv</span>             <span class="w">Special</span> <a class="l_k" href="functions/scalar.html">scalar</a> <span class="w">variable</span></li><li>    <span class="w">A</span>        <span class="w">vtbl_amagic</span>         <span class="i">%OVERLOAD</span> <span class="w">hash</span></li><li>    <span class="w">a</span>        <span class="w">vtbl_amagicelem</span>     <span class="i">%OVERLOAD</span> <span class="w">hash</span> <span class="w">element</span></li><li>    <span class="w">c</span>        <span class="s">(</span><span class="w">none</span><span class="s">)</span>              <span class="w">Holds</span> <span class="w">overload</span> <span class="w">table</span> <span class="s">(</span><span class="w">AMT</span><span class="s">)</span> <span class="w">on</span> <span class="w">stash</span></li><li>    <span class="w">B</span>        <span class="w">vtbl_bm</span>             <span class="w">Boyer</span>-<span class="w">Moore</span> <span class="s">(</span><span class="w">fast</span> <span class="w">string</span> <span class="w">search</span><span class="s">)</span></li><li>    <span class="w">E</span>        <span class="w">vtbl_env</span>            <span class="i">%ENV</span> <span class="w">hash</span></li><li>    <span class="w">e</span>        <span class="w">vtbl_envelem</span>        <span class="i">%ENV</span> <span class="w">hash</span> <span class="w">element</span></li><li>    <span class="w">f</span>        <span class="w">vtbl_fm</span>             <span class="w">Formline</span> <span class="s">(</span><span class="q">&#39;compiled&#39;</span> format)</li><li><span class="hh">    g        vtbl_mglob          m//g target / study()ed string</span></li><li><span class="hh">    I        vtbl_isa            @ISA array</span></li><li><span class="hh">    i        vtbl_isaelem        @ISA array element</span></li><li><span class="hh">    k        vtbl_nkeys          scalar(keys()) lvalue</span></li><li><span class="hh">    L        (none)              Debugger %_&lt;filename </span></li><li><span class="hh">    l        vtbl_dbline         Debugger %_&lt;filename element</span></li><li><span class="hh">    o        vtbl_collxfrm       Locale transformation</span></li><li><span class="hh">    P        vtbl_pack           Tied array or hash</span></li><li><span class="hh">    p        vtbl_packelem       Tied array or hash element</span></li><li><span class="hh">    q        vtbl_packelem       Tied scalar or handle</span></li><li><span class="hh">    S        vtbl_sig            %SIG hash</span></li><li><span class="hh">    s        vtbl_sigelem        %SIG hash element</span></li><li><span class="hh">    t        vtbl_taint          Taintedness</span></li><li><span class="hh">    U        vtbl_uvar           Available for use by extensions</span></li><li><span class="hh">    v        vtbl_vec            vec() lvalue</span></li><li><span class="hh">    x        vtbl_substr         substr() lvalue</span></li><li><span class="hh">    y        vtbl_defelem        Shadow &quot;foreach&quot; iterator variable /</span></li><li><span class="hh">                                  smart parameter vivification</span></li><li><span class="hh">    *        vtbl_glob           GV (typeglob)</span></li><li><span class="hh">    #        vtbl_arylen         Array length ($#ary)</span></li><li><span class="hh">    .        vtbl_pos            pos() lvalue</span></li><li><span class="hh">    ~        (none)              Available for use by extensions</span></li></ol></pre><p>When an uppercase and lowercase letter both exist in the table, then the
uppercase letter is used to represent some kind of composite type (a list
or a hash), and the lowercase letter is used to represent an element of
that composite type.</p>
<p>The '~' and 'U' magic types are defined specifically for use by
extensions and will not be used by perl itself.  Extensions can use
'~' magic to 'attach' private information to variables (typically
objects).  This is especially useful because there is no way for
normal perl code to corrupt this private information (unlike using
extra elements of a hash object).</p>
<p>Similarly, 'U' magic can be used much like tie() to call a C function
any time a scalar's value is used or changed.  The <code class="inline"><span class="w">MAGIC</span></code>
's
<code class="inline"><span class="w">mg_ptr</span></code>
 field points to a <code class="inline"><span class="w">ufuncs</span></code>
 structure:</p>
<pre class="verbatim"><ol><li>    <span class="w">struct</span> <span class="i">ufuncs</span> <span class="s">{</span></li><li>        <span class="w">I32</span> <span class="s">(</span><span class="i">*uf_val</span><span class="s">)</span><span class="s">(</span><span class="w">IV</span><span class="cm">,</span> <span class="w">SV</span>*<span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">I32</span> <span class="s">(</span><span class="i">*uf_set</span><span class="s">)</span><span class="s">(</span><span class="w">IV</span><span class="cm">,</span> <span class="w">SV</span>*<span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">IV</span> <span class="w">uf_index</span><span class="sc">;</span></li><li>    <span class="s">}</span><span class="sc">;</span></li></ol></pre><p>When the SV is read from or written to, the <code class="inline"><span class="w">uf_val</span></code>
 or <code class="inline"><span class="w">uf_set</span></code>

function will be called with <code class="inline"><span class="w">uf_index</span></code>
 as the first arg and a
pointer to the SV as the second.  A simple example of how to add 'U'
magic is shown below.  Note that the ufuncs structure is copied by
sv_magic, so you can safely allocate it on the stack.</p>
<pre class="verbatim"><ol><li>    <span class="w">void</span></li><li>    <span class="i">Umagic</span><span class="s">(</span><span class="w">sv</span><span class="s">)</span></li><li>        <span class="w">SV</span> *<span class="w">sv</span><span class="sc">;</span></li><li>    <span class="j">PREINIT:</span></li><li>        <span class="w">struct</span> <span class="w">ufuncs</span> <span class="w">uf</span><span class="sc">;</span></li><li>    <span class="j">CODE:</span></li><li>        <span class="w">uf</span>.<span class="w">uf_val</span>   = <span class="i">&amp;my_get_fn</span><span class="sc">;</span></li><li>        <span class="w">uf</span>.<span class="w">uf_set</span>   = <span class="i">&amp;my_set_fn</span><span class="sc">;</span></li><li>        <span class="w">uf</span>.<span class="w">uf_index</span> = <span class="n">0</span><span class="sc">;</span></li><li>        <span class="i">sv_magic</span><span class="s">(</span><span class="w">sv</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="q">&#39;U&#39;</span><span class="cm">,</span> <span class="s">(</span><span class="w">char</span>*<span class="s">)</span>&amp;<span class="w">uf</span><span class="cm">,</span> <span class="i">sizeof</span><span class="s">(</span><span class="w">uf</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Note that because multiple extensions may be using '~' or 'U' magic,
it is important for extensions to take extra care to avoid conflict.
Typically only using the magic on objects blessed into the same class
as the extension is sufficient.  For '~' magic, it may also be
appropriate to add an I32 'signature' at the top of the private data
area and check that.</p>
<p>Also note that the <code class="inline"><span class="w">sv_set</span>*<span class="s">(</span><span class="s">)</span></code>
 and <code class="inline"><span class="w">sv_cat</span>*<span class="s">(</span><span class="s">)</span></code>
 functions described
earlier do <strong>not</strong> invoke 'set' magic on their targets.  This must
be done by the user either by calling the <code class="inline"><span class="i">SvSETMAGIC</span><span class="s">(</span><span class="s">)</span></code>
 macro after
calling these functions, or by using one of the <code class="inline"><span class="w">sv_set</span>*<span class="i">_mg</span><span class="s">(</span><span class="s">)</span></code>
 or
<code class="inline"><span class="w">sv_cat</span>*<span class="i">_mg</span><span class="s">(</span><span class="s">)</span></code>
 functions.  Similarly, generic C code must call the
<code class="inline"><span class="i">SvGETMAGIC</span><span class="s">(</span><span class="s">)</span></code>
 macro to invoke any 'get' magic if they use an SV
obtained from external sources in functions that don't handle magic.
See <a href="perlapi.html">perlapi</a> for a description of these functions.
For example, calls to the <code class="inline"><span class="w">sv_cat</span>*<span class="s">(</span><span class="s">)</span></code>
 functions typically need to be
followed by <code class="inline"><span class="i">SvSETMAGIC</span><span class="s">(</span><span class="s">)</span></code>
, but they don't need a prior <code class="inline"><span class="i">SvGETMAGIC</span><span class="s">(</span><span class="s">)</span></code>

since their implementation handles 'get' magic.</p>
<a class='view-head2' id="Finding-Magic"></a><h3 class='h3' >Finding Magic</h3>
<pre class="verbatim"><ol><li>    <span class="w">MAGIC</span>* <span class="i">mg_find</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">type</span><span class="s">)</span><span class="sc">;</span> <span class="q">/* Finds the magic pointer of that type */</span></li></ol></pre><p>This routine returns a pointer to the <code class="inline"><span class="w">MAGIC</span></code>
 structure stored in the SV.
If the SV does not have that magical feature, <code class="inline"><span class="w">NULL</span></code>
 is returned.  Also,
if the SV is not of type SVt_PVMG, Perl may core dump.</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/int.html">int</a> <span class="i">mg_copy</span><span class="s">(</span><span class="w">SV</span>* <span class="w">sv</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">nsv</span><span class="cm">,</span> <span class="w">const</span> <span class="w">char</span>* <span class="w">key</span><span class="cm">,</span> <span class="w">STRLEN</span> <span class="w">klen</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>This routine checks to see what types of magic <code class="inline"><span class="w">sv</span></code>
 has.  If the mg_type
field is an uppercase letter, then the mg_obj is copied to <code class="inline"><span class="w">nsv</span></code>
, but
the mg_type field is changed to be the lowercase letter.</p>
<a class='view-head2' id="Understanding-the-Magic-of-Tied-Hashes-and-Arrays"></a><h3 class='h3' >Understanding the Magic of Tied Hashes and Arrays</h3>
<p>Tied hashes and arrays are magical beasts of the 'P' magic type.</p>
<p>WARNING: As of the 5.004 release, proper usage of the array and hash
access functions requires understanding a few caveats.  Some
of these caveats are actually considered bugs in the API, to be fixed
in later releases, and are bracketed with [MAYCHANGE] below. If
you find yourself actually applying such information in this section, be
aware that the behavior may change in the future, umm, without warning.</p>
<p>The perl tie function associates a variable with an object that implements
the various GET, SET etc methods.  To perform the equivalent of the perl
tie function from an XSUB, you must mimic this behaviour.  The code below
carries out the necessary steps - firstly it creates a new hash, and then
creates a second hash which it blesses into the class which will implement
the tie methods. Lastly it ties the two hashes together, and returns a
reference to the new tied hash.  Note that the code below does NOT call the
TIEHASH method in the MyTie class -
see <a href="#Calling-Perl-Routines-from-within-C-Programs">Calling Perl Routines from within C Programs</a> for details on how
to do this.</p>
<pre class="verbatim"><ol><li>    <span class="w">SV</span>*</li><li>    <span class="i">mytie</span><span class="s">(</span><span class="s">)</span></li><li>    <span class="w">PREINIT</span><span class="co">:</span></li><li>        <span class="w">HV</span> *<span class="w">hash</span><span class="sc">;</span></li><li>        <span class="w">HV</span> *<span class="w">stash</span><span class="sc">;</span></li><li>        <span class="w">SV</span> *<a class="l_k" href="functions/tie.html">tie</a><span class="sc">;</span></li><li>    <span class="j">CODE:</span></li><li>        <span class="w">hash</span> = <span class="i">newHV</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>        <a class="l_k" href="functions/tie.html">tie</a> = <span class="i">newRV_noinc</span><span class="s">(</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span><span class="i">newHV</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">stash</span> = <span class="i">gv_stashpv</span><span class="s">(</span><span class="q">&quot;MyTie&quot;</span><span class="cm">,</span> <span class="w">TRUE</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="i">sv_bless</span><span class="s">(</span><a class="l_k" href="functions/tie.html">tie</a><span class="cm">,</span> <span class="w">stash</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="i">hv_magic</span><span class="s">(</span><span class="w">hash</span><span class="cm">,</span> <a class="l_k" href="functions/tie.html">tie</a><span class="cm">,</span> <span class="q">&#39;P&#39;</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="w">RETVAL</span> = <span class="i">newRV_noinc</span><span class="s">(</span><span class="w">hash</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="j">OUTPUT:</span></li><li>        <span class="w">RETVAL</span></li></ol></pre><p>The <code class="inline"><span class="w">av_store</span></code>
 function, when given a tied array argument, merely
copies the magic of the array onto the value to be "stored", using
<code class="inline"><span class="w">mg_copy</span></code>
.  It may also return NULL, indicating that the value did not
actually need to be stored in the array.  [MAYCHANGE] After a call to
<code class="inline"><span class="w">av_store</span></code>
 on a tied array, the caller will usually need to call
<code class="inline"><span class="i">mg_set</span><span class="s">(</span><span class="w">val</span><span class="s">)</span></code>
 to actually invoke the perl level "STORE" method on the
TIEARRAY object.  If <code class="inline"><span class="w">av_store</span></code>
 did return NULL, a call to
<code class="inline"><span class="i">SvREFCNT_dec</span><span class="s">(</span><span class="w">val</span><span class="s">)</span></code>
 will also be usually necessary to avoid a memory
leak. [/MAYCHANGE]</p>
<p>The previous paragraph is applicable verbatim to tied hash access using the
<code class="inline"><span class="w">hv_store</span></code>
 and <code class="inline"><span class="w">hv_store_ent</span></code>
 functions as well.</p>
<p><code class="inline"><span class="w">av_fetch</span></code>
 and the corresponding hash functions <code class="inline"><span class="w">hv_fetch</span></code>
 and
<code class="inline"><span class="w">hv_fetch_ent</span></code>
 actually return an undefined mortal value whose magic
has been initialized using <code class="inline"><span class="w">mg_copy</span></code>
.  Note the value so returned does not
need to be deallocated, as it is already mortal.  [MAYCHANGE] But you will
need to call <code class="inline"><span class="i">mg_get</span><span class="s">(</span><span class="s">)</span></code>
 on the returned value in order to actually invoke
the perl level "FETCH" method on the underlying TIE object.  Similarly,
you may also call <code class="inline"><span class="i">mg_set</span><span class="s">(</span><span class="s">)</span></code>
 on the return value after possibly assigning
a suitable value to it using <code class="inline"><span class="w">sv_setsv</span></code>
,  which will invoke the "STORE"
method on the TIE object. [/MAYCHANGE]</p>
<p>[MAYCHANGE]
In other words, the array or hash fetch/store functions don't really
fetch and store actual values in the case of tied arrays and hashes.  They
merely call <code class="inline"><span class="w">mg_copy</span></code>
 to attach magic to the values that were meant to be
"stored" or "fetched".  Later calls to <code class="inline"><span class="w">mg_get</span></code>
 and <code class="inline"><span class="w">mg_set</span></code>
 actually
do the job of invoking the TIE methods on the underlying objects.  Thus
the magic mechanism currently implements a kind of lazy access to arrays
and hashes.</p>
<p>Currently (as of perl version 5.004), use of the hash and array access
functions requires the user to be aware of whether they are operating on
"normal" hashes and arrays, or on their tied variants.  The API may be
changed to provide more transparent access to both tied and normal data
types in future versions.
[/MAYCHANGE]</p>
<p>You would do well to understand that the TIEARRAY and TIEHASH interfaces
are mere sugar to invoke some perl method calls while using the uniform hash
and array syntax.  The use of this sugar imposes some overhead (typically
about two to four extra opcodes per FETCH/STORE operation, in addition to
the creation of all the mortal variables required to invoke the methods).
This overhead will be comparatively small if the TIE methods are themselves
substantial, but if they are only a few statements long, the overhead
will not be insignificant.</p>
<a class='view-head2' id="Localizing-changes"></a><h3 class='h3' >Localizing changes</h3>
<p>Perl has a very handy construction</p>
<pre class="verbatim"><ol><li>  <span class="s">{</span></li><li>    <a class="l_k" href="functions/local.html">local</a> <span class="i">$var</span> = <span class="n">2</span><span class="sc">;</span></li><li>    ...</li><li>  <span class="s">}</span></li></ol></pre><p>This construction is <i>approximately</i> equivalent to</p>
<pre class="verbatim"><ol><li>  <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$oldvar</span> = <span class="i">$var</span><span class="sc">;</span></li><li>    <span class="i">$var</span> = <span class="n">2</span><span class="sc">;</span></li><li>    ...</li><li>    <span class="i">$var</span> = <span class="i">$oldvar</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>The biggest difference is that the first construction would
reinstate the initial value of $var, irrespective of how control exits
the block: <code class="inline"><a class="l_k" href="functions/goto.html">goto</a></code>, <code class="inline"><a class="l_k" href="functions/return.html">return</a></code>, <code class="inline"><a class="l_k" href="functions/die.html">die</a></code>/<code class="inline"><a class="l_k" href="functions/eval.html">eval</a></code> etc. It is a little bit
more efficient as well.</p>
<p>There is a way to achieve a similar task from C via Perl API: create a
<i>pseudo-block</i>, and arrange for some changes to be automatically
undone at the end of it, either explicit, or via a non-local exit (via
die()). A <i>block</i>-like construct is created by a pair of
<code class="inline"><span class="w">ENTER</span></code>
/<code class="inline"><span class="w">LEAVE</span></code>
 macros (see <a href="perlcall.html#Returning-a-Scalar">Returning a Scalar in perlcall</a>).
Such a construct may be created specially for some important localized
task, or an existing one (like boundaries of enclosing Perl
subroutine/block, or an existing pair for freeing TMPs) may be
used. (In the second case the overhead of additional localization must
be almost negligible.) Note that any XSUB is automatically enclosed in
an <code class="inline"><span class="w">ENTER</span></code>
/<code class="inline"><span class="w">LEAVE</span></code>
 pair.</p>
<p>Inside such a <i>pseudo-block</i> the following service is available:</p>
<ul>
<li><a class='view-title' id="SAVEINT(int-i)"></a><strong><code class="inline"><span class="i">SAVEINT</span><span class="s">(</span><a class="l_k" href="functions/int.html">int</a> <span class="w">i</span><span class="s">)</span></code>
</strong>
</li>
<li><a class='view-title' id="SAVEIV(IV-i)"></a><strong><code class="inline"><span class="i">SAVEIV</span><span class="s">(</span><span class="w">IV</span> <span class="w">i</span><span class="s">)</span></code>
</strong>
</li>
<li><a class='view-title' id="SAVEI32(I32-i)"></a><strong><code class="inline"><span class="i">SAVEI32</span><span class="s">(</span><span class="w">I32</span> <span class="w">i</span><span class="s">)</span></code>
</strong>
</li>
<li><a class='view-title' id="SAVELONG(long-i)"></a><strong><code class="inline"><span class="i">SAVELONG</span><span class="s">(</span><span class="w">long</span> <span class="w">i</span><span class="s">)</span></code>
</strong>
<p>These macros arrange things to restore the value of integer variable
<code class="inline"><span class="w">i</span></code>
 at the end of enclosing <i>pseudo-block</i>.</p>
</li>
<li><a class='view-title' id="SAVESPTR(s)"></a><strong><code class="inline"><span class="i">SAVESPTR</span><span class="s">(</span><span class="q">s)</span></code>
</strong>
</li>
<li><a class='view-title' id="SAVEPPTR(p)"></a><strong><code class="inline"><span class="i">SAVEPPTR</span><span class="s">(</span><span class="w">p</span><span class="s">)</span></code>
</strong>
<p>These macros arrange things to restore the value of pointers <code class="inline"><a class="l_k" href="functions/s.html">s</a></code> and
<code class="inline"><span class="w">p</span></code>
. <code class="inline"><a class="l_k" href="functions/s.html">s</a></code> must be a pointer of a type which survives conversion to
<code class="inline"><span class="w">SV</span>*</code>
 and back, <code class="inline"><span class="w">p</span></code>
 should be able to survive conversion to <code class="inline"><span class="w">char</span>*</code>

and back.</p>
</li>
<li><a class='view-title' id="SAVEFREESV(SV-*sv)"></a><strong><code class="inline"><span class="i">SAVEFREESV</span><span class="s">(</span><span class="w">SV</span> *<span class="w">sv</span><span class="s">)</span></code>
</strong>
<p>The refcount of <code class="inline"><span class="w">sv</span></code>
 would be decremented at the end of
<i>pseudo-block</i>. This is similar to <code class="inline"><span class="w">sv_2mortal</span></code>
, which should (?) be
used instead.</p>
</li>
<li><a class='view-title' id="SAVEFREEOP(OP-*op)"></a><strong><code class="inline"><span class="i">SAVEFREEOP</span><span class="s">(</span><span class="w">OP</span> *<span class="w">op</span><span class="s">)</span></code>
</strong>
<p>The <code class="inline"><span class="w">OP</span> *</code>
 is op_free()ed at the end of <i>pseudo-block</i>.</p>
</li>
<li><a class='view-title' id="SAVEFREEPV(p)"></a><strong><code class="inline"><span class="i">SAVEFREEPV</span><span class="s">(</span><span class="w">p</span><span class="s">)</span></code>
</strong>
<p>The chunk of memory which is pointed to by <code class="inline"><span class="w">p</span></code>
 is Safefree()ed at the
end of <i>pseudo-block</i>.</p>
</li>
<li><a class='view-title' id="SAVECLEARSV(SV-*sv)"></a><strong><code class="inline"><span class="i">SAVECLEARSV</span><span class="s">(</span><span class="w">SV</span> *<span class="w">sv</span><span class="s">)</span></code>
</strong>
<p>Clears a slot in the current scratchpad which corresponds to <code class="inline"><span class="w">sv</span></code>
 at
the end of <i>pseudo-block</i>.</p>
</li>
<li><a class='view-title' id="SAVEDELETE(HV-*hv%2c-char-*key%2c-I32-length)"></a><strong><code class="inline"><span class="i">SAVEDELETE</span><span class="s">(</span><span class="w">HV</span> *<span class="w">hv</span><span class="cm">,</span> <span class="w">char</span> *<span class="w">key</span><span class="cm">,</span> <span class="w">I32</span> <a class="l_k" href="functions/length.html">length</a><span class="s">)</span></code>
</strong>
<p>The key <code class="inline"><span class="w">key</span></code>
 of <code class="inline"><span class="w">hv</span></code>
 is deleted at the end of <i>pseudo-block</i>. The
string pointed to by <code class="inline"><span class="w">key</span></code>
 is Safefree()ed.  If one has a <i>key</i> in
short-lived storage, the corresponding string may be reallocated like
this:</p>
<pre class="verbatim"><ol><li>  <span class="i">SAVEDELETE</span><span class="s">(</span><span class="w">PL_defstash</span><span class="cm">,</span> <span class="i">savepv</span><span class="s">(</span><span class="w">tmpbuf</span><span class="s">)</span><span class="cm">,</span> <span class="i">strlen</span><span class="s">(</span><span class="w">tmpbuf</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span></li></ol></pre></li>
<li><a class='view-title' id="SAVEDESTRUCTOR(DESTRUCTORFUNC_NOCONTEXT_t-f%2c-void-*p)"></a><strong><code class="inline"><span class="i">SAVEDESTRUCTOR</span><span class="s">(</span><span class="w">DESTRUCTORFUNC_NOCONTEXT_t</span> <span class="w">f</span><span class="cm">,</span> <span class="w">void</span> *<span class="w">p</span><span class="s">)</span></code>
</strong>
<p>At the end of <i>pseudo-block</i> the function <code class="inline"><span class="w">f</span></code>
 is called with the
only argument <code class="inline"><span class="w">p</span></code>
.</p>
</li>
<li><a class='view-title' id="SAVEDESTRUCTOR_X(DESTRUCTORFUNC_t-f%2c-void-*p)"></a><strong><code class="inline"><span class="i">SAVEDESTRUCTOR_X</span><span class="s">(</span><span class="w">DESTRUCTORFUNC_t</span> <span class="w">f</span><span class="cm">,</span> <span class="w">void</span> *<span class="w">p</span><span class="s">)</span></code>
</strong>
<p>At the end of <i>pseudo-block</i> the function <code class="inline"><span class="w">f</span></code>
 is called with the
implicit context argument (if any), and <code class="inline"><span class="w">p</span></code>
.</p>
</li>
<li><a class='view-title' id="SAVESTACK_POS()"></a><strong><code class="inline"><span class="i">SAVESTACK_POS</span><span class="s">(</span><span class="s">)</span></code>
</strong>
<p>The current offset on the Perl internal stack (cf. <code class="inline"><span class="w">SP</span></code>
) is restored
at the end of <i>pseudo-block</i>.</p>
</li>
</ul>
<p>The following API list contains functions, thus one needs to
provide pointers to the modifiable data explicitly (either C pointers,
or Perlish <code class="inline"><span class="w">GV</span> *</code>
s).  Where the above macros take <code class="inline"><a class="l_k" href="functions/int.html">int</a></code>, a similar 
function takes <code class="inline"><a class="l_k" href="functions/int.html">int</a> <span class="i">*</span></code>
.</p>
<ul>
<li><a class='view-title' id="SV*-save_scalar(GV-*gv)"></a><strong><code class="inline"><span class="w">SV</span>* <span class="i">save_scalar</span><span class="s">(</span><span class="w">GV</span> *<span class="w">gv</span><span class="s">)</span></code>
</strong>
<p>Equivalent to Perl code <code class="inline"><a class="l_k" href="functions/local.html">local</a> <span class="i">$gv</span></code>
.</p>
</li>
<li><a class='view-title' id="AV*-save_ary(GV-*gv)"></a><strong><code class="inline"><span class="w">AV</span>* <span class="i">save_ary</span><span class="s">(</span><span class="w">GV</span> *<span class="w">gv</span><span class="s">)</span></code>
</strong>
</li>
<li><a class='view-title' id="HV*-save_hash(GV-*gv)"></a><strong><code class="inline"><span class="w">HV</span>* <span class="i">save_hash</span><span class="s">(</span><span class="w">GV</span> *<span class="w">gv</span><span class="s">)</span></code>
</strong>
<p>Similar to <code class="inline"><span class="w">save_scalar</span></code>
, but localize <code class="inline"><span class="i">@gv</span></code>
 and <code class="inline"><span class="i">%gv</span></code>
.</p>
</li>
<li><a class='view-title' id="void-save_item(SV-*item)"></a><strong><code class="inline"><span class="w">void</span> <span class="i">save_item</span><span class="s">(</span><span class="w">SV</span> *<span class="w">item</span><span class="s">)</span></code>
</strong>
<p>Duplicates the current value of <code class="inline"><span class="w">SV</span></code>
, on the exit from the current
<code class="inline"><span class="w">ENTER</span></code>
/<code class="inline"><span class="w">LEAVE</span></code>
 <i>pseudo-block</i> will restore the value of <code class="inline"><span class="w">SV</span></code>

using the stored value.</p>
</li>
<li><a class='view-title' id="void-save_list(SV-**sarg%2c-I32-maxsarg)"></a><strong><code class="inline"><span class="w">void</span> <span class="i">save_list</span><span class="s">(</span><span class="w">SV</span> **<span class="w">sarg</span><span class="cm">,</span> <span class="w">I32</span> <span class="w">maxsarg</span><span class="s">)</span></code>
</strong>
<p>A variant of <code class="inline"><span class="w">save_item</span></code>
 which takes multiple arguments via an array
<code class="inline"><span class="w">sarg</span></code>
 of <code class="inline"><span class="w">SV</span>*</code>
 of length <code class="inline"><span class="w">maxsarg</span></code>
.</p>
</li>
<li><a class='view-title' id="SV*-save_svref(SV-**sptr)"></a><strong><code class="inline"><span class="w">SV</span>* <span class="i">save_svref</span><span class="s">(</span><span class="w">SV</span> **<span class="w">sptr</span><span class="s">)</span></code>
</strong>
<p>Similar to <code class="inline"><span class="w">save_scalar</span></code>
, but will reinstate a <code class="inline"><span class="w">SV</span> *</code>
.</p>
</li>
<li><a class='view-title' id="void-save_aptr(AV-**aptr)"></a><strong><code class="inline"><span class="w">void</span> <span class="i">save_aptr</span><span class="s">(</span><span class="w">AV</span> **<span class="w">aptr</span><span class="s">)</span></code>
</strong>
</li>
<li><a class='view-title' id="void-save_hptr(HV-**hptr)"></a><strong><code class="inline"><span class="w">void</span> <span class="i">save_hptr</span><span class="s">(</span><span class="w">HV</span> **<span class="w">hptr</span><span class="s">)</span></code>
</strong>
<p>Similar to <code class="inline"><span class="w">save_svref</span></code>
, but localize <code class="inline"><span class="w">AV</span> *</code>
 and <code class="inline"><span class="w">HV</span> *</code>
.</p>
</li>
</ul>
<p>The <code class="inline"><span class="w">Alias</span></code>
 module implements localization of the basic types within the
<i>caller's scope</i>.  People who are interested in how to localize things in
the containing scope should take a look there too.</p>
<a class='view-head1' id="Subroutines"></a><h2 class='h2' >Subroutines</h2>
<a class='view-head2' id="XSUBs-and-the-Argument-Stack"></a><h3 class='h3' >XSUBs and the Argument Stack</h3>
<p>The XSUB mechanism is a simple way for Perl programs to access C subroutines.
An XSUB routine will have a stack that contains the arguments from the Perl
program, and a way to map from the Perl data structures to a C equivalent.</p>
<p>The stack arguments are accessible through the <code class="inline"><span class="i">ST</span><span class="s">(</span><span class="w">n</span><span class="s">)</span></code>
 macro, which returns
the <code class="inline"><span class="w">n</span></code>
'th stack argument.  Argument 0 is the first argument passed in the
Perl subroutine call.  These arguments are <code class="inline"><span class="w">SV</span>*</code>
, and can be used anywhere
an <code class="inline"><span class="w">SV</span>*</code>
 is used.</p>
<p>Most of the time, output from the C routine can be handled through use of
the RETVAL and OUTPUT directives.  However, there are some cases where the
argument stack is not already long enough to handle all the return values.
An example is the POSIX tzname() call, which takes no arguments, but returns
two, the local time zone's standard and summer time abbreviations.</p>
<p>To handle this situation, the PPCODE directive is used and the stack is
extended using the macro:</p>
<pre class="verbatim"><ol><li>    <span class="i">EXTEND</span><span class="s">(</span><span class="w">SP</span><span class="cm">,</span> <span class="w">num</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>where <code class="inline"><span class="w">SP</span></code>
 is the macro that represents the local copy of the stack pointer,
and <code class="inline"><span class="w">num</span></code>
 is the number of elements the stack should be extended by.</p>
<p>Now that there is room on the stack, values can be pushed on it using the
macros to push IVs, doubles, strings, and SV pointers respectively:</p>
<pre class="verbatim"><ol><li>    <span class="i">PUSHi</span><span class="s">(</span><span class="w">IV</span><span class="s">)</span></li><li>    <span class="i">PUSHn</span><span class="s">(</span><span class="w">double</span><span class="s">)</span></li><li>    <span class="i">PUSHp</span><span class="s">(</span><span class="w">char</span>*<span class="cm">,</span> <span class="w">I32</span><span class="s">)</span></li><li>    <span class="i">PUSHs</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>And now the Perl program calling <code class="inline"><span class="w">tzname</span></code>
, the two values will be assigned
as in:</p>
<pre class="verbatim"><ol><li>    <span class="s">(</span><span class="i">$standard_abbrev</span><span class="cm">,</span> <span class="i">$summer_abbrev</span><span class="s">)</span> = <span class="w">POSIX::tzname</span><span class="sc">;</span></li></ol></pre><p>An alternate (and possibly simpler) method to pushing values on the stack is
to use the macros:</p>
<pre class="verbatim"><ol><li>    <span class="i">XPUSHi</span><span class="s">(</span><span class="w">IV</span><span class="s">)</span></li><li>    <span class="i">XPUSHn</span><span class="s">(</span><span class="w">double</span><span class="s">)</span></li><li>    <span class="i">XPUSHp</span><span class="s">(</span><span class="w">char</span>*<span class="cm">,</span> <span class="w">I32</span><span class="s">)</span></li><li>    <span class="i">XPUSHs</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span></li></ol></pre><p>These macros automatically adjust the stack for you, if needed.  Thus, you
do not need to call <code class="inline"><span class="w">EXTEND</span></code>
 to extend the stack.</p>
<p>For more information, consult <a href="perlxs.html">perlxs</a> and <a href="perlxstut.html">perlxstut</a>.</p>
<a class='view-head2' id="Calling-Perl-Routines-from-within-C-Programs"></a><h3 class='h3' >Calling Perl Routines from within C Programs</h3>
<p>There are four routines that can be used to call a Perl subroutine from
within a C program.  These four are:</p>
<pre class="verbatim"><ol><li>    <span class="w">I32</span>  <span class="i">call_sv</span><span class="s">(</span><span class="w">SV</span>*<span class="cm">,</span> <span class="w">I32</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">I32</span>  <span class="i">call_pv</span><span class="s">(</span><span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> <span class="w">I32</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">I32</span>  <span class="i">call_method</span><span class="s">(</span><span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> <span class="w">I32</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">I32</span>  <span class="i">call_argv</span><span class="s">(</span><span class="w">const</span> <span class="w">char</span>*<span class="cm">,</span> <span class="w">I32</span><span class="cm">,</span> <span class="w">register</span> <span class="w">char</span>**<span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The routine most often used is <code class="inline"><span class="w">call_sv</span></code>
.  The <code class="inline"><span class="w">SV</span>*</code>
 argument
contains either the name of the Perl subroutine to be called, or a
reference to the subroutine.  The second argument consists of flags
that control the context in which the subroutine is called, whether
or not the subroutine is being passed arguments, how errors should be
trapped, and how to treat return values.</p>
<p>All four routines return the number of arguments that the subroutine returned
on the Perl stack.</p>
<p>These routines used to be called <code class="inline"><span class="w">perl_call_sv</span></code>
 etc., before Perl v5.6.0,
but those names are now deprecated; macros of the same name are provided for
compatibility.</p>
<p>When using any of these routines (except <code class="inline"><span class="w">call_argv</span></code>
), the programmer
must manipulate the Perl stack.  These include the following macros and
functions:</p>
<pre class="verbatim"><ol><li>    <span class="w">dSP</span></li><li>    <span class="w">SP</span></li><li>    <span class="i">PUSHMARK</span><span class="s">(</span><span class="s">)</span></li><li>    <span class="w">PUTBACK</span></li><li>    <span class="w">SPAGAIN</span></li><li>    <span class="w">ENTER</span></li><li>    <span class="w">SAVETMPS</span></li><li>    <span class="w">FREETMPS</span></li><li>    <span class="w">LEAVE</span></li><li>    <span class="w">XPUSH</span>*<span class="s">(</span><span class="s">)</span></li><li>    <span class="w">POP</span>*<span class="s">(</span><span class="s">)</span></li></ol></pre><p>For a detailed description of calling conventions from C to Perl,
consult <a href="perlcall.html">perlcall</a>.</p>
<a class='view-head2' id="Memory-Allocation"></a><h3 class='h3' >Memory Allocation</h3>
<p>All memory meant to be used with the Perl API functions should be manipulated
using the macros described in this section.  The macros provide the necessary
transparency between differences in the actual malloc implementation that is
used within perl.</p>
<p>It is suggested that you enable the version of malloc that is distributed
with Perl.  It keeps pools of various sizes of unallocated memory in
order to satisfy allocation requests more quickly.  However, on some
platforms, it may cause spurious malloc or free errors.</p>
<pre class="verbatim"><ol><li>    <span class="i">New</span><span class="s">(</span><span class="w">x</span><span class="cm">,</span> <span class="w">pointer</span><span class="cm">,</span> <span class="w">number</span><span class="cm">,</span> <span class="w">type</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">Newc</span><span class="s">(</span><span class="w">x</span><span class="cm">,</span> <span class="w">pointer</span><span class="cm">,</span> <span class="w">number</span><span class="cm">,</span> <span class="w">type</span><span class="cm">,</span> <span class="w">cast</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">Newz</span><span class="s">(</span><span class="w">x</span><span class="cm">,</span> <span class="w">pointer</span><span class="cm">,</span> <span class="w">number</span><span class="cm">,</span> <span class="w">type</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>These three macros are used to initially allocate memory.</p>
<p>The first argument <code class="inline"><span class="w">x</span></code>
 was a "magic cookie" that was used to keep track
of who called the macro, to help when debugging memory problems.  However,
the current code makes no use of this feature (most Perl developers now
use run-time memory checkers), so this argument can be any number.</p>
<p>The second argument <code class="inline"><span class="w">pointer</span></code>
 should be the name of a variable that will
point to the newly allocated memory.</p>
<p>The third and fourth arguments <code class="inline"><span class="w">number</span></code>
 and <code class="inline"><span class="w">type</span></code>
 specify how many of
the specified type of data structure should be allocated.  The argument
<code class="inline"><span class="w">type</span></code>
 is passed to <code class="inline"><span class="w">sizeof</span></code>
.  The final argument to <code class="inline"><span class="w">Newc</span></code>
, <code class="inline"><span class="w">cast</span></code>
,
should be used if the <code class="inline"><span class="w">pointer</span></code>
 argument is different from the <code class="inline"><span class="w">type</span></code>

argument.</p>
<p>Unlike the <code class="inline"><span class="w">New</span></code>
 and <code class="inline"><span class="w">Newc</span></code>
 macros, the <code class="inline"><span class="w">Newz</span></code>
 macro calls <code class="inline"><span class="w">memzero</span></code>

to zero out all the newly allocated memory.</p>
<pre class="verbatim"><ol><li>    <span class="i">Renew</span><span class="s">(</span><span class="w">pointer</span><span class="cm">,</span> <span class="w">number</span><span class="cm">,</span> <span class="w">type</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">Renewc</span><span class="s">(</span><span class="w">pointer</span><span class="cm">,</span> <span class="w">number</span><span class="cm">,</span> <span class="w">type</span><span class="cm">,</span> <span class="w">cast</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">Safefree</span><span class="s">(</span><span class="w">pointer</span><span class="s">)</span></li></ol></pre><p>These three macros are used to change a memory buffer size or to free a
piece of memory no longer needed.  The arguments to <code class="inline"><span class="w">Renew</span></code>
 and <code class="inline"><span class="w">Renewc</span></code>

match those of <code class="inline"><span class="w">New</span></code>
 and <code class="inline"><span class="w">Newc</span></code>
 with the exception of not needing the
"magic cookie" argument.</p>
<pre class="verbatim"><ol><li>    <span class="i">Move</span><span class="s">(</span><span class="w">source</span><span class="cm">,</span> <span class="w">dest</span><span class="cm">,</span> <span class="w">number</span><span class="cm">,</span> <span class="w">type</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">Copy</span><span class="s">(</span><span class="w">source</span><span class="cm">,</span> <span class="w">dest</span><span class="cm">,</span> <span class="w">number</span><span class="cm">,</span> <span class="w">type</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">Zero</span><span class="s">(</span><span class="w">dest</span><span class="cm">,</span> <span class="w">number</span><span class="cm">,</span> <span class="w">type</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>These three macros are used to move, copy, or zero out previously allocated
memory.  The <code class="inline"><span class="w">source</span></code>
 and <code class="inline"><span class="w">dest</span></code>
 arguments point to the source and
destination starting points.  Perl will move, copy, or zero out <code class="inline"><span class="w">number</span></code>

instances of the size of the <code class="inline"><span class="w">type</span></code>
 data structure (using the <code class="inline"><span class="w">sizeof</span></code>

function).</p>
<a class='view-head2' id="PerlIO"></a><h3 class='h3' >PerlIO</h3>
<p>The most recent development releases of Perl has been experimenting with
removing Perl's dependency on the "normal" standard I/O suite and allowing
other stdio implementations to be used.  This involves creating a new
abstraction layer that then calls whichever implementation of stdio Perl
was compiled with.  All XSUBs should now use the functions in the PerlIO
abstraction layer and not make any assumptions about what kind of stdio
is being used.</p>
<p>For a complete description of the PerlIO abstraction, consult <a href="perlapio.html">perlapio</a>.</p>
<a class='view-head2' id="Putting-a-C-value-on-Perl-stack"></a><h3 class='h3' >Putting a C value on Perl stack</h3>
<p>A lot of opcodes (this is an elementary operation in the internal perl
stack machine) put an SV* on the stack. However, as an optimization
the corresponding SV is (usually) not recreated each time. The opcodes
reuse specially assigned SVs (<i>target</i>s) which are (as a corollary)
not constantly freed/created.</p>
<p>Each of the targets is created only once (but see
<a href="#Scratchpads-and-recursion">Scratchpads and recursion</a> below), and when an opcode needs to put
an integer, a double, or a string on stack, it just sets the
corresponding parts of its <i>target</i> and puts the <i>target</i> on stack.</p>
<p>The macro to put this target on stack is <code class="inline"><span class="w">PUSHTARG</span></code>
, and it is
directly used in some opcodes, as well as indirectly in zillions of
others, which use it via <code class="inline"><span class="s">(</span><span class="w">X</span><span class="s">)</span><span class="w">PUSH</span><span class="s">[</span><span class="w">pni</span><span class="s">]</span></code>
.</p>
<a class='view-head2' id="Scratchpads"></a><h3 class='h3' >Scratchpads</h3>
<p>The question remains on when the SVs which are <i>target</i>s for opcodes
are created. The answer is that they are created when the current unit --
a subroutine or a file (for opcodes for statements outside of
subroutines) -- is compiled. During this time a special anonymous Perl
array is created, which is called a scratchpad for the current
unit.</p>
<p>A scratchpad keeps SVs which are lexicals for the current unit and are
targets for opcodes. One can deduce that an SV lives on a scratchpad
by looking on its flags: lexicals have <code class="inline"><span class="w">SVs_PADMY</span></code>
 set, and
<i>target</i>s have <code class="inline"><span class="w">SVs_PADTMP</span></code>
 set.</p>
<p>The correspondence between OPs and <i>target</i>s is not 1-to-1. Different
OPs in the compile tree of the unit can use the same target, if this
would not conflict with the expected life of the temporary.</p>
<a class='view-head2' id="Scratchpads-and-recursion"></a><h3 class='h3' >Scratchpads and recursion</h3>
<p>In fact it is not 100% true that a compiled unit contains a pointer to
the scratchpad AV. In fact it contains a pointer to an AV of
(initially) one element, and this element is the scratchpad AV. Why do
we need an extra level of indirection?</p>
<p>The answer is <strong>recursion</strong>, and maybe (sometime soon) <strong>threads</strong>. Both
these can create several execution pointers going into the same
subroutine. For the subroutine-child not write over the temporaries
for the subroutine-parent (lifespan of which covers the call to the
child), the parent and the child should have different
scratchpads. (<i>And</i> the lexicals should be separate anyway!)</p>
<p>So each subroutine is born with an array of scratchpads (of length 1).
On each entry to the subroutine it is checked that the current
depth of the recursion is not more than the length of this array, and
if it is, new scratchpad is created and pushed into the array.</p>
<p>The <i>target</i>s on this scratchpad are <code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code>s, but they are already
marked with correct flags.</p>
<a class='view-head1' id="Compiled-code"></a><h2 class='h2' >Compiled code</h2>
<a class='view-head2' id="Code-tree"></a><h3 class='h3' >Code tree</h3>
<p>Here we describe the internal form your code is converted to by
Perl. Start with a simple example:</p>
<pre class="verbatim"><ol><li>  <span class="i">$a</span> = <span class="i">$b</span> + <span class="i">$c</span><span class="sc">;</span></li></ol></pre><p>This is converted to a tree similar to this one:</p>
<pre class="verbatim"><ol><li>             <span class="w">assign</span>-<span class="w">to</span></li><li>           <span class="q">/           \</span></li><li>          <span class="q">          +             $a</span></li><li>        <span class="q">        /</span>   \</li><li>      <span class="i">$b</span>     <span class="i">$c</span></li></ol></pre><p>(but slightly more complicated).  This tree reflects the way Perl
parsed your code, but has nothing to do with the execution order.
There is an additional "thread" going through the nodes of the tree
which shows the order of execution of the nodes.  In our simplified
example above it looks like:</p>
<pre class="verbatim"><ol><li>     <span class="i">$b</span> --<span class="i">-&gt; $c</span> ---&gt; + --<span class="i">-&gt; $a</span> --<span class="i">-&gt; assign</span>-<span class="w">to</span></li></ol></pre><p>But with the actual compile tree for <code class="inline"><span class="i">$a</span> = <span class="i">$b</span> + <span class="i">$c</span></code>
 it is different:
some nodes <i>optimized away</i>.  As a corollary, though the actual tree
contains more nodes than our simplified example, the execution order
is the same as in our example.</p>
<a class='view-head2' id="Examining-the-tree"></a><h3 class='h3' >Examining the tree</h3>
<p>If you have your perl compiled for debugging (usually done with <code class="inline">-<span class="w">D</span>
<span class="w">optimize</span>=-g</code>
 on <code class="inline"><span class="w">Configure</span></code>
 command line), you may examine the
compiled tree by specifying <code class="inline">-<span class="w">Dx</span></code>
 on the Perl command line.  The
output takes several lines per node, and for <code class="inline"><span class="i">$b</span>+<span class="i">$c</span></code>
 it looks like
this:</p>
<pre class="verbatim"><ol><li>    <span class="n">5</span>           <span class="w">TYPE</span> = <span class="w">add</span>  ==<span class="cm">=&gt;</span> <span class="n">6</span></li><li>                <span class="w">TARG</span> = <span class="n">1</span></li><li>                <span class="w">FLAGS</span> = <span class="s">(</span><span class="w">SCALAR</span><span class="cm">,</span><span class="w">KIDS</span><span class="s">)</span></li><li>                <span class="s">{</span></li><li>                    <span class="w">TYPE</span> = <span class="w">null</span>  ==<span class="cm">=&gt;</span> <span class="s">(</span><span class="n">4</span><span class="s">)</span></li><li>                      <span class="s">(</span><span class="w">was</span> <span class="w">rv2sv</span><span class="s">)</span></li><li>                    <span class="w">FLAGS</span> = <span class="s">(</span><span class="w">SCALAR</span><span class="cm">,</span><span class="w">KIDS</span><span class="s">)</span></li><li>                    <span class="s">{</span></li><li>    <span class="n">3</span>                   <span class="w">TYPE</span> = <span class="w">gvsv</span>  ==<span class="cm">=&gt;</span> <span class="n">4</span></li><li>                        <span class="w">FLAGS</span> = <span class="s">(</span><span class="w">SCALAR</span><span class="s">)</span></li><li>                        <span class="w">GV</span> = <span class="w">main::b</span></li><li>                    <span class="s">}</span></li><li>                <span class="s">}</span></li><li>                <span class="s">{</span></li><li>                    <span class="w">TYPE</span> = <span class="w">null</span>  ==<span class="cm">=&gt;</span> <span class="s">(</span><span class="n">5</span><span class="s">)</span></li><li>                      <span class="s">(</span><span class="w">was</span> <span class="w">rv2sv</span><span class="s">)</span></li><li>                    <span class="w">FLAGS</span> = <span class="s">(</span><span class="w">SCALAR</span><span class="cm">,</span><span class="w">KIDS</span><span class="s">)</span></li><li>                    <span class="s">{</span></li><li>    <span class="n">4</span>                   <span class="w">TYPE</span> = <span class="w">gvsv</span>  ==<span class="cm">=&gt;</span> <span class="n">5</span></li><li>                        <span class="w">FLAGS</span> = <span class="s">(</span><span class="w">SCALAR</span><span class="s">)</span></li><li>                        <span class="w">GV</span> = <span class="w">main::c</span></li><li>                    <span class="s">}</span></li><li>                <span class="s">}</span></li></ol></pre><p>This tree has 5 nodes (one per <code class="inline"><span class="w">TYPE</span></code>
 specifier), only 3 of them are
not optimized away (one per number in the left column).  The immediate
children of the given node correspond to <code class="inline"><span class="s">{</span><span class="s">}</span></code>
 pairs on the same level
of indentation, thus this listing corresponds to the tree:</p>
<pre class="verbatim"><ol><li>                   <span class="w">add</span></li><li>                 <span class="q">/     \</span></li><li>               <span class="q">               null    null</span></li><li>                <span class="q">                |       |</span></li><li>               <span class="q">               gvsv    gvsv</span></li></ol></pre><p>The execution order is indicated by <code class="inline">==<span class="cm">=&gt;</span></code>
 marks, thus it is <code class="inline"><span class="n">3</span>
<span class="n">4</span> <span class="n">5</span> <span class="n">6</span></code>
 (node <code class="inline"><span class="n">6</span></code>
 is not included into above listing), i.e.,
<code class="inline"><span class="w">gvsv</span> <span class="w">gvsv</span> <span class="w">add</span> <span class="w">whatever</span></code>
.</p>
<a class='view-head2' id="Compile-pass-1%3a-check-routines"></a><h3 class='h3' >Compile pass 1: check routines</h3>
<p>The tree is created by the <i>pseudo-compiler</i> while yacc code feeds it
the constructions it recognizes. Since yacc works bottom-up, so does
the first pass of perl compilation.</p>
<p>What makes this pass interesting for perl developers is that some
optimization may be performed on this pass.  This is optimization by
so-called <i>check routines</i>.  The correspondence between node names
and corresponding check routines is described in <i>opcode.pl</i> (do not
forget to run <code class="inline"><span class="w">make</span> <span class="w">regen_headers</span></code>
 if you modify this file).</p>
<p>A check routine is called when the node is fully constructed except
for the execution-order thread.  Since at this time there are no
back-links to the currently constructed node, one can do most any
operation to the top-level node, including freeing it and/or creating
new nodes above/below it.</p>
<p>The check routine returns the node which should be inserted into the
tree (if the top-level node was not modified, check routine returns
its argument).</p>
<p>By convention, check routines have names <code class="inline"><span class="w">ck_</span>*</code>
. They are usually
called from <code class="inline"><span class="w">new</span>*<span class="w">OP</span></code>
 subroutines (or <code class="inline"><span class="w">convert</span></code>
) (which in turn are
called from <i>perly.y</i>).</p>
<a class='view-head2' id="Compile-pass-1a%3a-constant-folding"></a><h3 class='h3' >Compile pass 1a: constant folding</h3>
<p>Immediately after the check routine is called the returned node is
checked for being compile-time executable.  If it is (the value is
judged to be constant) it is immediately executed, and a <i>constant</i>
node with the "return value" of the corresponding subtree is
substituted instead.  The subtree is deleted.</p>
<p>If constant folding was not performed, the execution-order thread is
created.</p>
<a class='view-head2' id="Compile-pass-2%3a-context-propagation"></a><h3 class='h3' >Compile pass 2: context propagation</h3>
<p>When a context for a part of compile tree is known, it is propagated
down through the tree.  At this time the context can have 5 values
(instead of 2 for runtime context): void, boolean, scalar, list, and
lvalue.  In contrast with the pass 1 this pass is processed from top
to bottom: a node's context determines the context for its children.</p>
<p>Additional context-dependent optimizations are performed at this time.
Since at this moment the compile tree contains back-references (via
"thread" pointers), nodes cannot be free()d now.  To allow
optimized-away nodes at this stage, such nodes are null()ified instead
of free()ing (i.e. their type is changed to OP_NULL).</p>
<a class='view-head2' id="Compile-pass-3%3a-peephole-optimization"></a><h3 class='h3' >Compile pass 3: peephole optimization</h3>
<p>After the compile tree for a subroutine (or for an <code class="inline"><a class="l_k" href="functions/eval.html">eval</a></code> or a file)
is created, an additional pass over the code is performed. This pass
is neither top-down or bottom-up, but in the execution order (with
additional complications for conditionals).  These optimizations are
done in the subroutine peep().  Optimizations performed at this stage
are subject to the same restrictions as in the pass 2.</p>
<a class='view-head1' id="How-multiple-interpreters-and-concurrency-are-supported"></a><h2 class='h2' >How multiple interpreters and concurrency are supported</h2>
<p>WARNING: This information is subject to radical changes prior to
the Perl 5.6 release.  Use with caution.</p>
<a class='view-head2' id="Background-and-PERL_IMPLICIT_CONTEXT"></a><h3 class='h3' >Background and PERL_IMPLICIT_CONTEXT</h3>
<p>The Perl interpreter can be regarded as a closed box: it has an API
for feeding it code or otherwise making it do things, but it also has
functions for its own use.  This smells a lot like an object, and
there are ways for you to build Perl so that you can have multiple
interpreters, with one interpreter represented either as a C++ object,
a C structure, or inside a thread.  The thread, the C structure, or
the C++ object will contain all the context, the state of that
interpreter.</p>
<p>Three macros control the major Perl build flavors: MULTIPLICITY,
USE_THREADS and PERL_OBJECT.  The MULTIPLICITY build has a C structure
that packages all the interpreter state, there is a similar thread-specific
data structure under USE_THREADS, and the PERL_OBJECT build has a C++
class to maintain interpreter state.  In all three cases,
PERL_IMPLICIT_CONTEXT is also normally defined, and enables the
support for passing in a "hidden" first argument that represents all three
data structures.</p>
<p>All this obviously requires a way for the Perl internal functions to be
C++ methods, subroutines taking some kind of structure as the first
argument, or subroutines taking nothing as the first argument.  To
enable these three very different ways of building the interpreter,
the Perl source (as it does in so many other situations) makes heavy
use of macros and subroutine naming conventions.</p>
<p>First problem: deciding which functions will be public API functions and
which will be private.  All functions whose names begin <code class="inline"><span class="w">S_</span></code>
 are private 
(think "S" for "secret" or "static").  All other functions begin with
"Perl_", but just because a function begins with "Perl_" does not mean it is
part of the API. The easiest way to be <strong>sure</strong> a function is part of the API
is to find its entry in <a href="perlapi.html">perlapi</a>.  If it exists in <a href="perlapi.html">perlapi</a>, it's part
of the API.  If it doesn't, and you think it should be (i.e., you need it fo
r your extension), send mail via <a href="perlbug.html">perlbug</a> explaining why you think it
should be.</p>
<p>(<a href="perlapi.html">perlapi</a> itself is generated by embed.pl, a Perl script that generates
significant portions of the Perl source code.  It has a list of almost
all the functions defined by the Perl interpreter along with their calling
characteristics and some flags.  Functions that are part of the public API
are marked with an 'A' in its flags.)</p>
<p>Second problem: there must be a syntax so that the same subroutine
declarations and calls can pass a structure as their first argument,
or pass nothing.  To solve this, the subroutines are named and
declared in a particular way.  Here's a typical start of a static
function used within the Perl guts:</p>
<pre class="verbatim"><ol><li>  <span class="w">STATIC</span> <span class="w">void</span></li><li>  <span class="i">S_incline</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">char</span> *<span class="q">s)</span></li></ol></pre><p>STATIC becomes "static" in C, and is #define'd to nothing in C++.</p>
<p>A public function (i.e. part of the internal API, but not necessarily
sanctioned for use in extensions) begins like this:</p>
<pre class="verbatim"><ol><li>  <span class="w">void</span></li><li>  <span class="i">Perl_sv_setsv</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">SV</span>* <span class="w">dsv</span><span class="cm">,</span> <span class="w">SV</span>* <span class="w">ssv</span><span class="s">)</span></li></ol></pre><p><code class="inline"><span class="w">pTHX_</span></code>
 is one of a number of macros (in perl.h) that hide the
details of the interpreter's context.  THX stands for "thread", "this",
or "thingy", as the case may be.  (And no, George Lucas is not involved. :-)
The first character could be 'p' for a <strong>p</strong>rototype, 'a' for <strong>a</strong>rgument,
or 'd' for <strong>d</strong>eclaration.</p>
<p>When Perl is built without PERL_IMPLICIT_CONTEXT, there is no first
argument containing the interpreter's context.  The trailing underscore
in the pTHX_ macro indicates that the macro expansion needs a comma
after the context argument because other arguments follow it.  If
PERL_IMPLICIT_CONTEXT is not defined, pTHX_ will be ignored, and the
subroutine is not prototyped to take the extra argument.  The form of the
macro without the trailing underscore is used when there are no additional
explicit arguments.</p>
<p>When a core function calls another, it must pass the context.  This
is normally hidden via macros.  Consider <code class="inline"><span class="w">sv_setsv</span></code>
.  It expands
something like this:</p>
<pre class="verbatim"><ol><li>    <span class="w">ifdef</span> <span class="w">PERL_IMPLICIT_CONTEXT</span></li><li>      <span class="w">define</span> <span class="i">sv_setsv</span><span class="s">(</span><span class="w">a</span><span class="cm">,</span><span class="w">b</span><span class="s">)</span>	<span class="i">Perl_sv_setsv</span><span class="s">(</span><span class="w">aTHX_</span> <span class="w">a</span><span class="cm">,</span> <span class="w">b</span><span class="s">)</span></li><li>      /<span class="i">* can&#39;t</span> <a class="l_k" href="functions/do.html">do</a> <span class="w">this</span> for <span class="w">vararg</span> <span class="w">functions</span><span class="cm">,</span> <span class="w">see</span> <span class="w">below</span> *<span class="q">/</span></li><li>    <span class="q">    else</span></li><li>      <span class="q">      define sv_setsv		Perl_sv_setsv</span></li><li>    <span class="q">    endif</span></li></ol></pre><p>This works well, and means that XS authors can gleefully write:</p>
<pre class="verbatim"><ol><li>    <span class="i">sv_setsv</span><span class="s">(</span><span class="w">foo</span><span class="cm">,</span> <span class="w">bar</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>and still have it work under all the modes Perl could have been
compiled with.</p>
<p>Under PERL_OBJECT in the core, that will translate to either:</p>
<pre class="verbatim"><ol><li>    <span class="i">CPerlObj::Perl_sv_setsv</span><span class="s">(</span><span class="w">foo</span><span class="cm">,</span><span class="w">bar</span><span class="s">)</span><span class="sc">;</span>  <span class="c"># in CPerlObj functions,</span></li><li>                                       <span class="c"># C++ takes care of &#39;this&#39;</span></li><li>  or</li><li></li><li>    <span class="w">pPerl</span><span class="w">-&gt;Perl_sv_setsv</span><span class="s">(</span><span class="w">foo</span><span class="cm">,</span><span class="w">bar</span><span class="s">)</span><span class="sc">;</span>     <span class="c"># in truly static functions,</span></li><li>                                       <span class="c"># see objXSUB.h</span></li></ol></pre><p>Under PERL_OBJECT in extensions (aka PERL_CAPI), or under
MULTIPLICITY/USE_THREADS w/ PERL_IMPLICIT_CONTEXT in both core
and extensions, it will be:</p>
<pre class="verbatim"><ol><li>    <span class="i">Perl_sv_setsv</span><span class="s">(</span><span class="w">aTHX_</span> <span class="w">foo</span><span class="cm">,</span> <span class="w">bar</span><span class="s">)</span><span class="sc">;</span>     <span class="c"># the canonical Perl &quot;API&quot;</span></li><li>                                       <span class="c"># for all build flavors</span></li></ol></pre><p>This doesn't work so cleanly for varargs functions, though, as macros
imply that the number of arguments is known in advance.  Instead we
either need to spell them out fully, passing <code class="inline"><span class="w">aTHX_</span></code>
 as the first
argument (the Perl core tends to do this with functions like
Perl_warner), or use a context-free version.</p>
<p>The context-free version of Perl_warner is called
Perl_warner_nocontext, and does not take the extra argument.  Instead
it does dTHX; to get the context from thread-local storage.  We
<code class="inline"><span class="c">#define warner Perl_warner_nocontext</span></code>
 so that extensions get source
compatibility at the expense of performance.  (Passing an arg is
cheaper than grabbing it from thread-local storage.)</p>
<p>You can ignore [pad]THX[xo] when browsing the Perl headers/sources.
Those are strictly for use within the core.  Extensions and embedders
need only be aware of [pad]THX.</p>
<a class='view-head2' id="How-do-I-use-all-this-in-extensions%3f"></a><h3 class='h3' >How do I use all this in extensions?</h3>
<p>When Perl is built with PERL_IMPLICIT_CONTEXT, extensions that call
any functions in the Perl API will need to pass the initial context
argument somehow.  The kicker is that you will need to write it in
such a way that the extension still compiles when Perl hasn't been
built with PERL_IMPLICIT_CONTEXT enabled.</p>
<p>There are three ways to do this.  First, the easy but inefficient way,
which is also the default, in order to maintain source compatibility
with extensions: whenever XSUB.h is #included, it redefines the aTHX
and aTHX_ macros to call a function that will return the context.
Thus, something like:</p>
<pre class="verbatim"><ol><li>        <span class="i">sv_setsv</span><span class="s">(</span><span class="w">asv</span><span class="cm">,</span> <span class="w">bsv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>in your extesion will translate to this when PERL_IMPLICIT_CONTEXT is
in effect:</p>
<pre class="verbatim"><ol><li>        <span class="i">Perl_sv_setsv</span><span class="s">(</span><span class="i">Perl_get_context</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="w">asv</span><span class="cm">,</span> <span class="w">bsv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>or to this otherwise:</p>
<pre class="verbatim"><ol><li>        <span class="i">Perl_sv_setsv</span><span class="s">(</span><span class="w">asv</span><span class="cm">,</span> <span class="w">bsv</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>You have to do nothing new in your extension to get this; since
the Perl library provides Perl_get_context(), it will all just
work.</p>
<p>The second, more efficient way is to use the following template for
your Foo.xs:</p>
<pre class="verbatim"><ol><li>	<span class="c">#define PERL_NO_GET_CONTEXT	/* we want efficiency */</span></li><li>	<span class="c">#include &quot;EXTERN.h&quot;</span></li><li>	<span class="c">#include &quot;perl.h&quot;</span></li><li>	<span class="c">#include &quot;XSUB.h&quot;</span></li><li></li><li>        <span class="w">static</span> <span class="i">my_private_function</span><span class="s">(</span><a class="l_k" href="functions/int.html">int</a> <span class="w">arg1</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">arg2</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>	<span class="w">static</span> <span class="w">SV</span> *</li><li>	<span class="i">my_private_function</span><span class="s">(</span><a class="l_k" href="functions/int.html">int</a> <span class="w">arg1</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">arg2</span><span class="s">)</span></li><li>	<span class="s">{</span></li><li>	    <span class="w">dTHX</span><span class="sc">;</span>	<span class="q">/* fetch context */</span></li><li>	    ... <span class="w">call</span> <span class="w">many</span> <span class="w">Perl</span> <span class="w">API</span> <span class="w">functions</span> ...</li><li>	<span class="s">}</span></li><li></li><li>        <span class="s">[</span>... <span class="w">etc</span> ...<span class="s">]</span></li><li></li><li>	<span class="w">MODULE</span> = <span class="w">Foo</span>		<span class="w">PACKAGE</span> = <span class="w">Foo</span></li><li></li><li>	<span class="q">/* typical XSUB */</span></li><li></li><li>	<span class="w">void</span></li><li>	<span class="i">my_xsub</span><span class="s">(</span><span class="w">arg</span><span class="s">)</span></li><li>		<a class="l_k" href="functions/int.html">int</a> <span class="w">arg</span></li><li>	    <span class="w">CODE</span><span class="co">:</span></li><li>		<span class="i">my_private_function</span><span class="s">(</span><span class="w">arg</span><span class="cm">,</span> <span class="n">10</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Note that the only two changes from the normal way of writing an
extension is the addition of a <code class="inline"><span class="c">#define PERL_NO_GET_CONTEXT</span></code>
 before
including the Perl headers, followed by a <code class="inline"><span class="w">dTHX</span><span class="sc">;</span></code>
 declaration at
the start of every function that will call the Perl API.  (You'll
know which functions need this, because the C compiler will complain
that there's an undeclared identifier in those functions.)  No changes
are needed for the XSUBs themselves, because the XS() macro is
correctly defined to pass in the implicit context if needed.</p>
<p>The third, even more efficient way is to ape how it is done within
the Perl guts:</p>
<pre class="verbatim"><ol><li>	<span class="c">#define PERL_NO_GET_CONTEXT	/* we want efficiency */</span></li><li>	<span class="c">#include &quot;EXTERN.h&quot;</span></li><li>	<span class="c">#include &quot;perl.h&quot;</span></li><li>	<span class="c">#include &quot;XSUB.h&quot;</span></li><li></li><li>        <span class="q">/* pTHX_ only needed for functions that call Perl API */</span></li><li>        <span class="w">static</span> <span class="i">my_private_function</span><span class="s">(</span><span class="w">pTHX_</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">arg1</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">arg2</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>	<span class="w">static</span> <span class="w">SV</span> *</li><li>	<span class="i">my_private_function</span><span class="s">(</span><span class="w">pTHX_</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">arg1</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">arg2</span><span class="s">)</span></li><li>	<span class="s">{</span></li><li>	    <span class="q">/* dTHX; not needed here, because THX is an argument */</span></li><li>	    ... <span class="w">call</span> <span class="w">Perl</span> <span class="w">API</span> <span class="w">functions</span> ...</li><li>	<span class="s">}</span></li><li></li><li>        <span class="s">[</span>... <span class="w">etc</span> ...<span class="s">]</span></li><li></li><li>	<span class="w">MODULE</span> = <span class="w">Foo</span>		<span class="w">PACKAGE</span> = <span class="w">Foo</span></li><li></li><li>	<span class="q">/* typical XSUB */</span></li><li></li><li>	<span class="w">void</span></li><li>	<span class="i">my_xsub</span><span class="s">(</span><span class="w">arg</span><span class="s">)</span></li><li>		<a class="l_k" href="functions/int.html">int</a> <span class="w">arg</span></li><li>	    <span class="w">CODE</span><span class="co">:</span></li><li>		<span class="i">my_private_function</span><span class="s">(</span><span class="w">aTHX_</span> <span class="w">arg</span><span class="cm">,</span> <span class="n">10</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>This implementation never has to fetch the context using a function
call, since it is always passed as an extra argument.  Depending on
your needs for simplicity or efficiency, you may mix the previous
two approaches freely.</p>
<p>Never add a comma after <code class="inline"><span class="w">pTHX</span></code>
 yourself--always use the form of the
macro with the underscore for functions that take explicit arguments,
or the form without the argument for functions with no explicit arguments.</p>
<a class='view-head2' id="Future-Plans-and-PERL_IMPLICIT_SYS"></a><h3 class='h3' >Future Plans and PERL_IMPLICIT_SYS</h3>
<p>Just as PERL_IMPLICIT_CONTEXT provides a way to bundle up everything
that the interpreter knows about itself and pass it around, so too are
there plans to allow the interpreter to bundle up everything it knows
about the environment it's running on.  This is enabled with the
PERL_IMPLICIT_SYS macro.  Currently it only works with PERL_OBJECT,
but is mostly there for MULTIPLICITY and USE_THREADS (see inside
iperlsys.h).</p>
<p>This allows the ability to provide an extra pointer (called the "host"
environment) for all the system calls.  This makes it possible for
all the system stuff to maintain their own state, broken down into
seven C structures.  These are thin wrappers around the usual system
calls (see win32/perllib.c) for the default perl executable, but for a
more ambitious host (like the one that would do fork() emulation) all
the extra work needed to pretend that different interpreters are
actually different "processes", would be done here.</p>
<p>The Perl engine/interpreter and the host are orthogonal entities.
There could be one or more interpreters in a process, and one or
more "hosts", with free association between them.</p>
<a class='view-head1' id="AUTHORS"></a><h2 class='h2' >AUTHORS</h2>
<p>Until May 1997, this document was maintained by Jeff Okamoto
&lt;okamoto@corp.hp.com&gt;.  It is now maintained as part of Perl itself
by the Perl 5 Porters &lt;perl5-porters@perl.org&gt;.</p>
<p>With lots of help and suggestions from Dean Roehrich, Malcolm Beattie,
Andreas Koenig, Paul Hudson, Ilya Zakharevich, Paul Marquess, Neil
Bowers, Matthew Green, Tim Bunce, Spider Boardman, Ulrich Pfeifer,
Stephen McCamant, and Gurusamy Sarathy.</p>
<p>API Listing originally by Dean Roehrich &lt;roehrich@cray.com&gt;.</p>
<p>Modifications to autogenerate the API listing (<a href="perlapi.html">perlapi</a>) by Benjamin
Stuhl.</p>
<a class='view-head1' id="SEE-ALSO"></a><h2 class='h2' >SEE ALSO</h2>
<p>perlapi(1), perlintern(1), perlxs(1), perlembed(1)</p>




      <ul><li><a href="#NAME">NAME</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><li><a href="#Variables">Variables</a></li><ul><li><a href="#Datatypes">Datatypes</a></li><li><a href="#What-is-an-%22IV%22%3f">What is an "IV"?</a></li><li><a href="#Working-with-SVs">Working with SVs</a></li><li><a href="#What's-Really-Stored-in-an-SV%3f">What's Really Stored in an SV?</a></li><li><a href="#Working-with-AVs">Working with AVs</a></li><li><a href="#Working-with-HVs">Working with HVs</a></li><li><a href="#Hash-API-Extensions">Hash API Extensions</a></li><li><a href="#References">References</a></li><li><a href="#Blessed-References-and-Class-Objects">Blessed References and Class Objects</a></li><li><a href="#Creating-New-Variables">Creating New Variables</a></li><li><a href="#Reference-Counts-and-Mortality">Reference Counts and Mortality</a></li><li><a href="#Stashes-and-Globs">Stashes and Globs</a></li><li><a href="#Double-Typed-SVs">Double-Typed SVs</a></li><li><a href="#Magic-Variables">Magic Variables</a></li><li><a href="#Assigning-Magic">Assigning Magic</a></li><li><a href="#Magic-Virtual-Tables">Magic Virtual Tables</a></li><li><a href="#Finding-Magic">Finding Magic</a></li><li><a href="#Understanding-the-Magic-of-Tied-Hashes-and-Arrays">Understanding the Magic of Tied Hashes and Arrays</a></li><li><a href="#Localizing-changes">Localizing changes</a></li></ul><li><a href="#Subroutines">Subroutines</a></li><ul><li><a href="#XSUBs-and-the-Argument-Stack">XSUBs and the Argument Stack</a></li><li><a href="#Calling-Perl-Routines-from-within-C-Programs">Calling Perl Routines from within C Programs</a></li><li><a href="#Memory-Allocation">Memory Allocation</a></li><li><a href="#PerlIO">PerlIO</a></li><li><a href="#Putting-a-C-value-on-Perl-stack">Putting a C value on Perl stack</a></li><li><a href="#Scratchpads">Scratchpads</a></li><li><a href="#Scratchpads-and-recursion">Scratchpads and recursion</a></li></ul><li><a href="#Compiled-code">Compiled code</a></li><ul><li><a href="#Code-tree">Code tree</a></li><li><a href="#Examining-the-tree">Examining the tree</a></li><li><a href="#Compile-pass-1%3a-check-routines">Compile pass 1: check routines</a></li><li><a href="#Compile-pass-1a%3a-constant-folding">Compile pass 1a: constant folding</a></li><li><a href="#Compile-pass-2%3a-context-propagation">Compile pass 2: context propagation</a></li><li><a href="#Compile-pass-3%3a-peephole-optimization">Compile pass 3: peephole optimization</a></li></ul><li><a href="#How-multiple-interpreters-and-concurrency-are-supported">How multiple interpreters and concurrency are supported</a></li><ul><li><a href="#Background-and-PERL_IMPLICIT_CONTEXT">Background and PERL_IMPLICIT_CONTEXT</a></li><li><a href="#How-do-I-use-all-this-in-extensions%3f">How do I use all this in extensions?</a></li><li><a href="#Future-Plans-and-PERL_IMPLICIT_SYS">Future Plans and PERL_IMPLICIT_SYS</a></li></ul><li><a href="#AUTHORS">AUTHORS</a></li><li><a href="#SEE-ALSO">SEE ALSO</a></li></ul>


                  </div>
                </article>
              </div>
            </div>
          </main>
        </div>
           <footer class="footer row bg-light pt-5 pb-5">
       <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
           <div class="row">
               <div class="col-md-4">
                   <ul class="list-unstyled">
                       <li>
                           <h4>Site info</h4>
                       </li>
                       <li>Docs mantained by
                           <a href="//lists.perl.org/list/perl5-porters.html"
                               rel="noopener">Perl 5 Porters</a>
                       </li>
                       <li>Perldoc site development sponsored by
                           <a href="//opusvl.com" rel="noopener">
                           <img style="margin: 20px 20px 5px 10px" class="opus-logo" src="/public/img/opusvl_logo.svg" alt="OpusVL Logo">
                        </a>
                    <li><span class="about_perldoc"><a href="//about.html">About PerlDOC</a></span>
                    </li>
                       </li>
                   </ul>
               </div>
               <div class="col-md-8">
                   <div class="row">
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Manuals</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-overview.html">Overview</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-tutorials.html">Tutorials</a>
                               </li>
                               <li>
                                   <a href="/5.6.0/index-faq.html">FAQs</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-history.html">Changes</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Reference</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-language.html">Language</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-functions.html">Functions</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/perlop.html">Operators</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/perlvar.html">Variables</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Modules</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-modules-A.html">Modules</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-pragmas.html">Pragmas</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-utilities.html">Utilities</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Misc</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-licence.html">License</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-internals.html">Internals</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.6.0/index-platforms.html">Platforms</a>
                               </li>
                            <li>
                                <a
                                    href="/5.6.0/index-about.html">About</a>
                            </li>
                           </ul>
                       </div>
                   </div>
               </div>
               <div class=" col-12 footer-inf text-center">
                   <small>perldoc.perl.org - Official documentation for the Perl
                       programming language</small>
               </div>
           </div>
       </div>
   </footer>

        	<div class="beta-wrapper beta-bottom-right ">
		<div class="beta beta-blue  ">
			<a class="beta-link "
				href="//github.com/OpusVL/perldoc.perl.org/issues/new" rel="noopener">
				<span class="beta-text">
					This website is a Beta release.
				</span>
				<span class="beta-text">
					For any issues please raise a ticket on GitHub
				</span>
			</a>
		</div>
	</div>

        <script src="/public/js/main.min.js"></script>
      </body>

      </html>
