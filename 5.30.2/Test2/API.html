      
      
      
      

      <!DOCTYPE html>
      <html lang="en">

      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Test2::API - perldoc.perl.org">
        <link rel="icon" href="/public/img/favicon.ico">
        <title>Test2::API - perldoc.perl.org</title>
        <link href="/public/css/main.min.css" rel="stylesheet">
        <link rel="canonical" href="/Test2/API.html">
        <link
          href='https://fonts.googleapis.com/css?family=Lato:400,100,300,700,900'
          rel='stylesheet' type='text/css'>
        <script>
          window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments)
          };
          ga.l = +new Date;
          ga('create', 'UA-1892152-2', 'auto'); // JJ's account
          ga('create', 'UA-50555-3', 'auto', 'perlOrg'); // perl.org account
          ga('require', 'outboundLinkTracker', {
            events: ['click', 'auxclick', 'contextmenu'],
          });
          ga('require', 'maxScrollTracker');
          ga('send', 'pageview');
          ga('perlOrg.send', 'pageview');
        </script>
        <script async src="https://www.google-analytics.com/analytics.js">
        </script>
        <script async src="/public/js/tracking.min.js"></script>
      </head>

      <body class="body container-fluid ">
        <div class="wrapper">

          <nav
    class="navbar navbar-dark bg-primary bg-perl fixed-top justify-content-between navbar-expand-lg">
    <a href="#content" class="skippy sr-only sr-only-focusable">
        <span class=' skippy-text'>Skip to main content</span>
    </a>
    <a class="navbar-brand" href="/">
        <img class="logo" src="/public/img/logo_perl_doc.svg"
            alt="Perl Documentation Logo" />
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
        data-target="#navbar" aria-controls="navbar" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbar" class="collapse navbar-collapse ">
        <ul class="navbar-nav ml-auto navbar-right">
            <form class="nav-item dropdown search-wrapper">
                <input type="text" id='searchinput' aria-describedby='navbarDropdown5'
                    placeholder="Type query" class='search-input-field' value=''>

                <button href="#" data-toggle='dropdown' type="button"
                    aria-haspopup="true" aria-expanded='false' id="navbarDropdown5"
                    class="nav-link dropdown-toggle search-link">
                    <object tabindex='-1' focusable="false" class='search-icon'
                        data="/public/img/search.svg" type="image/svg+xml"
                        name='search icon'>search
                        icon</object>
                </button>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown5"
                    id='search-results'>
                    <p class='dropdown-item major-version'>
                        No results
                    </p>
                </div>
            </form>
            <li class="nav-item dropdown">
                <a id="navbarDropdown" href="#" class="nav-link dropdown-toggle"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Perl versions</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    
                        <p class='dropdown-item major-version'>
                            5.32
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.32.0/">5.32.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.30
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.30.3/">5.30.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.2/">5.30.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.1/">5.30.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.0/">5.30.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.28
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.28.3/">5.28.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.2/">5.28.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.1/">5.28.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.0/">5.28.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.26
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.26.3/">5.26.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.2/">5.26.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.1/">5.26.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.0/">5.26.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.24
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.24.4/">5.24.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.3/">5.24.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.2/">5.24.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.1/">5.24.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.0/">5.24.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.22
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.22.4/">5.22.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.3/">5.22.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.2/">5.22.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.1/">5.22.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.0/">5.22.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.20
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.20.3/">5.20.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.2/">5.20.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.1/">5.20.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.0/">5.20.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.18
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.18.4/">5.18.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.3/">5.18.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.2/">5.18.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.1/">5.18.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.0/">5.18.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.16
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.16.3/">5.16.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.2/">5.16.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.1/">5.16.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.0/">5.16.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.14
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.14.4/">5.14.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.3/">5.14.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.2/">5.14.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.1/">5.14.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.0/">5.14.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.12
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.12.5/">5.12.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.4/">5.12.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.3/">5.12.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.2/">5.12.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.1/">5.12.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.0/">5.12.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.10
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.10.1/">5.10.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.10.0/">5.10.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.8
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.8.9/">5.8.9</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.8/">5.8.8</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.7/">5.8.7</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.6/">5.8.6</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.5/">5.8.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.4/">5.8.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.3/">5.8.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.2/">5.8.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.1/">5.8.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.0/">5.8.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.6
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.6.2/">5.6.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.1/">5.6.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.0/">5.6.0</a>
                        
                        
                    
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown1" href="#" class="dropdown-toggle nav-link"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Manuals</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown1">
                    <a class="dropdown-item"
                        href="/5.30.2/index-overview.html">Overview</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-tutorials.html">Tutorials</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-faq.html">FAQs</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-history.html">Changes</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-licence.html">License</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-language.html">Language</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-functions.html">Functions</a>
                    <a class="dropdown-item"
                        href="/5.30.2/perlop.html">Operators</a>
                    <a class="dropdown-item"
                        href="/5.30.2/perlvar.html">Variables</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-pragmas.html">Pragmas</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-utilities.html">Utilities</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-internals.html">Internals</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-platforms.html">Platforms</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown3" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Modules</a>
                <div aria-labelledby="navbarDropdown3"
                    class="dropdown-menu letters-wrap">
                    <!--<a class="dropdown-item"
                        href="/5.30.2/index-modules.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-modules-by-cat.html">By
                        Category</a>-->
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-A.html">A</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-B.html">B</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-C.html">C</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-D.html">D</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-E.html">E</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-F.html">F</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-G.html">G</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-H.html">H</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-I.html">I</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-J.html">J</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-K.html">K</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-L.html">L</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-M.html">M</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-N.html">N</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-O.html">O</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-P.html">P</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-Q.html">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-R.html">R</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-S.html">S</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-T.html">T</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-U.html">U</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-V.html">V</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-W.html">W</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-X.html">X</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-Y.html">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-modules-Z.html">Z</a>
                    </div>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown4" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Functions</a>
                <div aria-labelledby="navbarDropdown4"
                    class="dropdown-menu letters-wrap">
                    <a class="dropdown-item"
                        href="/5.30.2/index-functions.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.30.2/index-functions-by-cat.html">By
                        Category</a>
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#A">A</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#B">B</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#C">C</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#D">D</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#E">E</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#F">F</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#G">G</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#H">H</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#I">I</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#J">J</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#K">K</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#L">L</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#M">M</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#N">N</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#O">O</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#P">P</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#Q">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#R">R</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#S">S</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#T">T</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#U">U</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#V">V</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#W">W</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#X">X</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#Y">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.30.2/index-functions.html#Z">Z</a>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <!--/.nav-collapse -->
</nav>


          <main class="row main-content pb-5 pt-5" id='content'>
            <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
              <div class="row">
                <div class="col-sm-12">
                  <div id="breadcrumbs">
                      
    <a href="../index.html">Home</a>&nbsp; &gt;
    
      
        <a href="../index-modules-T.html">Core modules (T)</a> &gt;
      
    
    Test2::API
  

                  </div>
                </div>
              </div>
              <div class="row">
                <article class="col-sm-12 content">
                  <div class="documentation-wrapper">
                    <div id="perl_version">
                      <h7 class='page-title'> Perl 5 version 30.2
                        documentation</h7>
                    </div>
                    <h1>Test2::API</h1>


  <!--    -->
<ul><li><a href="#NAME">NAME</a></li><li><a href="#***INTERNALS-NOTE***">***INTERNALS NOTE***</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><li><a href="#SYNOPSIS">SYNOPSIS</a></li><ul><li><a href="#WRITING-A-TOOL">WRITING A TOOL</a></li><li><a href="#TESTING-YOUR-TOOLS">TESTING YOUR TOOLS</a></li><li><a href="#OTHER-API-FUNCTIONS">OTHER API FUNCTIONS</a></li></ul><li><a href="#MAIN-API-EXPORTS">MAIN API EXPORTS</a></li><ul><li><a href="#context(...)">context(...)</a></li><li><a href="#release(%24%3b%24)">release($;$)</a></li><li><a href="#context_do(%26%3b%40)">context_do(&;@)</a></li><li><a href="#no_context(%26%3b%24)">no_context(&;$)</a></li><li><a href="#intercept(%26)">intercept(&)</a></li><li><a href="#run_subtest(...)">run_subtest(...)</a></li></ul><li><a href="#OTHER-API-EXPORTS">OTHER API EXPORTS</a></li><ul><li><a href="#STATUS-AND-INITIALIZATION-STATE">STATUS AND INITIALIZATION STATE</a></li><li><a href="#BEHAVIOR-HOOKS">BEHAVIOR HOOKS</a></li><li><a href="#IPC-AND-CONCURRENCY">IPC AND CONCURRENCY</a></li><li><a href="#MANAGING-FORMATTERS">MANAGING FORMATTERS</a></li></ul><li><a href="#OTHER-EXAMPLES">OTHER EXAMPLES</a></li><li><a href="#SEE-ALSO">SEE ALSO</a></li><li><a href="#MAGIC">MAGIC</a></li><li><a href="#SOURCE">SOURCE</a></li><li><a href="#MAINTAINERS">MAINTAINERS</a></li><li><a href="#AUTHORS">AUTHORS</a></li><li><a href="#COPYRIGHT">COPYRIGHT</a></li></ul><a class='view-head1' id="NAME"></a><h2 class='h2' >NAME</h2>
<p>Test2::API - Primary interface for writing Test2 based testing tools.</p>
<a class='view-head1' id="***INTERNALS-NOTE***"></a><h2 class='h2' >***INTERNALS NOTE***</h2>
<p><strong>The internals of this package are subject to change at any time!</strong> The public
methods provided will not change in backwards-incompatible ways (once there is
a stable release), but the underlying implementation details might.
<strong>Do not break encapsulation here!</strong></p>
<p>Currently the implementation is to create a single instance of the
<a href="../Test2/API/Instance.html">Test2::API::Instance</a> Object. All class methods defer to the single
instance. There is no public access to the singleton, and that is intentional.
The class methods provided by this package provide the only functionality
publicly exposed.</p>
<p>This is done primarily to avoid the problems Test::Builder had by exposing its
singleton. We do not want anyone to replace this singleton, rebless it, or
directly muck with its internals. If you need to do something and cannot
because of the restrictions placed here, then please report it as an issue. If
possible, we will create a way for you to implement your functionality without
exposing things that should not be exposed.</p>
<a class='view-head1' id="DESCRIPTION"></a><h2 class='h2' >DESCRIPTION</h2>
<p>This package exports all the functions necessary to write and/or verify testing
tools. Using these building blocks you can begin writing test tools very
quickly. You are also provided with tools that help you to test the tools you
write.</p>
<a class='view-head1' id="SYNOPSIS"></a><h2 class='h2' >SYNOPSIS</h2>
<a class='view-head2' id="WRITING-A-TOOL"></a><h3 class='h3' >WRITING A TOOL</h3>
<p>The <code class="inline"><span class="i">context</span><span class="s">(</span><span class="s">)</span></code>
 method is your primary interface into the Test2 framework.</p>
<pre class="verbatim"><ol><li><a name="package-My::Ok"></a>    package <span class="i">My::Ok</span><span class="sc">;</span></li><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">Test2::API</span> <span class="q">qw/context/</span><span class="sc">;</span></li><li></li><li>    <a class="l_k" href="../functions/our.html">our</a> <span class="i">@EXPORT</span> = <span class="q">qw/my_ok/</span><span class="sc">;</span></li><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">base</span> <span class="q">&#39;Exporter&#39;</span><span class="sc">;</span></li><li></li><li>    <span class="c"># Just like ok() from Test::More</span></li><li><a name="my_ok"></a>    sub <span class="m">my_ok($;$)</span> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">$bool</span><span class="cm">,</span> <span class="i">$name</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="c"># Get a context</span></li><li>        <span class="i">$ctx</span><span class="i">-&gt;ok</span><span class="s">(</span><span class="i">$bool</span><span class="cm">,</span> <span class="i">$name</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="i">$ctx</span><span class="i">-&gt;release</span><span class="sc">;</span> <span class="c"># Release the context</span></li><li>        <a class="l_k" href="../functions/return.html">return</a> <span class="i">$bool</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre><p>See <a href="../Test2/API/Context.html">Test2::API::Context</a> for a list of methods available on the context object.</p>
<a class='view-head2' id="TESTING-YOUR-TOOLS"></a><h3 class='h3' >TESTING YOUR TOOLS</h3>
<p>The <code class="inline"><span class="i">intercept</span> <span class="s">{</span> ... <span class="s">}</span></code>
 tool lets you temporarily intercept all events
generated by the test system:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">Test2::API</span> <span class="q">qw/intercept/</span><span class="sc">;</span></li><li></li><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">My::Ok</span> <span class="q">qw/my_ok/</span><span class="sc">;</span></li><li></li><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$events</span> = <span class="i">intercept</span> <span class="s">{</span></li><li>        <span class="c"># These events are not displayed</span></li><li>        <span class="i">my_ok</span><span class="s">(</span><span class="n">1</span><span class="cm">,</span> <span class="q">&quot;pass&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="i">my_ok</span><span class="s">(</span><span class="n">0</span><span class="cm">,</span> <span class="q">&quot;fail&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="s">}</span><span class="sc">;</span></li><li></li><li>    <span class="i">my_ok</span><span class="s">(</span><span class="i">@$events</span> == <span class="n">2</span><span class="cm">,</span> <span class="q">&quot;got 2 events, the pass and the fail&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">my_ok</span><span class="s">(</span><span class="i">$events</span>-&gt;[<span class="n">0</span>]<span class="i">-&gt;pass</span><span class="cm">,</span> <span class="q">&quot;first event passed&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">my_ok</span><span class="s">(</span>!<span class="i">$events</span>-&gt;[<span class="n">1</span>]<span class="i">-&gt;pass</span><span class="cm">,</span> <span class="q">&quot;second event failed&quot;</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><a class='view-head3' id="DEEP-EVENT-INTERCEPTION"></a><h4 class='h4' >DEEP EVENT INTERCEPTION</h4>
<p>Normally <code class="inline"><span class="i">intercept</span> <span class="s">{</span> ... <span class="s">}</span></code>
 only intercepts events sent to the main hub (as
added by intercept itself). Nested hubs, such as those created by subtests,
will not be intercepted. This is normally what you will still see the nested
events by inspecting the subtest event. However there are times where you want
to verify each event as it is sent, in that case use <code class="inline"><span class="i">intercept_deep</span> <span class="s">{</span> ... <span class="s">}</span></code>
.</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$events</span> = <span class="i">intercept_Deep</span> <span class="s">{</span></li><li>        <span class="w">buffered_subtest</span> <span class="w">foo</span> <span class="cm">=&gt;</span> <a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span></li><li>            <span class="i">ok</span><span class="s">(</span><span class="n">1</span><span class="cm">,</span> <span class="q">&quot;pass&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="s">}</span><span class="sc">;</span></li><li>    <span class="s">}</span><span class="sc">;</span></li></ol></pre><p><code class="inline"><span class="i">$events</span></code>
 in this case will contain 3 items:</p>
<ul>
<li><a class='view-title' id="The-event-from-ok(1%2c-%22pass%22)"></a><strong>The event from <code class="inline"><span class="i">ok</span><span class="s">(</span><span class="n">1</span><span class="cm">,</span> <span class="q">&quot;pass&quot;</span><span class="s">)</span></code>
</strong>
</li>
<li><a class='view-title' id="The-plan-event-for-the-subtest"></a><strong>The plan event for the subtest</strong>
</li>
<li><a class='view-title' id="The-subtest-event-itself%2c-with-the-first-2-events-nested-inside-it-as-children."></a><strong>The subtest event itself, with the first 2 events nested inside it as children.</strong>
</li>
</ul>
<p>This lets you see the order in which the events were sent, unlike
<code class="inline"><span class="i">intercept</span> <span class="s">{</span> ... <span class="s">}</span></code>
 which only lets you see events as the main hub sees them.</p>
<a class='view-head2' id="OTHER-API-FUNCTIONS"></a><h3 class='h3' >OTHER API FUNCTIONS</h3>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">Test2::API</span> <span class="q">qw{</span></li><li>        <span class="q">test2_init_done</span></li><li>        <span class="q">test2_stack</span></li><li>        <span class="q">test2_set_is_end</span></li><li>        <span class="q">test2_get_is_end</span></li><li>        <span class="q">test2_ipc</span></li><li>        <span class="q">test2_formatter_set</span></li><li>        <span class="q">test2_formatter</span></li><li>    <span class="q">}</span><span class="sc">;</span></li><li></li><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$init</span>  = <span class="i">test2_init_done</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$stack</span> = <span class="i">test2_stack</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ipc</span>   = <span class="i">test2_ipc</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <span class="i">test2_formatter_set</span><span class="s">(</span><span class="i">$FORMATTER</span><span class="s">)</span></li><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$formatter</span> = <span class="i">test2_formatter</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    ... <span class="w">And</span> <span class="w">others</span> ...</li></ol></pre><a class='view-head1' id="MAIN-API-EXPORTS"></a><h2 class='h2' >MAIN API EXPORTS</h2>
<p>All exports are optional. You must specify subs to import.</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">Test2::API</span> <span class="q">qw/context intercept run_subtest/</span><span class="sc">;</span></li></ol></pre><p>This is the list of exports that are most commonly needed. If you are simply
writing a tool, then this is probably all you need. If you need something and
you cannot find it here, then you can also look at <a href="#OTHER-API-EXPORTS">OTHER API EXPORTS</a>.</p>
<p>These exports lack the 'test2_' prefix because of how important/common they
are. Exports in the <a href="#OTHER-API-EXPORTS">OTHER API EXPORTS</a> section have the 'test2_' prefix to
ensure they stand out.</p>
<a class='view-head2' id="context(...)"></a><h3 class='h3' >context(...)</h3>
<p>Usage:</p>
<ul>
<li><a class='view-title' id="%24ctx-%3d-context()"></a><strong>$ctx = context()</strong>
</li>
<li><a class='view-title' id="%24ctx-%3d-context(%25params)"></a><strong>$ctx = context(%params)</strong>
</li>
</ul>
<p>The <code class="inline"><span class="i">context</span><span class="s">(</span><span class="s">)</span></code>
 function will always return the current context. If
there is already a context active, it will be returned. If there is not an
active context, one will be generated. When a context is generated it will
default to using the file and line number where the currently running sub was
called from.</p>
<p>Please see <a href="../Test2/API/Context.html#CRITICAL-DETAILS">CRITICAL DETAILS in Test2::API::Context</a> for important rules about
what you can and cannot do with a context once it is obtained.</p>
<p><strong>Note</strong> This function will throw an exception if you ignore the context object
it returns.</p>
<p><strong>Note</strong> On perls 5.14+ a depth check is used to insure there are no context
leaks. This cannot be safely done on older perls due to
<a class='link-to-page' href="https://rt.perl.org/Public/Bug/Display.html?id=127774">https://rt.perl.org/Public/Bug/Display.html?id=127774</a>
You can forcefully enable it either by setting <code class="inline"><span class="i">$ENV</span>{<span class="w">T2_CHECK_DEPTH</span>} = <span class="n">1</span></code>
 or
<code class="inline"><span class="i">$Test2::API::DO_DEPTH_CHECK</span> = <span class="n">1</span></code>
 <strong>BEFORE</strong> loading <a href="../Test2/API.html">Test2::API</a>.</p>
<a class='view-head3' id="OPTIONAL-PARAMETERS"></a><h4 class='h4' >OPTIONAL PARAMETERS</h4>
<p>All parameters to <code class="inline"><span class="w">context</span></code>
 are optional.</p>
<ul>
<li><a class='view-title' id="level-%3d%3e-%24int"></a><strong>level =&gt; $int</strong>
<p>If you must obtain a context in a sub deeper than your entry point you can use
this to tell it how many EXTRA stack frames to look back. If this option is not
provided the default of <code class="inline"><span class="n">0</span></code>
 is used.</p>
<pre class="verbatim"><ol><li><a name="third_party_tool"></a>    sub <span class="m">third_party_tool</span> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$sub</span> = <a class="l_k" href="../functions/shift.html">shift</a><span class="sc">;</span></li><li>        ... <span class="c"># Does not obtain a context</span></li><li>        <span class="i">$sub</span>-&gt;<span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>        ...</li><li>    <span class="s">}</span></li><li></li><li>    <span class="i">third_party_tool</span><span class="s">(</span><a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="w">level</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span></li><li>        ...</li><li>        <span class="i">$ctx</span><span class="i">-&gt;release</span><span class="sc">;</span></li><li>    <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li></ol></pre></li>
<li><a class='view-title' id="wrapped-%3d%3e-%24int"></a><strong>wrapped =&gt; $int</strong>
<p>Use this if you need to write your own tool that wraps a call to <code class="inline"><span class="i">context</span><span class="s">(</span><span class="s">)</span></code>

with the intent that it should return a context object.</p>
<pre class="verbatim"><ol><li><a name="my_context"></a>    sub <span class="m">my_context</span> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">%params</span> = <span class="s">(</span> <span class="w">wrapped</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> <span class="i">@_</span> <span class="s">)</span><span class="sc">;</span></li><li>        <span class="i">$params</span>{<span class="w">wrapped</span>}++<span class="sc">;</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="i">%params</span><span class="s">)</span><span class="sc">;</span></li><li>        ...</li><li>        <a class="l_k" href="../functions/return.html">return</a> <span class="i">$ctx</span><span class="sc">;</span></li><li>    <span class="s">}</span></li><li></li><li><a name="my_tool"></a>    sub <span class="m">my_tool</span> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">my_context</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>        ...</li><li>        <span class="i">$ctx</span><span class="i">-&gt;release</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre><p>If you do not do this, then tools you call that also check for a context will
notice that the context they grabbed was created at the same stack depth, which
will trigger protective measures that warn you and destroy the existing
context.</p>
</li>
<li><a class='view-title' id="stack-%3d%3e-%24stack"></a><strong>stack =&gt; $stack</strong>
<p>Normally <code class="inline"><span class="i">context</span><span class="s">(</span><span class="s">)</span></code>
 looks at the global hub stack. If you are maintaining
your own <a href="../Test2/API/Stack.html">Test2::API::Stack</a> instance you may pass it in to be used
instead of the global one.</p>
</li>
<li><a class='view-title' id="hub-%3d%3e-%24hub"></a><strong>hub =&gt; $hub</strong>
<p>Use this parameter if you want to obtain the context for a specific hub instead
of whatever one happens to be at the top of the stack.</p>
</li>
<li><a class='view-title' id="on_init-%3d%3e-sub-%7b-...-%7d"></a><strong>on_init =&gt; sub { ... }</strong>
<p>This lets you provide a callback sub that will be called <strong>ONLY</strong> if your call
to <code class="inline"><span class="i">context</span><span class="s">(</span><span class="s">)</span></code>
 generated a new context. The callback <strong>WILL NOT</strong> be called if
<code class="inline"><span class="i">context</span><span class="s">(</span><span class="s">)</span></code>
 is returning an existing context. The only argument passed into
the callback will be the context object itself.</p>
<pre class="verbatim"><ol><li><a name="foo"></a>    sub <span class="m">foo</span> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="w">on_init</span> <span class="cm">=&gt;</span> <a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span> <span class="q">&#39;will run&#39;</span> <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$inner</span> = <a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span></li><li>            <span class="c"># This callback is not run since we are getting the existing</span></li><li>            <span class="c"># context from our parent sub.</span></li><li>            <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="w">on_init</span> <span class="cm">=&gt;</span> <a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span> <span class="q">&#39;will NOT run&#39;</span> <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li>            <span class="i">$ctx</span><span class="i">-&gt;release</span><span class="sc">;</span></li><li>        <span class="s">}</span></li><li>        <span class="i">$inner</span>-&gt;<span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>        <span class="i">$ctx</span><span class="i">-&gt;release</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre></li>
<li><a class='view-title' id="on_release-%3d%3e-sub-%7b-...-%7d"></a><strong>on_release =&gt; sub { ... }</strong>
<p>This lets you provide a callback sub that will be called when the context
instance is released. This callback will be added to the returned context even
if an existing context is returned. If multiple calls to context add callbacks,
then all will be called in reverse order when the context is finally released.</p>
<pre class="verbatim"><ol><li><a name="foo"></a>    sub <span class="m">foo</span> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="w">on_release</span> <span class="cm">=&gt;</span> <a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span> <span class="q">&#39;will run second&#39;</span> <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$inner</span> = <a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span></li><li>            <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="w">on_release</span> <span class="cm">=&gt;</span> <a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span> <span class="q">&#39;will run first&#39;</span> <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>            <span class="c"># Neither callback runs on this release</span></li><li>            <span class="i">$ctx</span><span class="i">-&gt;release</span><span class="sc">;</span></li><li>        <span class="s">}</span></li><li>        <span class="i">$inner</span>-&gt;<span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>        <span class="c"># Both callbacks run here.</span></li><li>        <span class="i">$ctx</span><span class="i">-&gt;release</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre></li>
</ul>
<a class='view-head2' id="release(%24%3b%24)"></a><h3 class='h3' >release($;$)</h3>
<p>Usage:</p>
<ul>
<li><a class='view-title' id="release-%24ctx%3b"></a><strong>release $ctx;</strong>
</li>
<li><a class='view-title' id="release-%24ctx%2c-...%3b"></a><strong>release $ctx, ...;</strong>
</li>
</ul>
<p>This is intended as a shortcut that lets you release your context and return a
value in one statement. This function will get your context, and an optional
return value. It will release your context, then return your value. Scalar
context is always assumed.</p>
<pre class="verbatim"><ol><li><a name="tool"></a>    sub <span class="m">tool</span> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>        ...</li><li></li><li>        <a class="l_k" href="../functions/return.html">return</a> <span class="w">release</span> <span class="i">$ctx</span><span class="cm">,</span> <span class="n">1</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre><p>This tool is most useful when you want to return the value you get from calling
a function that needs to see the current context:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$out</span> = <span class="i">some_tool</span><span class="s">(</span>...<span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">$ctx</span><span class="i">-&gt;release</span><span class="sc">;</span></li><li>    <a class="l_k" href="../functions/return.html">return</a> <span class="i">$out</span><span class="sc">;</span></li></ol></pre><p>We can combine the last 3 lines of the above like so:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">release</span> <span class="i">$ctx</span><span class="cm">,</span> <span class="i">some_tool</span><span class="s">(</span>...<span class="s">)</span><span class="sc">;</span></li></ol></pre><a class='view-head2' id="context_do(%26%3b%40)"></a><h3 class='h3' >context_do(&amp;;@)</h3>
<p>Usage:</p>
<pre class="verbatim"><ol><li><a name="my_tool"></a>    sub <span class="m">my_tool</span> <span class="s">{</span></li><li>        <span class="i">context_do</span> <span class="s">{</span></li><li>            <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <a class="l_k" href="../functions/shift.html">shift</a><span class="sc">;</span></li><li></li><li>            <a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">@args</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span></li><li></li><li>            <span class="i">$ctx</span><span class="i">-&gt;ok</span><span class="s">(</span><span class="n">1</span><span class="cm">,</span> <span class="q">&quot;pass&quot;</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>            ...</li><li></li><li>            <span class="c"># No need to call $ctx-&gt;release, done for you on scope exit.</span></li><li>        <span class="s">}</span> <span class="i">@_</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre><p>Using this inside your test tool takes care of a lot of boilerplate for you. It
will ensure a context is acquired. It will capture and rethrow any exception. It
will insure the context is released when you are done. It preserves the
subroutine call context (array, scalar, void).</p>
<p>This is the safest way to write a test tool. The only two downsides to this are a
slight performance decrease, and some extra indentation in your source. If the
indentation is a problem for you then you can take a peek at the next section.</p>
<a class='view-head2' id="no_context(%26%3b%24)"></a><h3 class='h3' >no_context(&amp;;$)</h3>
<p>Usage:</p>
<ul>
<li><a class='view-title' id="no_context-%7b-...-%7d%3b"></a><strong>no_context { ... };</strong>
</li>
<li><a class='view-title' id="no_context-%7b-...-%7d-%24hid%3b"></a><strong>no_context { ... } $hid;</strong>
<pre class="verbatim"><ol><li><a name="my_tool"></a>    sub <span class="m">my_tool(&amp;)</span> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$code</span> = <a class="l_k" href="../functions/shift.html">shift</a><span class="sc">;</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ctx</span> = <span class="i">context</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>        ...</li><li></li><li>        <span class="i">no_context</span> <span class="s">{</span></li><li>            <span class="c"># Things in here will not see our current context, they get a new</span></li><li>            <span class="c"># one.</span></li><li></li><li>            <span class="i">$code</span>-&gt;<span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="s">}</span><span class="sc">;</span></li><li></li><li>        ...</li><li>        <span class="i">$ctx</span><span class="i">-&gt;release</span><span class="sc">;</span></li><li>    <span class="s">}</span><span class="sc">;</span></li></ol></pre></li>
</ul>
<p>This tool will hide a context for the provided block of code. This means any
tools run inside the block will get a completely new context if they acquire
one. The new context will be inherited by tools nested below the one that
acquired it.</p>
<p>This will normally hide the current context for the top hub. If you need to
hide the context for a different hub you can pass in the optional <code class="inline"><span class="i">$hid</span></code>

parameter.</p>
<a class='view-head2' id="intercept(%26)"></a><h3 class='h3' >intercept(&amp;)</h3>
<p>Usage:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$events</span> = <span class="i">intercept</span> <span class="s">{</span></li><li>        <span class="i">ok</span><span class="s">(</span><span class="n">1</span><span class="cm">,</span> <span class="q">&quot;pass&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="i">ok</span><span class="s">(</span><span class="n">0</span><span class="cm">,</span> <span class="q">&quot;fail&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>        ...</li><li>    <span class="s">}</span><span class="sc">;</span></li></ol></pre><p>This function takes a codeblock as its only argument, and it has a prototype.
It will execute the codeblock, intercepting any generated events in the
process. It will return an array reference with all the generated event
objects. All events should be subclasses of <a href="../Test2/Event.html">Test2::Event</a>.</p>
<p>This is a very low-level subtest tool. This is useful for writing tools which
produce subtests. This is not intended for people simply writing tests.</p>
<a class='view-head2' id="run_subtest(...)"></a><h3 class='h3' >run_subtest(...)</h3>
<p>Usage:</p>
<pre class="verbatim"><ol><li>    <span class="i">run_subtest</span><span class="s">(</span><span class="i">$NAME</span><span class="cm">,</span> \<span class="i">&amp;CODE</span><span class="cm">,</span> <span class="i">$BUFFERED</span><span class="cm">,</span> <span class="i">@ARGS</span><span class="s">)</span></li><li></li><li>    <span class="c"># or</span></li><li></li><li>    <span class="i">run_subtest</span><span class="s">(</span><span class="i">$NAME</span><span class="cm">,</span> \<span class="i">&amp;CODE</span><span class="cm">,</span> \<span class="i">%PARAMS</span><span class="cm">,</span> <span class="i">@ARGS</span><span class="s">)</span></li></ol></pre><p>This will run the provided codeblock with the args in <code class="inline"><span class="i">@args</span></code>
. This codeblock
will be run as a subtest. A subtest is an isolated test state that is condensed
into a single <a href="../Test2/Event/Subtest.html">Test2::Event::Subtest</a> event, which contains all events
generated inside the subtest.</p>
<a class='view-head3' id="ARGUMENTS%3a"></a><h4 class='h4' >ARGUMENTS:</h4>
<ul>
<li><a class='view-title' id="%24NAME"></a><strong>$NAME</strong>
<p>The name of the subtest.</p>
</li>
<li><a class='view-title' id="%5c%26CODE"></a><strong>\&amp;CODE</strong>
<p>The code to run inside the subtest.</p>
</li>
<li><a class='view-title' id="%24BUFFERED-or-%5c%25PARAMS"></a><strong>$BUFFERED or \%PARAMS</strong>
<p>If this is a simple scalar then it will be treated as a boolean for the
'buffered' setting. If this is a hash reference then it will be used as a
parameters hash. The param hash will be used for hub construction (with the
specified keys removed).</p>
<p>Keys that are removed and used by run_subtest:</p>
<ul>
<li><a class='view-title' id="'buffered'-%3d%3e-%24bool"></a><strong>'buffered' =&gt; $bool</strong>
<p>Toggle buffered status.</p>
</li>
<li><a class='view-title' id="'inherit_trace'-%3d%3e-%24bool"></a><strong>'inherit_trace' =&gt; $bool</strong>
<p>Normally the subtest hub is pushed and the sub is allowed to generate its own
root context for the hub. When this setting is turned on a root context will be
created for the hub that shares the same trace as the current context.</p>
<p>Set this to true if your tool is producing subtests without user-specified
subs.</p>
</li>
<li><a class='view-title' id="'no_fork'-%3d%3e-%24bool"></a><strong>'no_fork' =&gt; $bool</strong>
<p>Defaults to off. Normally forking inside a subtest will actually fork the
subtest, resulting in 2 final subtest events. This parameter will turn off that
behavior, only the original process/thread will return a final subtest event.</p>
</li>
</ul>
</li>
<li><a class='view-title' id="%40ARGS"></a><strong>@ARGS</strong>
<p>Any extra arguments you want passed into the subtest code.</p>
</li>
</ul>
<a class='view-head3' id="BUFFERED-VS-UNBUFFERED-(OR-STREAMED)"></a><h4 class='h4' >BUFFERED VS UNBUFFERED (OR STREAMED)</h4>
<p>Normally all events inside and outside a subtest are sent to the formatter
immediately by the hub. Sometimes it is desirable to hold off sending events
within a subtest until the subtest is complete. This usually depends on the
formatter being used.</p>
<ul>
<li><a class='view-title' id="Things-not-effected-by-this-flag"></a><strong>Things not effected by this flag</strong>
<p>In both cases events are generated and stored in an array. This array is
eventually used to populate the <code class="inline"><span class="w">subevents</span></code>
 attribute on the
<a href="../Test2/Event/Subtest.html">Test2::Event::Subtest</a> event that is generated at the end of the subtest.
This flag has no effect on this part, it always happens.</p>
<p>At the end of the subtest, the final <a href="../Test2/Event/Subtest.html">Test2::Event::Subtest</a> event is sent to
the formatter.</p>
</li>
<li><a class='view-title' id="Things-that-are-effected-by-this-flag"></a><strong>Things that are effected by this flag</strong>
<p>The <code class="inline"><span class="w">buffered</span></code>
 attribute of the <a href="../Test2/Event/Subtest.html">Test2::Event::Subtest</a> event will be set to
the value of this flag. This means any formatter, listener, etc which looks at
the event will know if it was buffered.</p>
</li>
<li><a class='view-title' id="Things-that-are-formatter-dependant"></a><strong>Things that are formatter dependant</strong>
<p>Events within a buffered subtest may or may not be sent to the formatter as
they happen. If a formatter fails to specify then the default is to <strong>NOT SEND</strong>
the events as they are generated, instead the formatter can pull them from the
<code class="inline"><span class="w">subevents</span></code>
 attribute.</p>
<p>A formatter can specify by implementing the <code class="inline"><span class="i">hide_buffered</span><span class="s">(</span><span class="s">)</span></code>
 method. If this
method returns true then events generated inside a buffered subtest will not be
sent independently of the final subtest event.</p>
</li>
</ul>
<p>An example of how this is used is the <a href="../Test2/Formatter/TAP.html">Test2::Formatter::TAP</a> formatter. For
unbuffered subtests the events are rendered as they are generated. At the end
of the subtest, the final subtest event is rendered, but the <code class="inline"><span class="w">subevents</span></code>

attribute is ignored. For buffered subtests the opposite occurs, the events are
NOT rendered as they are generated, instead the <code class="inline"><span class="w">subevents</span></code>
 attribute is used
to render them all at once. This is useful when running subtests tests in
parallel, since without it the output from subtests would be interleaved
together.</p>
<a class='view-head1' id="OTHER-API-EXPORTS"></a><h2 class='h2' >OTHER API EXPORTS</h2>
<p>Exports in this section are not commonly needed. These all have the 'test2_'
prefix to help ensure they stand out. You should look at the <a href="#MAIN-API-EXPORTS">MAIN API EXPORTS</a> section before looking here. This section is one where "Great power
comes with great responsibility". It is possible to break things badly if you
are not careful with these.</p>
<p>All exports are optional. You need to list which ones you want at import time:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">Test2::API</span> <span class="q">qw/test2_init_done .../</span><span class="sc">;</span></li></ol></pre><a class='view-head2' id="STATUS-AND-INITIALIZATION-STATE"></a><h3 class='h3' >STATUS AND INITIALIZATION STATE</h3>
<p>These provide access to internal state and object instances.</p>
<ul>
<li><a class='view-title' id="%24bool-%3d-test2_init_done()"></a><strong>$bool = test2_init_done()</strong>
<p>This will return true if the stack and IPC instances have already been
initialized. It will return false if they have not. Init happens as late as
possible. It happens as soon as a tool requests the IPC instance, the
formatter, or the stack.</p>
</li>
<li><a class='view-title' id="%24bool-%3d-test2_load_done()"></a><strong>$bool = test2_load_done()</strong>
<p>This will simply return the boolean value of the loaded flag. If Test2 has
finished loading this will be true, otherwise false. Loading is considered
complete the first time a tool requests a context.</p>
</li>
<li><a class='view-title' id="test2_set_is_end()"></a><strong>test2_set_is_end()</strong>
</li>
<li><a class='view-title' id="test2_set_is_end(%24bool)"></a><strong>test2_set_is_end($bool)</strong>
<p>This is used to toggle Test2's belief that the END phase has already started.
With no arguments this will set it to true. With arguments it will set it to
the first argument's value.</p>
<p>This is used to prevent the use of <code class="inline"><a class="l_k" href="../functions/caller.html">caller()</a></code> in END blocks which can cause
segfaults. This is only necessary in some persistent environments that may have
multiple END phases.</p>
</li>
<li><a class='view-title' id="%24bool-%3d-test2_get_is_end()"></a><strong>$bool = test2_get_is_end()</strong>
<p>Check if Test2 believes it is the END phase.</p>
</li>
<li><a class='view-title' id="%24stack-%3d-test2_stack()"></a><strong>$stack = test2_stack()</strong>
<p>This will return the global <a href="../Test2/API/Stack.html">Test2::API::Stack</a> instance. If this has not
yet been initialized it will be initialized now.</p>
</li>
<li><a class='view-title' id="test2_ipc_disable"></a><strong>test2_ipc_disable</strong>
<p>Disable IPC.</p>
</li>
<li><a class='view-title' id="%24bool-%3d-test2_ipc_diabled"></a><strong>$bool = test2_ipc_diabled</strong>
<p>Check if IPC is disabled.</p>
</li>
<li><a class='view-title' id="test2_ipc_wait_enable()"></a><strong>test2_ipc_wait_enable()</strong>
</li>
<li><a class='view-title' id="test2_ipc_wait_disable()"></a><strong>test2_ipc_wait_disable()</strong>
</li>
<li><a class='view-title' id="%24bool-%3d-test2_ipc_wait_enabled()"></a><strong>$bool = test2_ipc_wait_enabled()</strong>
<p>These can be used to turn IPC waiting on and off, or check the current value of
the flag.</p>
<p>Waiting is turned on by default. Waiting will cause the parent process/thread
to wait until all child processes and threads are finished before exiting. You
will almost never want to turn this off.</p>
</li>
<li><a class='view-title' id="%24bool-%3d-test2_no_wait()"></a><strong>$bool = test2_no_wait()</strong>
</li>
<li><a class='view-title' id="test2_no_wait(%24bool)"></a><strong>test2_no_wait($bool)</strong>
<p><strong>DISCOURAGED</strong>: This is a confusing interface, it is better to use
<code class="inline"><span class="i">test2_ipc_wait_enable</span><span class="s">(</span><span class="s">)</span></code>
, <code class="inline"><span class="i">test2_ipc_wait_disable</span><span class="s">(</span><span class="s">)</span></code>
 and
<code class="inline"><span class="i">test2_ipc_wait_enabled</span><span class="s">(</span><span class="s">)</span></code>
.</p>
<p>This can be used to get/set the no_wait status. Waiting is turned on by
default. Waiting will cause the parent process/thread to wait until all child
processes and threads are finished before exiting. You will almost never want
to turn this off.</p>
</li>
<li><a class='view-title' id="%24fh-%3d-test2_stdout()"></a><strong>$fh = test2_stdout()</strong>
</li>
<li><a class='view-title' id="%24fh-%3d-test2_stderr()"></a><strong>$fh = test2_stderr()</strong>
<p>These functions return the filehandles that test output should be written to.
They are primarily useful when writing a custom formatter and code that turns
events into actual output (TAP, etc.).  They will return a dupe of the original
filehandles that formatted output can be sent to regardless of whatever state
the currently running test may have left STDOUT and STDERR in.</p>
</li>
<li><a class='view-title' id="test2_reset_io()"></a><strong>test2_reset_io()</strong>
<p>Re-dupe the internal filehandles returned by <code class="inline"><span class="i">test2_stdout</span><span class="s">(</span><span class="s">)</span></code>
 and
<code class="inline"><span class="i">test2_stderr</span><span class="s">(</span><span class="s">)</span></code>
 from the current STDOUT and STDERR.  You shouldn't need to do
this except in very peculiar situations (for example, you're testing a new
formatter and you need control over where the formatter is sending its output.)</p>
</li>
</ul>
<a class='view-head2' id="BEHAVIOR-HOOKS"></a><h3 class='h3' >BEHAVIOR HOOKS</h3>
<p>These are hooks that allow you to add custom behavior to actions taken by Test2
and tools built on top of it.</p>
<ul>
<li><a class='view-title' id="test2_add_callback_exit(sub-%7b-...-%7d)"></a><strong>test2_add_callback_exit(sub { ... })</strong>
<p>This can be used to add a callback that is called after all testing is done. This
is too late to add additional results, the main use of this callback is to set the
exit code.</p>
<pre class="verbatim"><ol><li>    <span class="i">test2_add_callback_exit</span><span class="s">(</span></li><li>        <a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span></li><li>            <a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">$context</span><span class="cm">,</span> <span class="i">$exit</span><span class="cm">,</span> \<span class="i">$new_exit</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span></li><li>            ...</li><li>        <span class="s">}</span></li><li>    <span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The <code class="inline"><span class="i">$context</span></code>
 passed in will be an instance of <a href="../Test2/API/Context.html">Test2::API::Context</a>. The
<code class="inline"><span class="i">$exit</span></code>
 argument will be the original exit code before anything modified it.
<code class="inline"><span class="i">$$new_exit</span></code>
 is a reference to the new exit code. You may modify this to
change the exit code. Please note that <code class="inline"><span class="i">$$new_exit</span></code>
 may already be different
from <code class="inline"><span class="i">$exit</span></code>
</p>
</li>
<li><a class='view-title' id="test2_add_callback_post_load(sub-%7b-...-%7d)"></a><strong>test2_add_callback_post_load(sub { ... })</strong>
<p>Add a callback that will be called when Test2 is finished loading. This
means the callback will be run once, the first time a context is obtained.
If Test2 has already finished loading then the callback will be run immediately.</p>
</li>
<li><a class='view-title' id="test2_add_callback_testing_done(sub-%7b-...-%7d)"></a><strong>test2_add_callback_testing_done(sub { ... })</strong>
<p>This adds your coderef as a follow-up to the root hub after Test2 is finished loading.</p>
<p>This is essentially a helper to do the following:</p>
<pre class="verbatim"><ol><li>    <span class="i">test2_add_callback_post_load</span><span class="s">(</span><a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$stack</span> = <span class="i">test2_stack</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>        <span class="i">$stack</span><span class="i">-&gt;top</span><span class="sc">;</span> <span class="c"># Insure we have a hub</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">$hub</span><span class="s">)</span> = <span class="w">Test2::API::test2_stack</span><span class="w">-&gt;all</span><span class="sc">;</span></li><li></li><li>        <span class="i">$hub</span><span class="i">-&gt;set_active</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>        <span class="i">$hub</span><span class="i">-&gt;follow_up</span><span class="s">(</span><a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span> ... <span class="s">}</span><span class="s">)</span><span class="sc">;</span> <span class="c"># &lt;-- Your coderef here</span></li><li>    <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li></ol></pre></li>
<li><a class='view-title' id="test2_add_callback_context_acquire(sub-%7b-...-%7d)"></a><strong>test2_add_callback_context_acquire(sub { ... })</strong>
<p>Add a callback that will be called every time someone tries to acquire a
context. This will be called on EVERY call to <code class="inline"><span class="i">context</span><span class="s">(</span><span class="s">)</span></code>
. It gets a single
argument, a reference to the hash of parameters being used the construct the
context. This is your chance to change the parameters by directly altering the
hash.</p>
<pre class="verbatim"><ol><li>    <span class="i">test2_add_callback_context_acquire</span><span class="s">(</span><a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$params</span> = <a class="l_k" href="../functions/shift.html">shift</a><span class="sc">;</span></li><li>        <span class="i">$params</span>-&gt;{<span class="w">level</span>}++<span class="sc">;</span></li><li>    <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>This is a very scary API function. Please do not use this unless you need to.
This is here for <a href="../Test/Builder.html">Test::Builder</a> and backwards compatibility. This has you
directly manipulate the hash instead of returning a new one for performance
reasons.</p>
</li>
<li><a class='view-title' id="test2_add_callback_context_init(sub-%7b-...-%7d)"></a><strong>test2_add_callback_context_init(sub { ... })</strong>
<p>Add a callback that will be called every time a new context is created. The
callback will receive the newly created context as its only argument.</p>
</li>
<li><a class='view-title' id="test2_add_callback_context_release(sub-%7b-...-%7d)"></a><strong>test2_add_callback_context_release(sub { ... })</strong>
<p>Add a callback that will be called every time a context is released. The
callback will receive the released context as its only argument.</p>
</li>
<li><a class='view-title' id="test2_add_callback_pre_subtest(sub-%7b-...-%7d)"></a><strong>test2_add_callback_pre_subtest(sub { ... })</strong>
<p>Add a callback that will be called every time a subtest is going to be
run. The callback will receive the subtest name, coderef, and any
arguments.</p>
</li>
<li><a class='view-title' id="%40list-%3d-test2_list_context_acquire_callbacks()"></a><strong>@list = test2_list_context_acquire_callbacks()</strong>
<p>Return all the context acquire callback references.</p>
</li>
<li><a class='view-title' id="%40list-%3d-test2_list_context_init_callbacks()"></a><strong>@list = test2_list_context_init_callbacks()</strong>
<p>Returns all the context init callback references.</p>
</li>
<li><a class='view-title' id="%40list-%3d-test2_list_context_release_callbacks()"></a><strong>@list = test2_list_context_release_callbacks()</strong>
<p>Returns all the context release callback references.</p>
</li>
<li><a class='view-title' id="%40list-%3d-test2_list_exit_callbacks()"></a><strong>@list = test2_list_exit_callbacks()</strong>
<p>Returns all the exit callback references.</p>
</li>
<li><a class='view-title' id="%40list-%3d-test2_list_post_load_callbacks()"></a><strong>@list = test2_list_post_load_callbacks()</strong>
<p>Returns all the post load callback references.</p>
</li>
<li><a class='view-title' id="%40list-%3d-test2_list_pre_subtest_callbacks()"></a><strong>@list = test2_list_pre_subtest_callbacks()</strong>
<p>Returns all the pre-subtest callback references.</p>
</li>
<li><a class='view-title' id="test2_add_uuid_via(sub-%7b-...-%7d)"></a><strong>test2_add_uuid_via(sub { ... })</strong>
</li>
<li><a class='view-title' id="%24sub-%3d-test2_add_uuid_via()"></a><strong>$sub = test2_add_uuid_via()</strong>
<p>This allows you to provide a UUID generator. If provided UUIDs will be attached
to all events, hubs, and contexts. This is useful for storing, tracking, and
linking these objects.</p>
<p>The sub you provide should always return a unique identifier. Most things will
expect a proper UUID string, however nothing in Test2::API enforces this.</p>
<p>The sub will receive exactly 1 argument, the type of thing being tagged
'context', 'hub', or 'event'. In the future additional things may be tagged, in
which case new strings will be passed in. These are purely informative, you can
(and usually should) ignore them.</p>
</li>
</ul>
<a class='view-head2' id="IPC-AND-CONCURRENCY"></a><h3 class='h3' >IPC AND CONCURRENCY</h3>
<p>These let you access, or specify, the IPC system internals.</p>
<ul>
<li><a class='view-title' id="%24bool-%3d-test2_has_ipc()"></a><strong>$bool = test2_has_ipc()</strong>
<p>Check if IPC is enabled.</p>
</li>
<li><a class='view-title' id="%24ipc-%3d-test2_ipc()"></a><strong>$ipc = test2_ipc()</strong>
<p>This will return the global <a href="../Test2/IPC/Driver.html">Test2::IPC::Driver</a> instance. If this has not yet
been initialized it will be initialized now.</p>
</li>
<li><a class='view-title' id="test2_ipc_add_driver(%24DRIVER)"></a><strong>test2_ipc_add_driver($DRIVER)</strong>
<p>Add an IPC driver to the list. This will add the driver to the start of the
list.</p>
</li>
<li><a class='view-title' id="%40drivers-%3d-test2_ipc_drivers()"></a><strong>@drivers = test2_ipc_drivers()</strong>
<p>Get the list of IPC drivers.</p>
</li>
<li><a class='view-title' id="%24bool-%3d-test2_ipc_polling()"></a><strong>$bool = test2_ipc_polling()</strong>
<p>Check if polling is enabled.</p>
</li>
<li><a class='view-title' id="test2_ipc_enable_polling()"></a><strong>test2_ipc_enable_polling()</strong>
<p>Turn on polling. This will cull events from other processes and threads every
time a context is created.</p>
</li>
<li><a class='view-title' id="test2_ipc_disable_polling()"></a><strong>test2_ipc_disable_polling()</strong>
<p>Turn off IPC polling.</p>
</li>
<li><a class='view-title' id="test2_ipc_enable_shm()"></a><strong>test2_ipc_enable_shm()</strong>
<p>Legacy, this is currently a no-op that returns 0;</p>
</li>
<li><a class='view-title' id="test2_ipc_set_pending(%24uniq_val)"></a><strong>test2_ipc_set_pending($uniq_val)</strong>
<p>Tell other processes and events that an event is pending. <code class="inline"><span class="i">$uniq_val</span></code>
 should
be a unique value no other thread/process will generate.</p>
<p><strong>Note:</strong> After calling this <code class="inline"><span class="i">test2_ipc_get_pending</span><span class="s">(</span><span class="s">)</span></code>
 will return 1. This is
intentional, and not avoidable.</p>
</li>
<li><a class='view-title' id="%24pending-%3d-test2_ipc_get_pending()"></a><strong>$pending = test2_ipc_get_pending()</strong>
<p>This returns -1 if there is no way to check (assume yes)</p>
<p>This returns 0 if there are (most likely) no pending events.</p>
<p>This returns 1 if there are (likely) pending events. Upon return it will reset,
nothing else will be able to see that there were pending events.</p>
</li>
<li><a class='view-title' id="%24timeout-%3d-test2_ipc_get_timeout()"></a><strong>$timeout = test2_ipc_get_timeout()</strong>
</li>
<li><a class='view-title' id="test2_ipc_set_timeout(%24timeout)"></a><strong>test2_ipc_set_timeout($timeout)</strong>
<p>Get/Set the timeout value for the IPC system. This timeout is how long the IPC
system will wait for child processes and threads to finish before aborting.</p>
<p>The default value is <code class="inline"><span class="n">30</span></code>
 seconds.</p>
</li>
</ul>
<a class='view-head2' id="MANAGING-FORMATTERS"></a><h3 class='h3' >MANAGING FORMATTERS</h3>
<p>These let you access, or specify, the formatters that can/should be used.</p>
<ul>
<li><a class='view-title' id="%24formatter-%3d-test2_formatter"></a><strong>$formatter = test2_formatter</strong>
<p>This will return the global formatter class. This is not an instance. By
default the formatter is set to <a href="../Test2/Formatter/TAP.html">Test2::Formatter::TAP</a>.</p>
<p>You can override this default using the <code class="inline"><span class="w">T2_FORMATTER</span></code>
 environment variable.</p>
<p>Normally 'Test2::Formatter::' is prefixed to the value in the
environment variable:</p>
<pre class="verbatim"><ol><li>    <span class="i">$ T2_FORMATTER</span>=<span class="q">&#39;TAP&#39;</span> <span class="w">perl</span> <span class="w">test</span>.<span class="w">t</span>     <span class="c"># Use the Test2::Formatter::TAP formatter</span></li><li>    <span class="i">$ T2_FORMATTER</span>=<span class="q">&#39;Foo&#39;</span> <span class="w">perl</span> <span class="w">test</span>.<span class="w">t</span>     <span class="c"># Use the Test2::Formatter::Foo formatter</span></li></ol></pre><p>If you want to specify a full module name you use the '+' prefix:</p>
<pre class="verbatim"><ol><li>    <span class="i">$ T2_FORMATTER</span>=<span class="q">&#39;+Foo::Bar&#39;</span> <span class="w">perl</span> <span class="w">test</span>.<span class="w">t</span>     <span class="c"># Use the Foo::Bar formatter</span></li></ol></pre></li>
<li><a class='view-title' id="test2_formatter_set(%24class_or_instance)"></a><strong>test2_formatter_set($class_or_instance)</strong>
<p>Set the global formatter class. This can only be set once. <strong>Note:</strong> This will
override anything specified in the 'T2_FORMATTER' environment variable.</p>
</li>
<li><a class='view-title' id="%40formatters-%3d-test2_formatters()"></a><strong>@formatters = test2_formatters()</strong>
<p>Get a list of all loaded formatters.</p>
</li>
<li><a class='view-title' id="test2_formatter_add(%24class_or_instance)"></a><strong>test2_formatter_add($class_or_instance)</strong>
<p>Add a formatter to the list. Last formatter added is used at initialization. If
this is called after initialization a warning will be issued.</p>
</li>
</ul>
<a class='view-head1' id="OTHER-EXAMPLES"></a><h2 class='h2' >OTHER EXAMPLES</h2>
<p>See the <code class="inline"><span class="q">/Examples/</span></code>
 directory included in this distribution.</p>
<a class='view-head1' id="SEE-ALSO"></a><h2 class='h2' >SEE ALSO</h2>
<p><a href="../Test2/API/Context.html">Test2::API::Context</a> - Detailed documentation of the context object.</p>
<p><a href="../Test2/IPC.html">Test2::IPC</a> - The IPC system used for threading/fork support.</p>
<p><a href="../Test2/Formatter.html">Test2::Formatter</a> - Formatters such as TAP live here.</p>
<p><a href="../Test2/Event.html">Test2::Event</a> - Events live in this namespace.</p>
<p><a href="../Test2/Hub.html">Test2::Hub</a> - All events eventually funnel through a hub. Custom hubs are how
<code class="inline"><span class="i">intercept</span><span class="s">(</span><span class="s">)</span></code>
 and <code class="inline"><span class="i">run_subtest</span><span class="s">(</span><span class="s">)</span></code>
 are implemented.</p>
<a class='view-head1' id="MAGIC"></a><h2 class='h2' >MAGIC</h2>
<p>This package has an END block. This END block is responsible for setting the
exit code based on the test results. This end block also calls the callbacks that
can be added to this package.</p>
<a class='view-head1' id="SOURCE"></a><h2 class='h2' >SOURCE</h2>
<p>The source code repository for Test2 can be found at
<i><a href="http://github.com/Test-More/test-more/">http://github.com/Test-More/test-more/</a></i>.</p>
<a class='view-head1' id="MAINTAINERS"></a><h2 class='h2' >MAINTAINERS</h2>
<ul>
<li><a class='view-title' id="Chad-Granum-%3cexodist%40cpan.org%3e"></a><strong>Chad Granum &lt;exodist@cpan.org&gt;</strong>
</li>
</ul>
<a class='view-head1' id="AUTHORS"></a><h2 class='h2' >AUTHORS</h2>
<ul>
<li><a class='view-title' id="Chad-Granum-%3cexodist%40cpan.org%3e"></a><strong>Chad Granum &lt;exodist@cpan.org&gt;</strong>
</li>
</ul>
<a class='view-head1' id="COPYRIGHT"></a><h2 class='h2' >COPYRIGHT</h2>
<p>Copyright 2019 Chad Granum &lt;exodist@cpan.org&gt;.</p>
<p>This program is free software; you can redistribute it and/or
modify it under the same terms as Perl itself.</p>
<p>See <i><a href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></i></p>




      <ul><li><a href="#NAME">NAME</a></li><li><a href="#***INTERNALS-NOTE***">***INTERNALS NOTE***</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><li><a href="#SYNOPSIS">SYNOPSIS</a></li><ul><li><a href="#WRITING-A-TOOL">WRITING A TOOL</a></li><li><a href="#TESTING-YOUR-TOOLS">TESTING YOUR TOOLS</a></li><li><a href="#OTHER-API-FUNCTIONS">OTHER API FUNCTIONS</a></li></ul><li><a href="#MAIN-API-EXPORTS">MAIN API EXPORTS</a></li><ul><li><a href="#context(...)">context(...)</a></li><li><a href="#release(%24%3b%24)">release($;$)</a></li><li><a href="#context_do(%26%3b%40)">context_do(&;@)</a></li><li><a href="#no_context(%26%3b%24)">no_context(&;$)</a></li><li><a href="#intercept(%26)">intercept(&)</a></li><li><a href="#run_subtest(...)">run_subtest(...)</a></li></ul><li><a href="#OTHER-API-EXPORTS">OTHER API EXPORTS</a></li><ul><li><a href="#STATUS-AND-INITIALIZATION-STATE">STATUS AND INITIALIZATION STATE</a></li><li><a href="#BEHAVIOR-HOOKS">BEHAVIOR HOOKS</a></li><li><a href="#IPC-AND-CONCURRENCY">IPC AND CONCURRENCY</a></li><li><a href="#MANAGING-FORMATTERS">MANAGING FORMATTERS</a></li></ul><li><a href="#OTHER-EXAMPLES">OTHER EXAMPLES</a></li><li><a href="#SEE-ALSO">SEE ALSO</a></li><li><a href="#MAGIC">MAGIC</a></li><li><a href="#SOURCE">SOURCE</a></li><li><a href="#MAINTAINERS">MAINTAINERS</a></li><li><a href="#AUTHORS">AUTHORS</a></li><li><a href="#COPYRIGHT">COPYRIGHT</a></li></ul>


                  </div>
                </article>
              </div>
            </div>
          </main>
        </div>
           <footer class="footer row bg-light pt-5 pb-5">
       <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
           <div class="row">
               <div class="col-md-4">
                   <ul class="list-unstyled">
                       <li>
                           <h4>Site info</h4>
                       </li>
                       <li>Docs mantained by
                           <a href="//lists.perl.org/list/perl5-porters.html"
                               rel="noopener">Perl 5 Porters</a>
                       </li>
                       <li>Perldoc site development sponsored by
                           <a href="//opusvl.com" rel="noopener">
                           <img style="margin: 20px 20px 5px 10px" class="opus-logo" src="/public/img/opusvl_logo.svg" alt="OpusVL Logo">
                        </a>
                    <li><span class="about_perldoc"><a href="//about.html">About PerlDOC</a></span>
                    </li>
                       </li>
                   </ul>
               </div>
               <div class="col-md-8">
                   <div class="row">
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Manuals</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-overview.html">Overview</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-tutorials.html">Tutorials</a>
                               </li>
                               <li>
                                   <a href="/5.30.2/index-faq.html">FAQs</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-history.html">Changes</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Reference</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-language.html">Language</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-functions.html">Functions</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/perlop.html">Operators</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/perlvar.html">Variables</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Modules</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-modules-A.html">Modules</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-pragmas.html">Pragmas</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-utilities.html">Utilities</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Misc</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-licence.html">License</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-internals.html">Internals</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.2/index-platforms.html">Platforms</a>
                               </li>
                            <li>
                                <a
                                    href="/5.30.2/index-about.html">About</a>
                            </li>
                           </ul>
                       </div>
                   </div>
               </div>
               <div class=" col-12 footer-inf text-center">
                   <small>perldoc.perl.org - Official documentation for the Perl
                       programming language</small>
               </div>
           </div>
       </div>
   </footer>

        	<div class="beta-wrapper beta-bottom-right ">
		<div class="beta beta-blue  ">
			<a class="beta-link "
				href="//github.com/OpusVL/perldoc.perl.org/issues/new" rel="noopener">
				<span class="beta-text">
					This website is a Beta release.
				</span>
				<span class="beta-text">
					For any issues please raise a ticket on GitHub
				</span>
			</a>
		</div>
	</div>

        <script src="/public/js/main.min.js"></script>
      </body>

      </html>
